<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸‰ï¼‰ | LuYu&#39;s Blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.luyu.icu/favicon.ico?v=1613541609759">
<link rel="stylesheet" href="https://blog.luyu.icu/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="æœ¬æ–‡æ‘˜è‡ªæ˜é‡‘,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘
æœ¬æ–‡æ˜¯å¯è§†åŒ–æ‹–æ‹½ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ä¸€å…±å¯¹ 17 ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œäº†åˆ†æï¼š

ç¼–è¾‘å™¨
è‡ªå®šä¹‰ç»„ä»¶
æ‹–æ‹½
åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§
æ”¾å¤§ç¼©å°
æ’¤æ¶ˆã€é‡åš
ç»„ä»¶å±æ€§è®¾ç½®
å¸é™„..." />
    <meta name="keywords" content="vue" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://blog.luyu.icu">
        <img src="https://blog.luyu.icu/images/avatar.png?v=1613541609759" class="site-logo">
        <h1 class="site-title">LuYu&#39;s Blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/panyu97py" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.luyu.icu/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸‰ï¼‰</h2>
            <div class="post-date">2021-02-17</div>
            
            <div class="post-content" v-pre>
              <p>æœ¬æ–‡æ‘˜è‡ª<a href="https://juejin.cn/post/6929302655118344200">æ˜é‡‘</a>,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘</p>
<p>æœ¬æ–‡æ˜¯å¯è§†åŒ–æ‹–æ‹½ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ä¸€å…±å¯¹ 17 ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œäº†åˆ†æï¼š</p>
<ol>
<li>ç¼–è¾‘å™¨</li>
<li>è‡ªå®šä¹‰ç»„ä»¶</li>
<li>æ‹–æ‹½</li>
<li>åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</li>
<li>æ”¾å¤§ç¼©å°</li>
<li>æ’¤æ¶ˆã€é‡åš</li>
<li>ç»„ä»¶å±æ€§è®¾ç½®</li>
<li>å¸é™„</li>
<li>é¢„è§ˆã€ä¿å­˜ä»£ç </li>
<li>ç»‘å®šäº‹ä»¶</li>
<li>ç»‘å®šåŠ¨ç”»</li>
<li>å¯¼å…¥ PSD</li>
<li>æ‰‹æœºæ¨¡å¼</li>
<li>æ‹–æ‹½æ—‹è½¬</li>
<li>å¤åˆ¶ç²˜è´´å‰ªåˆ‡</li>
<li>æ•°æ®äº¤äº’</li>
<li>å‘å¸ƒ</li>
</ol>
<p>æœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå°†å¯¹ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œåˆ†æï¼š</p>
<ol start="18">
<li>å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†</li>
<li>æ–‡æœ¬ç»„ä»¶</li>
<li>çŸ©å½¢ç»„ä»¶</li>
<li>é”å®šç»„ä»¶</li>
<li>å¿«æ·é”®</li>
<li>ç½‘æ ¼çº¿</li>
<li>ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼</li>
</ol>
<p>è™½ç„¶æˆ‘è¿™ä¸ªå¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“åªæ˜¯ä¸€ä¸ª DEMOï¼Œä½†å¯¹æ¯”äº†ä¸€ä¸‹å¸‚é¢ä¸Šçš„ä¸€äº›ç°æˆäº§å“ï¼ˆä¾‹å¦‚ <a href="https://www.processon.com/">processon</a>ã€<a href="https://modao.cc/">å¢¨åˆ€</a>ï¼‰ï¼Œå°±åŸºç¡€åŠŸèƒ½æ¥è¯´ï¼Œæˆ‘è¿™ä¸ª DEMO å®ç°äº†ç»å¤§éƒ¨åˆ†çš„åŠŸèƒ½ã€‚<br>
å¦‚æœä½ å¯¹äºä½ä»£ç å¹³å°æœ‰å…´è¶£ï¼Œä½†åˆä¸äº†è§£çš„è¯ã€‚å¼ºçƒˆå»ºè®®å°†æˆ‘çš„ä¸‰ç¯‡æ–‡ç« ç»“åˆé¡¹ç›®æºç ä¸€èµ·é˜…è¯»ï¼Œç›¸ä¿¡å¯¹ä½ çš„æ”¶è·ç»å¯¹ä¸å°ã€‚å¦é™„ä¸Šé¡¹ç›®ã€åœ¨çº¿ DEMO åœ°å€ï¼š</p>
<p><a href="https://github.com/woai3c/visual-drag-demo">github é¡¹ç›®åœ°å€</a></p>
<p><a href="https://woai3c.github.io/visual-drag-demo/#/">åœ¨çº¿é¢„è§ˆ</a></p>
<h3 id="18-å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†">18. å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†</h3>
<p>ç»„åˆå’Œæ‹†åˆ†çš„æŠ€æœ¯ç‚¹ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œå…±æœ‰ä»¥ä¸‹ 4 ä¸ªï¼š</p>
<ul>
<li>é€‰ä¸­åŒºåŸŸ</li>
<li>ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬</li>
<li>ç»„åˆåçš„æ”¾å¤§ç¼©å°</li>
<li>æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤</li>
</ul>
<h4 id="é€‰ä¸­åŒºåŸŸ">é€‰ä¸­åŒºåŸŸ</h4>
<p>åœ¨å°†å¤šä¸ªç»„ä»¶ç»„åˆä¹‹å‰ï¼Œéœ€è¦å…ˆé€‰ä¸­å®ƒä»¬ã€‚åˆ©ç”¨é¼ æ ‡äº‹ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†é€‰ä¸­åŒºåŸŸå±•ç¤ºå‡ºæ¥ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613505365488.gif" alt="" loading="lazy"></figure>
<ol>
<li><code>mousedown</code> è®°å½•èµ·ç‚¹åæ ‡</li>
<li><code>mousemove</code> å°†å½“å‰åæ ‡å’Œèµ·ç‚¹åæ ‡è¿›è¡Œè®¡ç®—å¾—å‡ºç§»åŠ¨åŒºåŸŸ</li>
<li>å¦‚æœæŒ‰ä¸‹é¼ æ ‡åå¾€å·¦ä¸Šæ–¹ç§»åŠ¨ï¼Œç±»ä¼¼äºè¿™ç§æ“ä½œåˆ™éœ€è¦å°†å½“å‰åæ ‡è®¾ä¸ºèµ·ç‚¹åæ ‡ï¼Œå†è®¡ç®—å‡ºç§»åŠ¨åŒºåŸŸ</li>
</ol>
<pre><code class="language-js">// è·å–ç¼–è¾‘å™¨çš„ä½ç§»ä¿¡æ¯
const rectInfo = this.editor.getBoundingClientRect()
this.editorX = rectInfo.x
this.editorY = rectInfo.y

const startX = e.clientX
const startY = e.clientY
this.start.x = startX - this.editorX
this.start.y = startY - this.editorY
// å±•ç¤ºé€‰ä¸­åŒºåŸŸ
this.isShowArea = true

const move = (moveEvent) =&gt; {
    this.width = Math.abs(moveEvent.clientX - startX)
    this.height = Math.abs(moveEvent.clientY - startY)
    if (moveEvent.clientX &lt; startX) {
        this.start.x = moveEvent.clientX - this.editorX
    }

    if (moveEvent.clientY &lt; startY) {
        this.start.y = moveEvent.clientY - this.editorY
    }
}
</code></pre>
<p>åœ¨ mouseup äº‹ä»¶è§¦å‘æ—¶ï¼Œéœ€è¦å¯¹é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶çš„ä½ç§»å¤§å°ä¿¡æ¯è¿›è¡Œè®¡ç®—ï¼Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚è¿™ä¸ªæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613505466651.gif" alt="" loading="lazy"></figure>
<p>è¿™ä¸ªè®¡ç®—è¿‡ç¨‹çš„ä»£ç ï¼š</p>
<pre><code class="language-js">createGroup() {
  // è·å–é€‰ä¸­åŒºåŸŸçš„ç»„ä»¶æ•°æ®
  const areaData = this.getSelectArea()
  if (areaData.length &lt;= 1) {
      this.hideArea()
      return
  }

  // æ ¹æ®é€‰ä¸­åŒºåŸŸå’ŒåŒºåŸŸä¸­æ¯ä¸ªç»„ä»¶çš„ä½ç§»ä¿¡æ¯æ¥åˆ›å»º Group ç»„ä»¶
  // è¦éå†é€‰æ‹©åŒºåŸŸçš„æ¯ä¸ªç»„ä»¶ï¼Œè·å–å®ƒä»¬çš„ left top right bottom ä¿¡æ¯æ¥è¿›è¡Œæ¯”è¾ƒ
  let top = Infinity, left = Infinity
  let right = -Infinity, bottom = -Infinity
  areaData.forEach(component =&gt; {
      let style = {}
      if (component.component == 'Group') {
          component.propValue.forEach(item =&gt; {
              const rectInfo = $(`#component${item.id}`).getBoundingClientRect()
              style.left = rectInfo.left - this.editorX
              style.top = rectInfo.top - this.editorY
              style.right = rectInfo.right - this.editorX
              style.bottom = rectInfo.bottom - this.editorY

              if (style.left &lt; left) left = style.left
              if (style.top &lt; top) top = style.top
              if (style.right &gt; right) right = style.right
              if (style.bottom &gt; bottom) bottom = style.bottom
          })
      } else {
          style = getComponentRotatedStyle(component.style)
      }

      if (style.left &lt; left) left = style.left
      if (style.top &lt; top) top = style.top
      if (style.right &gt; right) right = style.right
      if (style.bottom &gt; bottom) bottom = style.bottom
  })

  this.start.x = left
  this.start.y = top
  this.width = right - left
  this.height = bottom - top
	
  // è®¾ç½®é€‰ä¸­åŒºåŸŸä½ç§»å¤§å°ä¿¡æ¯å’ŒåŒºåŸŸå†…çš„ç»„ä»¶æ•°æ®
  this.$store.commit('setAreaData', {
      style: {
          left,
          top,
          width: this.width,
          height: this.height,
      },
      components: areaData,
  })
},
        
getSelectArea() {
    const result = []
    // åŒºåŸŸèµ·ç‚¹åæ ‡
    const { x, y } = this.start
    // è®¡ç®—æ‰€æœ‰çš„ç»„ä»¶æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨é€‰ä¸­åŒºåŸŸå†…
    this.componentData.forEach(component =&gt; {
        if (component.isLock) return
        const { left, top, width, height } = component.style
        if (x &lt;= left &amp;&amp; y &lt;= top &amp;&amp; (left + width &lt;= x + this.width) &amp;&amp; (top + height &lt;= y + this.height)) {
            result.push(component)
        }
    })
	
    // è¿”å›åœ¨é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶
    return result
}
</code></pre>
<p>ç®€å•æè¿°ä¸€ä¸‹è¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ï¼š</p>
<ol>
<li>åˆ©ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect"><code>getBoundingClientRect()</code></a> æµè§ˆå™¨ API è·å–æ¯ä¸ªç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£å››ä¸ªæ–¹å‘ä¸Šçš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>ã€‚</li>
<li>å¯¹æ¯”æ¯ä¸ªç»„ä»¶çš„è¿™å››ä¸ªä¿¡æ¯ï¼Œå–å¾—é€‰ä¸­åŒºåŸŸçš„æœ€å·¦ã€æœ€ä¸Šã€æœ€å³ã€æœ€ä¸‹å››ä¸ªæ–¹å‘çš„æ•°å€¼ï¼Œä»è€Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚</li>
<li>å¦‚æœé€‰ä¸­åŒºåŸŸå†…å·²ç»æœ‰ä¸€ä¸ª <code>Group</code> ç»„åˆç»„ä»¶ï¼Œåˆ™éœ€è¦å¯¹å®ƒé‡Œé¢çš„å­ç»„ä»¶è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯å¯¹ç»„åˆç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚</li>
</ol>
<h4 id="ç»„åˆåçš„ç§»åŠ¨-æ—‹è½¬">ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬</h4>
<p>ä¸ºäº†æ–¹ä¾¿å°†å¤šä¸ªç»„ä»¶ä¸€èµ·è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬ã€æ”¾å¤§ç¼©å°ç­‰æ“ä½œï¼Œæˆ‘æ–°åˆ›å»ºäº†ä¸€ä¸ª <code>Group</code> ç»„åˆç»„ä»¶ï¼š</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;group&quot;&gt;
        &lt;div&gt;
             &lt;template v-for=&quot;item in propValue&quot;&gt;
                &lt;component
                    class=&quot;component&quot;
                    :is=&quot;item.component&quot;
                    :style=&quot;item.groupStyle&quot;
                    :propValue=&quot;item.propValue&quot;
                    :key=&quot;item.id&quot;
                    :id=&quot;'component' + item.id&quot;
                    :element=&quot;item&quot;
                /&gt;
            &lt;/template&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { getStyle } from '@/utils/style'

export default {
    props: {
        propValue: {
            type: Array,
            default: () =&gt; [],
        },
        element: {
            type: Object,
        },
    },
    created() {
        const parentStyle = this.element.style
        this.propValue.forEach(component =&gt; {
            // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®
            // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—
            if (!Object.keys(component.groupStyle).length) {
                const style = { ...component.style }
                component.groupStyle = getStyle(style)
                component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)
                component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)
                component.groupStyle.width = this.toPercent(style.width / parentStyle.width)
                component.groupStyle.height = this.toPercent(style.height / parentStyle.height)
            }
        })
    },
    methods: {
        toPercent(val) {
            return val * 100 + '%'
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.group {
    &amp; &gt; div {
        position: relative;
        width: 100%;
        height: 100%;

        .component {
            position: absolute;
        }
    }
}
&lt;/style&gt;
</code></pre>
<p><code>Group</code> ç»„ä»¶çš„ä½œç”¨å°±æ˜¯å°†åŒºåŸŸå†…çš„ç»„ä»¶æ”¾åˆ°å®ƒä¸‹é¢ï¼Œæˆä¸ºå­ç»„ä»¶ã€‚å¹¶ä¸”åœ¨åˆ›å»º <code>Group</code> ç»„ä»¶æ—¶ï¼Œè·å–æ¯ä¸ªå­ç»„ä»¶åœ¨ <code>Group</code> ç»„ä»¶å†…çš„ç›¸å¯¹ä½ç§»å’Œç›¸å¯¹å¤§å°ï¼š</p>
<pre><code class="language-js">created() {
    const parentStyle = this.element.style
    this.propValue.forEach(component =&gt; {
        // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®
        // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—
        if (!Object.keys(component.groupStyle).length) {
            const style = { ...component.style }
            component.groupStyle = getStyle(style)
            component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)
            component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)
            component.groupStyle.width = this.toPercent(style.width / parentStyle.width)
            component.groupStyle.height = this.toPercent(style.height / parentStyle.height)
        }
    })
},
methods: {
        toPercent(val) {
            return val * 100 + '%'
        },
    },
</code></pre>
<p>ä¹Ÿå°±æ˜¯å°†å­ç»„ä»¶çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> ç­‰å±æ€§è½¬æˆä»¥ <code>%</code> ç»“å°¾çš„ç›¸å¯¹æ•°å€¼ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Ÿ</strong></p>
<p>å¦‚æœä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Œé‚£ä¹ˆåœ¨ç§»åŠ¨ <code>Group</code> ç»„ä»¶æ—¶ï¼Œé™¤äº†å¯¹ <code>Group</code> ç»„ä»¶çš„å±æ€§è¿›è¡Œè®¡ç®—å¤–ï¼Œè¿˜éœ€è¦å¯¹å®ƒçš„æ¯ä¸ªå­ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¹¶ä¸” <code>Group</code> åŒ…å«å­ç»„ä»¶å¤ªå¤šçš„è¯ï¼Œåœ¨è¿›è¡Œç§»åŠ¨ã€æ”¾å¤§ç¼©å°æ—¶ï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆé¡µé¢å¡é¡¿ã€‚å¦‚æœæ”¹æˆç›¸å¯¹æ•°å€¼ï¼Œåˆ™åªéœ€è¦åœ¨ <code>Group</code> åˆ›å»ºæ—¶è®¡ç®—ä¸€æ¬¡ã€‚ç„¶ååœ¨ <code>Group</code> ç»„ä»¶è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬æ—¶ä¹Ÿä¸ç”¨ç®¡ <code>Group</code> çš„å­ç»„ä»¶ï¼Œåªå¯¹å®ƒè‡ªå·±è®¡ç®—å³å¯ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613505786018.gif" alt="" loading="lazy"></figure>
<h4 id="ç»„åˆåçš„æ”¾å¤§ç¼©å°">ç»„åˆåçš„æ”¾å¤§ç¼©å°</h4>
<p>ç»„åˆåçš„æ”¾å¤§ç¼©å°æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºæœ‰æ—‹è½¬è§’åº¦çš„å­˜åœ¨ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å„ä¸ªå­ç»„ä»¶æ²¡æ—‹è½¬æ—¶çš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://blog.luyu.icu/post-images/1613505848014.gif" alt="" loading="lazy"></figure>
<p>ä»åŠ¨å›¾å¯ä»¥çœ‹å‡ºï¼Œæ•ˆæœéå¸¸å®Œç¾ã€‚å„ä¸ªå­ç»„ä»¶çš„å¤§å°æ˜¯è·Ÿéš <code>Group</code> ç»„ä»¶çš„å¤§å°è€Œæ”¹å˜çš„ã€‚</p>
<p>ç°åœ¨è¯•ç€ç»™å­ç»„ä»¶åŠ ä¸Šæ—‹è½¬è§’åº¦ï¼Œå†çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>
<figure data-type="image" tabindex="5"><img src="https://blog.luyu.icu/post-images/1613505895886.gif" alt="" loading="lazy"></figure>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ<br>
ä¸»è¦æ˜¯å› ä¸ºä¸€ä¸ªç»„ä»¶æ— è®ºæ—‹ä¸æ—‹è½¬ï¼Œå®ƒçš„ <code>left</code>ã€<code>top</code> å±æ€§éƒ½æ˜¯ä¸å˜çš„ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„  <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚</p>
<p><img src="https://blog.luyu.icu/post-images/1613505976304.png" alt="" loading="lazy"><br>
å¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>æ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://blog.luyu.icu/post-images/1613506012073.png" alt="" loading="lazy"></figure>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ª <code>Group</code> ç»„ä»¶ï¼Œå®ƒå·¦è¾¹çš„å­ç»„ä»¶å±æ€§ä¸ºï¼š</p>
<pre><code class="language-css">transform: rotate(-75.1967deg);
width: 51.2267%;
height: 32.2679%;
top: 33.8661%;
left: -10.6496%;
</code></pre>
<p>å¯ä»¥çœ‹åˆ° <code>width</code> çš„å€¼ä¸º <code>51.2267%</code>ï¼Œä½†ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªå­ç»„ä»¶æœ€å¤šå  <code>Group</code> ç»„ä»¶å®½åº¦çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚æ‰€ä»¥è¿™å°±æ˜¯æ”¾å¤§ç¼©å°ä¸æ­£å¸¸çš„é—®é¢˜æ‰€åœ¨ã€‚</p>
<h5 id="ä¸€ä¸ªä¸å¯è¡Œçš„è§£å†³æ–¹æ¡ˆä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡">ä¸€ä¸ªä¸å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼ˆä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡ï¼‰</h5>
<p>ä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯ï¼Œå…ˆç®—å‡ºå®ƒç›¸å¯¹æµè§ˆå™¨è§†å£çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> å±æ€§ï¼Œå†ç®—å‡ºè¿™å‡ ä¸ªå±æ€§åœ¨ <code>Group</code> ç»„ä»¶ä¸Šçš„ç›¸å¯¹æ•°å€¼ã€‚è¿™å¯ä»¥é€šè¿‡ <code>getBoundingClientRect()</code> <code>API</code> å®ç°ã€‚åªè¦ç»´æŒå¤–è§‚ä¸Šçš„å„ä¸ªå±æ€§å æ¯”ä¸å˜ï¼Œè¿™æ · <code>Group</code> ç»„ä»¶åœ¨æ”¾å¤§ç¼©å°æ—¶ï¼Œå†é€šè¿‡æ—‹è½¬è§’åº¦ï¼Œåˆ©ç”¨æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼ˆè¿™ä¸€ç‚¹åœ¨ç¬¬äºŒç¯‡æœ‰è¯¦ç»†æè¿°ï¼‰è·å–å®ƒæœªæ—‹è½¬å‰çš„ t<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°å­ç»„ä»¶åŠ¨æ€è°ƒæ•´äº†ã€‚</p>
<p>ä½†æ˜¯è¿™æœ‰ä¸ªé—®é¢˜ï¼Œé€šè¿‡ <code>getBoundingClientRect()</code> API åªèƒ½è·å–ç»„ä»¶å¤–è§‚ä¸Šçš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚å†åŠ ä¸Šä¸€ä¸ªè§’åº¦ï¼Œå‚æ•°è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥æ— æ³•è®¡ç®—å‡ºç»„ä»¶å®é™…çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.luyu.icu/post-images/1613506253945.png" alt="" loading="lazy"></figure>
<p>å°±åƒä¸Šé¢çš„è¿™å¼ å›¾ï¼ŒåªçŸ¥é“åŸç‚¹<code>O(x,y)</code>ã€ <code>w</code>ã€<code>h</code> å’Œæ—‹è½¬è§’åº¦ï¼Œæ— æ³•ç®—å‡ºæŒ‰é’®çš„å®½é«˜ã€‚</p>
<h4 id="ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ">ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ</h4>
<p>è¿™æ˜¯æ— æ„ä¸­å‘ç°çš„ï¼Œæˆ‘åœ¨å¯¹ <code>Group</code> ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°æ—¶ï¼Œå‘ç°åªè¦ä¿æŒ <code>Group</code> ç»„ä»¶çš„å®½é«˜æ¯”ä¾‹ï¼Œå­ç»„ä»¶å°±èƒ½åšåˆ°æ ¹æ®æ¯”ä¾‹æ”¾å¤§ç¼©å°ã€‚é‚£ä¹ˆç°åœ¨é—®é¢˜å°±è½¬å˜æˆäº†å¦‚ä½•è®© <code>Group</code> ç»„ä»¶æ”¾å¤§ç¼©å°æ—¶ä¿æŒå®½é«˜æ¯”ä¾‹ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™ä¸€ç¯‡<a href="https://github.com/shenhudong/snapping-demo/wiki/corner-handle">æ–‡ç« </a>ï¼Œå®ƒè¯¦ç»†æè¿°äº†ä¸€ä¸ªæ—‹è½¬ç»„ä»¶å¦‚ä½•ä¿æŒå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œå¹¶é…æœ‰æºç ç¤ºä¾‹ã€‚</p>
<p>ç°åœ¨æˆ‘å°è¯•ç®€å•æè¿°ä¸€ä¸‹å¦‚ä½•ä¿æŒå®½é«˜æ¯”å¯¹ä¸€ä¸ªæ—‹è½¬ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°ï¼ˆå»ºè®®è¿˜æ˜¯çœ‹çœ‹åŸæ–‡ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://blog.luyu.icu/post-images/1613506394348.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œç®—å‡ºç»„ä»¶å®½é«˜æ¯”ï¼Œä»¥åŠæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ <code>top</code> ã€<code>left</code> å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">// ç»„ä»¶å®½é«˜æ¯”
const proportion = style.width / style.height
            
const center = {
    x: style.left + style.width / 2,
    y: style.top + style.height / 2,
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç”¨å½“å‰ç‚¹å‡»åæ ‡å’Œç»„ä»¶ä¸­å¿ƒç‚¹ç®—å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š</p>
<pre><code class="language-js">// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯
const editorRectInfo = document.querySelector('#editor').getBoundingClientRect()

// å½“å‰ç‚¹å‡»åæ ‡
const curPoint = {
    x: e.clientX - editorRectInfo.left,
    y: e.clientY - editorRectInfo.top,
}

// è·å–å¯¹ç§°ç‚¹çš„åæ ‡
const symmetricPoint = {
    x: center.x - (curPoint.x - center.x),
    y: center.y - (curPoint.y - center.y),
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const curPositon = {
    x: moveEvent.clientX - editorRectInfo.left,
    y: moveEvent.clientY - editorRectInfo.top,
}

const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)

// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡
function getCenterPoint(p1, p2) {
    return {
        x: p1.x + ((p2.x - p1.x) / 2),
        y: p1.y + ((p2.y - p1.y) / 2),
    }
}
</code></pre>
<p>ç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„ xy è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://blog.luyu.icu/post-images/1613506539352.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ <code>currentPosition</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newTopLeftPoint</code>ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ sPoint åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newBottomRightPoint</code>ã€‚<br>
å¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡
 * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡
 * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ
 * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦
 * @return  {Object}         æ—‹è½¬åçš„åæ ‡
 * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼
 */
export function calculateRotatedPointCoordinate(point, center, rotate) {
    /**
     * æ—‹è½¬å…¬å¼ï¼š
     *  ç‚¹a(x, y)
     *  æ—‹è½¬ä¸­å¿ƒc(x, y)
     *  æ—‹è½¬åç‚¹n(x, y)
     *  æ—‹è½¬è§’åº¦Î¸                tan ??
     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx
     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy
     */

    return {
        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,
        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,
    }
}
</code></pre>
<p>ä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»<a href="https://www.zhihu.com/question/67425734/answer/252724399">çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”</a>ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://blog.luyu.icu/post-images/1613506660740.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="11"><img src="https://blog.luyu.icu/post-images/1613506688090.png" alt="" loading="lazy"></figure>
<p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼ <code>top</code>ã€<code>left</code> ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, pointInfo) {
    const { symmetricPoint } = pointInfo
    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="12"><img src="https://blog.luyu.icu/post-images/1613506759227.gif" alt="" loading="lazy"></figure>
<p><strong>ç¬¬äº”æ­¥</strong>ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯é”å®šå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è®¡ç®—æ‹‰ä¼¸åçš„å›¾å½¢çš„å·¦ä¸Šè§’åæ ‡ã€‚</p>
<p>è¿™é‡Œå…ˆç¡®å®šå¥½å‡ ä¸ªå½¢çŠ¶çš„å‘½åï¼š</p>
<ul>
<li>åŸå›¾å½¢: ã€€çº¢è‰²éƒ¨åˆ†</li>
<li>æ–°å›¾å½¢: ã€€è“è‰²éƒ¨åˆ†</li>
<li>ä¿®æ­£å›¾å½¢: ç»¿è‰²éƒ¨åˆ†ï¼Œå³åŠ ä¸Šå®½é«˜æ¯”é”å®šè§„åˆ™çš„ä¿®æ­£å›¾å½¢</li>
</ul>
<figure data-type="image" tabindex="13"><img src="https://blog.luyu.icu/post-images/1613506825223.gif" alt="" loading="lazy"></figure>
<p>åœ¨ç¬¬å››æ­¥ä¸­ç®—å‡ºç»„ä»¶æœªæ—‹è½¬å‰çš„ <code>newTopLeftPoint</code> <code>newBottomRightPoint</code> <code>newWidth</code> <code>newHeight</code> åï¼Œéœ€è¦æ ¹æ®å®½é«˜æ¯” <code>proportion</code> æ¥ç®—å‡ºæ–°çš„å®½åº¦æˆ–é«˜åº¦ã€‚</p>
<figure data-type="image" tabindex="14"><img src="https://blog.luyu.icu/post-images/1613506905389.png" alt="" loading="lazy"></figure>
<p>ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªéœ€è¦æ”¹å˜é«˜åº¦çš„ç¤ºä¾‹ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">if (newWidth / newHeight &gt; proportion) {
    newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)
    newWidth = newHeight * proportion
} else {
    newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)
    newHeight = newWidth / proportion
}
</code></pre>
<p>ç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡ã€‚ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://blog.luyu.icu/post-images/1613506955962.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="16"><img src="https://blog.luyu.icu/post-images/1613507009595.png" alt="" loading="lazy"></figure>
<p>ç»è¿‡ä¿®æ”¹åçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, proportion, needLockProportion, pointInfo) {
    const { symmetricPoint } = pointInfo
    let newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    let newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    let newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    let newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    let newHeight = newBottomRightPoint.y - newTopLeftPoint.y

    if (needLockProportion) {
        if (newWidth / newHeight &gt; proportion) {
            newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)
            newWidth = newHeight * proportion
        } else {
            newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)
            newHeight = newWidth / proportion
        }

        // ç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„
        // æ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡
        // ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡
        const rotatedTopLeftPoint = calculateRotatedPointCoordinate(newTopLeftPoint, newCenterPoint, style.rotate)
        newCenterPoint = getCenterPoint(rotatedTopLeftPoint, symmetricPoint)
        newTopLeftPoint = calculateRotatedPointCoordinate(rotatedTopLeftPoint, newCenterPoint, -style.rotate)
        newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
    
        newWidth = newBottomRightPoint.x - newTopLeftPoint.x
        newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    }

    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="17"><img src="https://blog.luyu.icu/post-images/1613507087355.gif" alt="" loading="lazy"></figure>
<p>å½“ <code>Group</code> ç»„ä»¶æœ‰æ—‹è½¬çš„å­ç»„ä»¶æ—¶ï¼Œæ‰éœ€è¦ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚æ‰€ä»¥åœ¨åˆ›å»º <code>Group</code> ç»„ä»¶æ—¶å¯ä»¥åˆ¤æ–­ä¸€ä¸‹å­ç»„ä»¶æ˜¯å¦æœ‰æ—‹è½¬è§’åº¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦ä¿æŒå®½åº¦æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚</p>
<pre><code class="language-js">isNeedLockProportion() {
    if (this.element.component != 'Group') return false
    const ratates = [0, 90, 180, 360]
    for (const component of this.element.propValue) {
        if (!ratates.includes(mod360(parseInt(component.style.rotate)))) {
            return true
        }
    }

    return false
}
</code></pre>
<h4 id="æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤">æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤</h4>
<p>å°†å¤šä¸ªç»„ä»¶ç»„åˆåœ¨ä¸€èµ·åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥æ˜¯å°† <code>Group</code> ç»„ä»¶è¿›è¡Œæ‹†åˆ†å¹¶æ¢å¤å„ä¸ªå­ç»„ä»¶çš„æ ·å¼ã€‚ä¿è¯æ‹†åˆ†åçš„å­ç»„ä»¶åœ¨å¤–è§‚ä¸Šçš„å±æ€§ä¸å˜ã€‚</p>
<p>è®¡ç®—ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// store
decompose({ curComponent, editor }) {
    const parentStyle = { ...curComponent.style }
    const components = curComponent.propValue
    const editorRect = editor.getBoundingClientRect()

    store.commit('deleteComponent')
    components.forEach(component =&gt; {
        decomposeComponent(component, editorRect, parentStyle)
        store.commit('addComponent', { component })
    })
}
        
// å°†ç»„åˆä¸­çš„å„ä¸ªå­ç»„ä»¶æ‹†åˆ†å‡ºæ¥ï¼Œå¹¶è®¡ç®—å®ƒä»¬æ–°çš„ style
export default function decomposeComponent(component, editorRect, parentStyle) {
    // å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„æ ·å¼
    const componentRect = $(`#component${component.id}`).getBoundingClientRect()
    // è·å–å…ƒç´ çš„ä¸­å¿ƒç‚¹åæ ‡
    const center = {
        x: componentRect.left - editorRect.left + componentRect.width / 2,
        y: componentRect.top - editorRect.top + componentRect.height / 2,
    }

    component.style.rotate = mod360(component.style.rotate + parentStyle.rotate)
    component.style.width = parseFloat(component.groupStyle.width) / 100 * parentStyle.width
    component.style.height = parseFloat(component.groupStyle.height) / 100 * parentStyle.height
    // è®¡ç®—å‡ºå…ƒç´ æ–°çš„ top left åæ ‡
    component.style.left = center.x - component.style.width / 2
    component.style.top = center.y - component.style.height / 2
    component.groupStyle = {}
}
</code></pre>
<p>è¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ä¸ºï¼š</p>
<ol>
<li>éå† <code>Group</code> çš„å­ç»„ä»¶å¹¶æ¢å¤å®ƒä»¬çš„æ ·å¼</li>
<li>åˆ©ç”¨ <code>getBoundingClientRect() ``API</code> è·å–å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„ <code>left</code> <code>top</code> <code>width</code> <code>height</code> å±æ€§ã€‚</li>
<li>åˆ©ç”¨è¿™å››ä¸ªå±æ€§è®¡ç®—å‡ºå­ç»„ä»¶çš„ä¸­å¿ƒç‚¹åæ ‡ã€‚</li>
<li>ç”±äºå­ç»„ä»¶çš„ <code>width</code> <code>height</code> å±æ€§æ˜¯ç›¸å¯¹äº <code>Group</code> ç»„ä»¶çš„ï¼Œæ‰€ä»¥å°†å®ƒä»¬çš„ç™¾åˆ†æ¯”å€¼å’Œ <code>Group</code> ç›¸ä¹˜å¾—å‡ºå…·ä½“æ•°å€¼ã€‚</li>
<li>å†ç”¨ä¸­å¿ƒç‚¹ <code>center(x, y)</code>å‡å»å­ç»„ä»¶å®½é«˜çš„ä¸€åŠå¾—å‡ºå®ƒçš„ <code>left</code> <code>top</code> å±æ€§ã€‚</li>
</ol>
<p>è‡³æ­¤ï¼Œç»„åˆå’Œæ‹†åˆ†å°±è®²è§£å®Œäº†ã€‚</p>
<h3 id="19-æ–‡æœ¬ç»„ä»¶">19. æ–‡æœ¬ç»„ä»¶</h3>
<p>æ–‡æœ¬ç»„ä»¶ <code>VText</code> ä¹‹å‰å°±å·²ç»å®ç°è¿‡äº†ï¼Œä½†ä¸å®Œç¾ã€‚ä¾‹å¦‚æ— æ³•å¯¹æ–‡å­—è¿›è¡Œé€‰ä¸­ã€‚ç°åœ¨æˆ‘å¯¹å®ƒè¿›è¡Œäº†é‡å†™ï¼Œè®©å®ƒæ”¯æŒé€‰ä¸­åŠŸèƒ½ã€‚</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div v-if=&quot;editMode == 'edit'&quot; class=&quot;v-text&quot; @keydown=&quot;handleKeydown&quot; @keyup=&quot;handleKeyup&quot;&gt;
        &lt;!-- tabindex &gt;= 0 ä½¿å¾—åŒå‡»æ—¶èšé›†è¯¥å…ƒç´  --&gt;
        &lt;div :contenteditable=&quot;canEdit&quot; :class=&quot;{ canEdit }&quot; @dblclick=&quot;setEdit&quot; :tabindex=&quot;element.id&quot; @paste=&quot;clearStyle&quot;
            @mousedown=&quot;handleMousedown&quot; @blur=&quot;handleBlur&quot; ref=&quot;text&quot; v-html=&quot;element.propValue&quot; @input=&quot;handleInput&quot;
            :style=&quot;{ verticalAlign: element.style.verticalAlign }&quot;
        &gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div v-else class=&quot;v-text&quot;&gt;
        &lt;div v-html=&quot;element.propValue&quot; :style=&quot;{ verticalAlign: element.style.verticalAlign }&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'
import { keycodes } from '@/utils/shortcutKey.js'

export default {
    props: {
        propValue: {
            type: String,
            require: true,
        },
        element: {
            type: Object,
        },
    },
    data() {
        return {
            canEdit: false,
            ctrlKey: 17,
            isCtrlDown: false,
        }
    },
    computed: {
        ...mapState([
            'editMode',
        ]),
    },
    methods: {
        handleInput(e) {
            this.$emit('input', this.element, e.target.innerHTML)
        },

        handleKeydown(e) {
            if (e.keyCode == this.ctrlKey) {
                this.isCtrlDown = true
            } else if (this.isCtrlDown &amp;&amp; this.canEdit &amp;&amp; keycodes.includes(e.keyCode)) {
                e.stopPropagation()
            } else if (e.keyCode == 46) { // deleteKey
                e.stopPropagation()
            }
        },

        handleKeyup(e) {
            if (e.keyCode == this.ctrlKey) {
                this.isCtrlDown = false
            }
        },

        handleMousedown(e) {
            if (this.canEdit) {
                e.stopPropagation()
            }
        },

        clearStyle(e) {
            e.preventDefault()
            const clp = e.clipboardData
            const text = clp.getData('text/plain') || ''
            if (text !== '') {
                document.execCommand('insertText', false, text)
            }

            this.$emit('input', this.element, e.target.innerHTML)
        },

        handleBlur(e) {
            this.element.propValue = e.target.innerHTML || '&amp;nbsp;'
            this.canEdit = false
        },

        setEdit() {
            this.canEdit = true
            // å…¨é€‰
            this.selectText(this.$refs.text)
        },

        selectText(element) {
            const selection = window.getSelection()
            const range = document.createRange()
            range.selectNodeContents(element)
            selection.removeAllRanges()
            selection.addRange(range)
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.v-text {
    width: 100%;
    height: 100%;
    display: table;

    div {
        display: table-cell;
        width: 100%;
        height: 100%;
        outline: none;
    }

    .canEdit {
        cursor: text;
        height: 100%;
    }
}
&lt;/style&gt;
</code></pre>
<p>æ”¹é€ åçš„ VText ç»„ä»¶åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ol>
<li>åŒå‡»å¯åŠ¨ç¼–è¾‘ã€‚</li>
<li>æ”¯æŒé€‰ä¸­æ–‡æœ¬ã€‚</li>
<li>ç²˜è´´æ—¶è¿‡æ»¤æ‰æ–‡æœ¬çš„æ ·å¼ã€‚</li>
<li>æ¢è¡Œæ—¶è‡ªåŠ¨æ‰©å……æ–‡æœ¬æ¡†çš„é«˜åº¦ã€‚</li>
</ol>
<figure data-type="image" tabindex="18"><img src="https://blog.luyu.icu/post-images/1613507304088.gif" alt="" loading="lazy"></figure>
<h3 id="20-çŸ©å½¢ç»„ä»¶">20. çŸ©å½¢ç»„ä»¶</h3>
<p>çŸ©å½¢ç»„ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªå†…åµŒ <code>VText</code> æ–‡æœ¬ç»„ä»¶çš„ä¸€ä¸ª <code>DIV</code></p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div class=&quot;rect-shape&quot;&gt;
        &lt;v-text :propValue=&quot;element.propValue&quot; :element=&quot;element&quot; /&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        element: {
            type: Object,
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.rect-shape {
    width: 100%;
    height: 100%;
    overflow: auto;
}
&lt;/style&gt;
</code></pre>
<p><code>VText</code> æ–‡æœ¬ç»„ä»¶æœ‰çš„åŠŸèƒ½å®ƒéƒ½æœ‰ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„æ”¾å¤§ç¼©å°ã€‚</p>
<figure data-type="image" tabindex="19"><img src="https://blog.luyu.icu/post-images/1613507388868.gif" alt="" loading="lazy"></figure>
<h3 id="21-é”å®šç»„ä»¶">21. é”å®šç»„ä»¶</h3>
<p>é”å®šç»„ä»¶ä¸»è¦æ˜¯çœ‹åˆ° <code>processon</code> å’Œå¢¨åˆ€æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œäºæ˜¯æˆ‘é¡ºä¾¿å®ç°äº†ã€‚é”å®šç»„ä»¶çš„å…·ä½“éœ€æ±‚ä¸ºï¼šä¸èƒ½ç§»åŠ¨ã€æ”¾å¤§ç¼©å°ã€æ—‹è½¬ã€å¤åˆ¶ã€ç²˜è´´ç­‰ï¼Œåªèƒ½è¿›è¡Œè§£é”æ“ä½œã€‚<br>
å®ƒçš„å®ç°åŸç†ä¹Ÿä¸éš¾ï¼š</p>
<ol>
<li>åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸ŠåŠ ä¸€ä¸ª <code>isLock</code> å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦é”å®šç»„ä»¶ã€‚</li>
<li>åœ¨ç‚¹å‡»ç»„ä»¶æ—¶ï¼Œæ ¹æ® <code>isLock</code> æ˜¯å¦ä¸º <code>true</code> æ¥éšè—ç»„ä»¶ä¸Šçš„å…«ä¸ªç‚¹å’Œæ—‹è½¬å›¾æ ‡ã€‚</li>
<li>ä¸ºäº†çªå‡ºä¸€ä¸ªç»„ä»¶è¢«é”å®šï¼Œç»™å®ƒåŠ ä¸Šé€æ˜åº¦å±æ€§å’Œä¸€ä¸ªé”çš„å›¾æ ‡ã€‚</li>
<li>å¦‚æœç»„ä»¶è¢«é”å®šï¼Œç½®ç°ä¸Šé¢æ‰€è¯´çš„éœ€æ±‚å¯¹åº”çš„æŒ‰é’®ï¼Œä¸èƒ½è¢«ç‚¹å‡»ã€‚</li>
</ol>
<p>ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">export const commonAttr = {
    animations: [],
    events: {},
    groupStyle: {}, // å½“ä¸€ä¸ªç»„ä»¶æˆä¸º Group çš„å­ç»„ä»¶æ—¶ä½¿ç”¨
    isLock: false, // æ˜¯å¦é”å®šç»„ä»¶
}
</code></pre>
<pre><code class="language-html">&lt;el-button @click=&quot;decompose&quot; 
:disabled=&quot;!curComponent || curComponent.isLock || curComponent.component != 'Group'&quot;&gt;æ‹†åˆ†&lt;/el-button&gt;

&lt;el-button @click=&quot;lock&quot; :disabled=&quot;!curComponent || curComponent.isLock&quot;&gt;é”å®š&lt;/el-button&gt;
&lt;el-button @click=&quot;unlock&quot; :disabled=&quot;!curComponent || !curComponent.isLock&quot;&gt;è§£é”&lt;/el-button&gt;
</code></pre>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;contextmenu&quot; v-show=&quot;menuShow&quot; :style=&quot;{ top: menuTop + 'px', left: menuLeft + 'px' }&quot;&gt;
        &lt;ul @mouseup=&quot;handleMouseUp&quot;&gt;
            &lt;template v-if=&quot;curComponent&quot;&gt;
                &lt;template v-if=&quot;!curComponent.isLock&quot;&gt;
                    &lt;li @click=&quot;copy&quot;&gt;å¤åˆ¶&lt;/li&gt;
                    &lt;li @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
                    &lt;li @click=&quot;cut&quot;&gt;å‰ªåˆ‡&lt;/li&gt;
                    &lt;li @click=&quot;deleteComponent&quot;&gt;åˆ é™¤&lt;/li&gt;
                    &lt;li @click=&quot;lock&quot;&gt;é”å®š&lt;/li&gt;
                    &lt;li @click=&quot;topComponent&quot;&gt;ç½®é¡¶&lt;/li&gt;
                    &lt;li @click=&quot;bottomComponent&quot;&gt;ç½®åº•&lt;/li&gt;
                    &lt;li @click=&quot;upComponent&quot;&gt;ä¸Šç§»&lt;/li&gt;
                    &lt;li @click=&quot;downComponent&quot;&gt;ä¸‹ç§»&lt;/li&gt;
                &lt;/template&gt;
                &lt;li v-else @click=&quot;unlock&quot;&gt;è§£é”&lt;/li&gt;
            &lt;/template&gt;
            &lt;li v-else @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<figure data-type="image" tabindex="20"><img src="https://blog.luyu.icu/post-images/1613507515799.gif" alt="" loading="lazy"></figure>
<h3 id="22-å¿«æ·é”®">22. å¿«æ·é”®</h3>
<p>æ”¯æŒå¿«æ·é”®ä¸»è¦æ˜¯ä¸ºäº†æå‡å¼€å‘æ•ˆç‡ï¼Œç”¨é¼ æ ‡ç‚¹ç‚¹ç‚¹æ¯•ç«Ÿæ²¡æœ‰æŒ‰é”®ç›˜å¿«ã€‚ç›®å‰å¿«æ·é”®æ”¯æŒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<pre><code>const ctrlKey = 17, 
    vKey = 86, // ç²˜è´´
    cKey = 67, // å¤åˆ¶
    xKey = 88, // å‰ªåˆ‡

    yKey = 89, // é‡åš
    zKey = 90, // æ’¤é”€

    gKey = 71, // ç»„åˆ
    bKey = 66, // æ‹†åˆ†

    lKey = 76, // é”å®š
    uKey = 85, // è§£é”

    sKey = 83, // ä¿å­˜
    pKey = 80, // é¢„è§ˆ
    dKey = 68, // åˆ é™¤
    deleteKey = 46, // åˆ é™¤
    eKey = 69 // æ¸…ç©ºç”»å¸ƒ
</code></pre>
<p>å®ç°åŸç†ä¸»è¦æ˜¯åˆ©ç”¨ <code>window</code> å…¨å±€ç›‘å¬æŒ‰é”®äº‹ä»¶ï¼Œåœ¨ç¬¦åˆæ¡ä»¶çš„æŒ‰é”®è§¦å‘æ—¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼š</p>
<pre><code class="language-js">// ä¸ç»„ä»¶çŠ¶æ€æ— å…³çš„æ“ä½œ
const basemap = {
    [vKey]: paste,
    [yKey]: redo,
    [zKey]: undo,
    [sKey]: save,
    [pKey]: preview,
    [eKey]: clearCanvas,
}

// ç»„ä»¶é”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ
const lockMap = {
    ...basemap,
    [uKey]: unlock,
}

// ç»„ä»¶æœªé”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ
const unlockMap = {
    ...basemap,
    [cKey]: copy,
    [xKey]: cut,
    [gKey]: compose,
    [bKey]: decompose,
    [dKey]: deleteComponent,
    [deleteKey]: deleteComponent,
    [lKey]: lock,
}

let isCtrlDown = false
// å…¨å±€ç›‘å¬æŒ‰é”®æ“ä½œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤
export function listenGlobalKeyDown() {
    window.onkeydown = (e) =&gt; {
        const { curComponent } = store.state
        if (e.keyCode == ctrlKey) {
            isCtrlDown = true
        } else if (e.keyCode == deleteKey &amp;&amp; curComponent) {
            store.commit('deleteComponent')
            store.commit('recordSnapshot')
        } else if (isCtrlDown) {
            if (!curComponent || !curComponent.isLock) {
                e.preventDefault()
                unlockMap[e.keyCode] &amp;&amp; unlockMap[e.keyCode]()
            } else if (curComponent &amp;&amp; curComponent.isLock) {
                e.preventDefault()
                lockMap[e.keyCode] &amp;&amp; lockMap[e.keyCode]()
            }
        }
    }

    window.onkeyup = (e) =&gt; {
        if (e.keyCode == ctrlKey) {
            isCtrlDown = false
        }
    }
}

</code></pre>
<p>ä¸ºäº†é˜²æ­¢å’Œæµè§ˆå™¨é»˜è®¤å¿«æ·é”®å†²çªï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š <code>e.preventDefault()</code>ã€‚</p>
<h3 id="23-ç½‘æ ¼çº¿">23. ç½‘æ ¼çº¿</h3>
<p>ç½‘æ ¼çº¿åŠŸèƒ½ä½¿ç”¨ <code>SVG</code> æ¥å®ç°ï¼š</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;svg class=&quot;grid&quot; width=&quot;100%&quot; height=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
        &lt;defs&gt;
            &lt;pattern id=&quot;smallGrid&quot; width=&quot;7.236328125&quot; height=&quot;7.236328125&quot; patternUnits=&quot;userSpaceOnUse&quot;&gt;
                &lt;path 
                    d=&quot;M 7.236328125 0 L 0 0 0 7.236328125&quot; 
                    fill=&quot;none&quot; 
                    stroke=&quot;rgba(207, 207, 207, 0.3)&quot; 
                    stroke-width=&quot;1&quot;&gt;
                &lt;/path&gt;
            &lt;/pattern&gt;
            &lt;pattern id=&quot;grid&quot; width=&quot;36.181640625&quot; height=&quot;36.181640625&quot; patternUnits=&quot;userSpaceOnUse&quot;&gt;
                &lt;rect width=&quot;36.181640625&quot; height=&quot;36.181640625&quot; fill=&quot;url(#smallGrid)&quot;&gt;&lt;/rect&gt;
                &lt;path 
                    d=&quot;M 36.181640625 0 L 0 0 0 36.181640625&quot; 
                    fill=&quot;none&quot; 
                    stroke=&quot;rgba(186, 186, 186, 0.5)&quot; 
                    stroke-width=&quot;1&quot;&gt;
                &lt;/path&gt;
            &lt;/pattern&gt;
        &lt;/defs&gt;
        &lt;rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;url(#grid)&quot;&gt;&lt;/rect&gt;
    &lt;/svg&gt;
&lt;/template&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.grid {
    position: absolute;
    top: 0;
    left: 0;
}
&lt;/style&gt;

</code></pre>
<p>å¯¹ SVG ä¸å¤ªæ‡‚çš„ï¼Œå»ºè®®çœ‹ä¸€ä¸‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG">MDN çš„æ•™ç¨‹</a>ã€‚</p>
<h3 id="24-ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼">24. ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼</h3>
<p>åœ¨ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘å·²ç»åˆ†æè¿‡å¿«ç…§çš„å®ç°åŸç†ã€‚</p>
<pre><code class="language-js">snapshotData: [], // ç¼–è¾‘å™¨å¿«ç…§æ•°æ®
snapshotIndex: -1, // å¿«ç…§ç´¢å¼•
        
undo(state) {
    if (state.snapshotIndex &gt;= 0) {
        state.snapshotIndex--
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

redo(state) {
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotIndex++
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

setComponentData(state, componentData = []) {
    Vue.set(state, 'componentData', componentData)
},

recordSnapshot(state) {
    // æ·»åŠ æ–°çš„å¿«ç…§
    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)
    // åœ¨ undo è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ æ–°çš„å¿«ç…§æ—¶ï¼Œè¦å°†å®ƒåé¢çš„å¿«ç…§æ¸…ç†æ‰
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)
    }
},
</code></pre>
<p>ç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ç¼–è¾‘å™¨çš„å¿«ç…§æ•°æ®ã€‚ä¿å­˜å¿«ç…§å°±æ˜¯ä¸åœåœ°æ‰§è¡Œ <code>push()</code> æ“ä½œï¼Œå°†å½“å‰çš„ç¼–è¾‘å™¨æ•°æ®æ¨å…¥ <code>snapshotData</code> æ•°ç»„ï¼Œå¹¶å¢åŠ å¿«ç…§ç´¢å¼• <code>snapshotIndexã€‚</code><br>
ç”±äºæ¯ä¸€æ¬¡æ·»åŠ å¿«ç…§éƒ½æ˜¯å°†å½“å‰ç¼–è¾‘å™¨çš„æ‰€æœ‰ç»„ä»¶æ•°æ®æ¨å…¥ <code>snapshotData</code>ï¼Œä¿å­˜çš„å¿«ç…§æ•°æ®è¶Šå¤šå ç”¨çš„å†…å­˜å°±è¶Šå¤šã€‚å¯¹æ­¤æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>é™åˆ¶å¿«ç…§æ­¥æ•°ï¼Œä¾‹å¦‚åªèƒ½ä¿å­˜ 50 æ­¥çš„å¿«ç…§æ•°æ®ã€‚</li>
<li>ä¿å­˜å¿«ç…§åªä¿å­˜å·®å¼‚éƒ¨åˆ†ã€‚</li>
</ol>
<p>ç°åœ¨è¯¦ç»†æè¿°ä¸€ä¸‹ç¬¬äºŒä¸ªè§£å†³æ–¹æ¡ˆã€‚<br>
å‡è®¾ä¾æ¬¡å¾€ç”»å¸ƒä¸Šæ·»åŠ  a b c d å››ä¸ªç»„ä»¶ï¼Œåœ¨åŸæ¥çš„å®ç°ä¸­ï¼Œå¯¹åº”çš„ <code>snapshotData</code> æ•°æ®ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [a],
  [a, b],
  [a, b, c],
  [a, b, c, d],
]
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥å‘ç°ï¼Œæ¯ä¸€ç›¸é‚»çš„å¿«ç…§ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€æ­¥çš„å¿«ç…§æ·»åŠ ä¸€ä¸ªç±»å‹å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæ­¤æ¬¡æ“ä½œæ˜¯æ·»åŠ è¿˜æ˜¯åˆ é™¤ã€‚</p>
<p>é‚£ä¹ˆä¸Šé¢æ·»åŠ å››ä¸ªç»„ä»¶çš„æ“ä½œï¼Œæ‰€å¯¹åº”çš„ <code>snapshotData</code> æ•°æ®ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
]
</code></pre>
<p>å¦‚æœæˆ‘ä»¬è¦åˆ é™¤ c ç»„ä»¶ï¼Œé‚£ä¹ˆ <code>snapshotData</code> æ•°æ®å°†å˜ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
  [{ type: 'remove', value: c }],
]
</code></pre>
<p>é‚£å¦‚ä½•ä½¿ç”¨ç°åœ¨çš„å¿«ç…§æ•°æ®å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬éœ€è¦éå†ä¸€éå¿«ç…§æ•°æ®ï¼Œæ¥ç”Ÿæˆç¼–è¾‘å™¨çš„ç»„ä»¶æ•°æ® <code>componentData</code>ã€‚å‡è®¾åœ¨ä¸Šé¢çš„æ•°æ®åŸºç¡€ä¸Šæ‰§è¡Œäº† <code>undo</code> æ’¤é”€æ“ä½œï¼š</p>
<pre><code>// snapshotData
// å¿«ç…§ç´¢å¼• snapshotIndex æ­¤æ—¶ä¸º 3
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
  [{ type: 'remove', value: c }],
]
</code></pre>
<ol>
<li>snapshotData[0] ç±»å‹ä¸º addï¼Œå°†ç»„ä»¶ a æ·»åŠ åˆ° componentData ä¸­ï¼Œæ­¤æ—¶ componentData ä¸º [a]</li>
<li>ä¾æ¬¡ç±»æ¨ [a, b]</li>
<li>[a, b, c]</li>
<li>[a, b, c, d]</li>
</ol>
<p>å¦‚æœè¿™æ—¶æ‰§è¡Œ <code>redo</code> é‡åšæ“ä½œï¼Œå¿«ç…§ç´¢å¼• <code>snapshotIndex</code> å˜ä¸º 4ã€‚å¯¹åº”çš„å¿«ç…§æ•°æ®ç±»å‹ä¸º <code>type: 'remove'</code>ï¼Œ ç§»é™¤ç»„ä»¶ cã€‚åˆ™æ•°ç»„æ•°æ®ä¸º<code>[a, b, d]</code>ã€‚<br>
è¿™ç§æ–¹æ³•å…¶å®å°±æ˜¯æ—¶é—´æ¢ç©ºé—´ï¼Œè™½ç„¶æ¯ä¸€æ¬¡ä¿å­˜çš„å¿«ç…§æ•°æ®åªæœ‰ä¸€é¡¹ï¼Œä½†æ¯æ¬¡éƒ½å¾—éå†ä¸€éæ‰€æœ‰çš„å¿«ç…§æ•°æ®ã€‚ä¸¤ç§æ–¹æ³•éƒ½ä¸å®Œç¾ï¼Œè¦ä½¿ç”¨å“ªç§å–å†³äºä½ ï¼Œç›®å‰æˆ‘ä»åœ¨ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://blog.luyu.icu/tag/vue/" class="tag">
                    vue
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://blog.luyu.icu/post/1yIc3meiD/">
                  <h3 class="post-title">
                    å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆäºŒï¼‰
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'Iv1.f884a49efdfbd7b8',
        clientSecret: '2af22a1c3ddd23d6203cf5aaa13c147df67fb61a',
        repo: 'panyu97py.github.io',
        owner: 'panyu97py',
        admin: ['panyu97py'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
