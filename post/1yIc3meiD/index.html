<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆäºŒï¼‰ | LuYu&#39;s Blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.luyu.icu/favicon.ico?v=1616840764869">
<link rel="stylesheet" href="https://blog.luyu.icu/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="æœ¬æ–‡æ‘˜è‡ªæ˜é‡‘,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘
ä¸Šä¸€ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹ï¼š

ç¼–è¾‘å™¨
è‡ªå®šä¹‰ç»„ä»¶
æ‹–æ‹½
åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§
æ”¾å¤§ç¼©å°
æ’¤æ¶ˆã€é‡åš
ç»„ä»¶å±æ€§è®¾ç½®
å¸é™„
é¢„è§ˆã€ä¿å­˜ä»£ç 
ç»‘å®šäº‹ä»¶
ç»‘å®šåŠ¨ç”»
å¯¼å…¥ PSD
..." />
    <meta name="keywords" content="vue" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://blog.luyu.icu">
        <img src="https://blog.luyu.icu/images/avatar.png?v=1616840764869" class="site-logo">
        <h1 class="site-title">LuYu&#39;s Blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/panyu97py" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.luyu.icu/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆäºŒï¼‰</h2>
            <div class="post-date">2021-02-17</div>
            
            <div class="post-content" v-pre>
              <p>æœ¬æ–‡æ‘˜è‡ª<a href="https://juejin.cn/post/6918881497264947207">æ˜é‡‘</a>,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘</p>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹ï¼š</p>
<ol>
<li>ç¼–è¾‘å™¨</li>
<li>è‡ªå®šä¹‰ç»„ä»¶</li>
<li>æ‹–æ‹½</li>
<li>åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</li>
<li>æ”¾å¤§ç¼©å°</li>
<li>æ’¤æ¶ˆã€é‡åš</li>
<li>ç»„ä»¶å±æ€§è®¾ç½®</li>
<li>å¸é™„</li>
<li>é¢„è§ˆã€ä¿å­˜ä»£ç </li>
<li>ç»‘å®šäº‹ä»¶</li>
<li>ç»‘å®šåŠ¨ç”»</li>
<li>å¯¼å…¥ PSD</li>
<li>æ‰‹æœºæ¨¡å¼</li>
</ol>
<p>ç°åœ¨è¿™ç¯‡æ–‡ç« ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå†è¡¥å…… 4 ä¸ªåŠŸèƒ½ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æ‹–æ‹½æ—‹è½¬</li>
<li>å¤åˆ¶ç²˜è´´å‰ªåˆ‡</li>
<li>æ•°æ®äº¤äº’</li>
<li>å‘å¸ƒ<br>
å’Œä¸Šç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘å·²ç»å°†æ–°åŠŸèƒ½çš„ä»£ç æ›´æ–°åˆ°äº† githubï¼š</li>
</ul>
<p><a href="https://github.com/woai3c/visual-drag-demo">github é¡¹ç›®åœ°å€</a></p>
<p><a href="https://woai3c.github.io/visual-drag-demo/#/">åœ¨çº¿é¢„è§ˆ</a></p>
<p><strong>å‹å–„æé†’</strong>ï¼š å»ºè®®ç»“åˆæºç ä¸€èµ·é˜…è¯»ï¼Œæ•ˆæœæ›´å¥½ï¼ˆè¿™ä¸ª DEMO ä½¿ç”¨çš„æ˜¯ Vue æŠ€æœ¯æ ˆï¼‰ã€‚</p>
<h3 id="14-æ‹–æ‹½æ—‹è½¬">14. æ‹–æ‹½æ—‹è½¬</h3>
<p>åœ¨å†™ä¸Šä¸€ç¯‡æ–‡ç« æ—¶ï¼ŒåŸæ¥çš„ DEMO å·²ç»å¯ä»¥æ”¯æŒæ—‹è½¬åŠŸèƒ½äº†ã€‚ä½†æ˜¯è¿™ä¸ªæ—‹è½¬åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä¸æ”¯æŒæ‹–æ‹½æ—‹è½¬ã€‚</li>
<li>æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¸æ­£ç¡®ã€‚</li>
<li>æ—‹è½¬åçš„è‡ªåŠ¨å¸é™„ä¸æ­£ç¡®ã€‚</li>
<li>æ—‹è½¬åå…«ä¸ªå¯ä¼¸ç¼©ç‚¹çš„å…‰æ ‡ä¸æ­£ç¡®ã€‚</li>
</ol>
<p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†é€ä¸€è§£å†³è¿™å››ä¸ªé—®é¢˜ã€‚</p>
<h4 id="æ‹–æ‹½æ—‹è½¬">æ‹–æ‹½æ—‹è½¬</h4>
<p>æ‹–æ‹½æ—‹è½¬éœ€è¦ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2"><code>Math.atan2()</code></a>å‡½æ•°ã€‚</p>
<blockquote>
<p>Math.atan2() è¿”å›ä»åŸç‚¹(0,0)åˆ°(x,y)ç‚¹çš„çº¿æ®µä¸xè½´æ­£æ–¹å‘ä¹‹é—´çš„å¹³é¢è§’åº¦(å¼§åº¦å€¼)ï¼Œä¹Ÿå°±æ˜¯Math.atan2(y,x)ã€‚Math.atan2(y,x)ä¸­çš„yå’Œxéƒ½æ˜¯ç›¸å¯¹äºåœ†ç‚¹(0,0)çš„è·ç¦»ã€‚</p>
</blockquote>
<p>ç®€å•çš„è¯´å°±æ˜¯ä»¥ç»„ä»¶ä¸­å¿ƒç‚¹ä¸ºåŸç‚¹<code>(centerX,centerY)</code>ï¼Œç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡æ—¶çš„åæ ‡è®¾ä¸º <code>(startX,startY)</code>ï¼Œé¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º<code>(curX,curY)</code>ã€‚æ—‹è½¬è§’åº¦å¯ä»¥é€šè¿‡ <code>(startX,startY)</code>å’Œ <code>(curX,curY)</code>è®¡ç®—å¾—å‡ºã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613501916438.png" alt="" loading="lazy"></p>
<p>é‚£æˆ‘ä»¬å¦‚ä½•å¾—åˆ°ä»ç‚¹ <code>(startX,startY)</code>åˆ°ç‚¹<code>(curX,curY)</code>ä¹‹é—´çš„æ—‹è½¬è§’åº¦å‘¢ï¼Ÿ</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œé¼ æ ‡ç‚¹å‡»æ—¶çš„åæ ‡è®¾ä¸º<code>(startX,startY)</code>ï¼š</p>
<pre><code class="language-js">const startY = e.clientY
const startX = e.clientX
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">// è·å–ç»„ä»¶ä¸­å¿ƒç‚¹ä½ç½®
const rect = this.$el.getBoundingClientRect()
const centerX = rect.left + rect.width / 2
const centerY = rect.top + rect.height / 2
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼ŒæŒ‰ä½é¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º<code>(curX,curY)</code>ï¼š</p>
<pre><code class="language-js">const curX = moveEvent.clientX
const curY = moveEvent.clientY
</code></pre>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œåˆ†åˆ«ç®—å‡º<code>(startX,startY)</code>å’Œ<code>(curX,curY)</code> å¯¹åº”çš„è§’åº¦ï¼Œå†å°†å®ƒä»¬ç›¸å‡å¾—å‡ºæ—‹è½¬çš„è§’åº¦ã€‚å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„å°±æ˜¯ <code>Math.atan2()</code>æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼§åº¦ï¼Œå› æ­¤è¿˜éœ€è¦å°†å¼§åº¦è½¬åŒ–ä¸ºè§’åº¦ã€‚æ‰€ä»¥å®Œæ•´çš„ä»£ç ä¸ºï¼š</p>
<pre><code class="language-js">// æ—‹è½¬å‰çš„è§’åº¦
const rotateDegreeBefore = Math.atan2(startY - centerY, startX - centerX) / (Math.PI / 180)
// æ—‹è½¬åçš„è§’åº¦
const rotateDegreeAfter = Math.atan2(curY - centerY, curX - centerX) / (Math.PI / 180)
// è·å–æ—‹è½¬çš„è§’åº¦å€¼ï¼Œ startRotate ä¸ºåˆå§‹è§’åº¦å€¼
pos.rotate = startRotate + rotateDegreeAfter - rotateDegreeBefore
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613502114333.gif" alt="" loading="lazy"></figure>
<h4 id="æ”¾å¤§ç¼©å°">æ”¾å¤§ç¼©å°</h4>
<p>ç»„ä»¶æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¼šæœ‰ BUGã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613502171703.gif" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ”¾å¤§ç¼©å°æ—¶ä¼šå‘ç”Ÿç§»ä½ã€‚å¦å¤–ä¼¸ç¼©çš„æ–¹å‘å’Œæˆ‘ä»¬æ‹–åŠ¨çš„æ–¹å‘ä¹Ÿä¸å¯¹ã€‚é€ æˆè¿™ä¸€ BUG çš„åŸå› æ˜¯ï¼šå½“åˆè®¾è®¡æ”¾å¤§ç¼©å°åŠŸèƒ½æ²¡æœ‰è€ƒè™‘åˆ°æ—‹è½¬çš„åœºæ™¯ã€‚æ‰€ä»¥æ— è®ºæ—‹è½¬å¤šå°‘è§’åº¦ï¼Œæ”¾å¤§ç¼©å°ä»ç„¶æ˜¯æŒ‰æ²¡æ—‹è½¬æ—¶è®¡ç®—çš„ã€‚</p>
<p>ä¸‹é¢å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613502210577.png" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ²¡æœ‰æ—‹è½¬æ—¶ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸Šæ‹–åŠ¨ï¼Œåªéœ€ç”¨ <code>y2 - y1</code> å°±å¯ä»¥å¾—å‡ºæ‹–åŠ¨è·ç¦»<code>s</code>ã€‚è¿™æ—¶å°†ç»„ä»¶åŸæ¥çš„é«˜åº¦åŠ ä¸Š <code>s</code> å°±èƒ½å¾—å‡ºæ–°çš„é«˜åº¦ï¼ŒåŒæ—¶å°†ç»„ä»¶çš„ <code>top</code>ã€<code>left</code> å±æ€§æ›´æ–°ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://blog.luyu.icu/post-images/1613502283095.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨æ—‹è½¬ 180 åº¦ï¼Œå¦‚æœè¿™æ—¶æ‹–ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼Œæˆ‘ä»¬æœŸå¾…çš„ç»“æœæ˜¯ç»„ä»¶é«˜åº¦å¢åŠ ã€‚ä½†è¿™æ—¶è®¡ç®—çš„æ–¹å¼å’ŒåŸæ¥æ²¡æ—‹è½¬æ—¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç»“æœå’Œæˆ‘ä»¬æœŸå¾…çš„ç›¸åï¼Œç»„ä»¶çš„é«˜åº¦å°†ä¼šå˜å°ï¼ˆå¦‚æœä¸ç†è§£è¿™ä¸ªç°è±¡ï¼Œå¯ä»¥æƒ³åƒä¸€ä¸‹æ²¡æœ‰æ—‹è½¬çš„é‚£å¼ å›¾ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼‰ã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://blog.luyu.icu/post-images/1613502327476.gif" alt="" loading="lazy"></figure>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä» github ä¸Šçš„ä¸€ä¸ªé¡¹ç›®<a href="https://github.com/shenhudong/snapping-demo/wiki/corner-handle"> <code>snapping-demo</code> </a>æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šå°†æ”¾å¤§ç¼©å°å’Œæ—‹è½¬è§’åº¦å…³è”èµ·æ¥ã€‚</p>
<h5 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h5>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://blog.luyu.icu/post-images/1613502421743.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨æˆ‘ä»¬å°†ä¸€æ­¥æ­¥åˆ†æå¦‚ä½•å¾—å‡ºæ‹‰ä¼¸åçš„ç»„ä»¶çš„æ­£ç¡®å¤§å°å’Œä½ç§»ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼ŒæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ top left å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const center = {
    x: style.left + style.width / 2,
    y: style.top + style.height / 2,
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç”¨<strong>å½“å‰ç‚¹å‡»åæ ‡</strong>å’Œ<strong>ç»„ä»¶ä¸­å¿ƒç‚¹ç®—</strong>å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š</p>
<pre><code class="language-js">// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯
const editorRectInfo = document.querySelector('#editor').getBoundingClientRect()

// å½“å‰ç‚¹å‡»åæ ‡
const curPoint = {
    x: e.clientX - editorRectInfo.left,
    y: e.clientY - editorRectInfo.top,
}

// è·å–å¯¹ç§°ç‚¹çš„åæ ‡
const symmetricPoint = {
    x: center.x - (curPoint.x - center.x),
    y: center.y - (curPoint.y - center.y),
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const curPositon = {
    x: moveEvent.clientX - editorRectInfo.left,
    y: moveEvent.clientY - editorRectInfo.top,
}

const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)

// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡
function getCenterPoint(p1, p2) {
    return {
        x: p1.x + ((p2.x - p1.x) / 2),
        y: p1.y + ((p2.y - p1.y) / 2),
    }
}
</code></pre>
<p>ç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„<code>xy</code>è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.luyu.icu/post-images/1613502562307.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ <code>currentPosition</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newTopLeftPoint</code>ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ <code>sPoint</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newBottomRightPoint</code>ã€‚<br>
å¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡
 * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡
 * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ
 * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦
 * @return  {Object}         æ—‹è½¬åçš„åæ ‡
 * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼
 */
export function calculateRotatedPointCoordinate(point, center, rotate) {
    /**
     * æ—‹è½¬å…¬å¼ï¼š
     *  ç‚¹a(x, y)
     *  æ—‹è½¬ä¸­å¿ƒc(x, y)
     *  æ—‹è½¬åç‚¹n(x, y)
     *  æ—‹è½¬è§’åº¦Î¸                tan ??
     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx
     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy
     */

    return {
        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,
        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,
    }
}
</code></pre>
<p>ä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»<a href="https://www.zhihu.com/question/67425734/answer/252724399">çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”</a>ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://blog.luyu.icu/post-images/1613502683980.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="9"><img src="https://blog.luyu.icu/post-images/1613502701696.png" alt="" loading="lazy"></figure>
<p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼<code>top</code>ã€<code>left</code> ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, pointInfo) {
    const { symmetricPoint } = pointInfo
    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://blog.luyu.icu/post-images/1613502785374.gif" alt="" loading="lazy"></figure>
<h4 id="è‡ªåŠ¨å¸é™„">è‡ªåŠ¨å¸é™„</h4>
<p>è‡ªåŠ¨å¸é™„æ˜¯æ ¹æ®ç»„ä»¶çš„å››ä¸ªå±æ€§ <code>top</code>ã€<code>left</code> ã€<code>width</code> ã€<code>height</code> è®¡ç®—çš„ï¼Œåœ¨å°†ç»„ä»¶è¿›è¡Œæ—‹è½¬åï¼Œè¿™äº›å±æ€§çš„å€¼æ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥æ— è®ºç»„ä»¶æ—‹è½¬å¤šå°‘åº¦ï¼Œå¸é™„æ—¶ä»ç„¶æŒ‰æœªæ—‹è½¬æ—¶è®¡ç®—ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„ <code>top</code>ã€<code>left</code> ã€<code>width</code> ã€<code>height</code> å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚</p>
<figure data-type="image" tabindex="11"><img src="https://blog.luyu.icu/post-images/1613502878822.png" alt="" loading="lazy"></figure>
<p>å¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„ <code>height</code> å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„é«˜åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±å‡ºç°äº†å¸é™„ä¸æ­£ç¡®çš„ BUGã€‚</p>
<figure data-type="image" tabindex="12"><img src="https://blog.luyu.icu/post-images/1613502923904.gif" alt="" loading="lazy"></figure>
<h5 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h5>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬éœ€è¦æ‹¿ç»„ä»¶æ—‹è½¬åçš„å¤§å°åŠä½ç§»æ¥åšå¸é™„å¯¹æ¯”ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸è¦æ‹¿ç»„ä»¶å®é™…çš„å±æ€§æ¥å¯¹æ¯”ï¼Œè€Œæ˜¯æ‹¿æˆ‘ä»¬çœ‹åˆ°çš„å¤§å°å’Œä½ç§»åšå¯¹æ¯”ã€‚</p>
<figure data-type="image" tabindex="13"><img src="https://blog.luyu.icu/post-images/1613502993620.png" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ—‹è½¬åçš„ç»„ä»¶åœ¨ x è½´ä¸Šçš„æŠ•å°„é•¿åº¦ä¸ºä¸¤æ¡çº¢çº¿é•¿åº¦ä¹‹å’Œã€‚è¿™ä¸¤æ¡çº¢çº¿çš„é•¿åº¦å¯ä»¥é€šè¿‡æ­£å¼¦å’Œä½™å¼¦ç®—å‡ºï¼Œå·¦è¾¹çš„çº¢çº¿ç”¨æ­£å¼¦è®¡ç®—ï¼Œå³è¾¹çš„çº¢çº¿ç”¨ä½™å¼¦è®¡ç®—ï¼š</p>
<pre><code class="language-js">const newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)
</code></pre>
<p>åŒç†ï¼Œé«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p>
<pre><code class="language-js">const newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)
</code></pre>
<p>æ–°çš„å®½åº¦å’Œé«˜åº¦æœ‰äº†ï¼Œå†æ ¹æ®ç»„ä»¶åŸæœ‰çš„ <code>top</code>ã€ <code>left</code> å±æ€§ï¼Œå¯ä»¥å¾—å‡ºç»„ä»¶æ—‹è½¬åæ–°çš„<code>top</code>ã€ <code>left</code>  å±æ€§ã€‚ä¸‹é¢é™„ä¸Šå®Œæ•´ä»£ç ï¼š</p>
<pre><code class="language-js">translateComponentStyle(style) {
    style = { ...style }
    if (style.rotate != 0) {
        const newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)
        const diffX = (style.width - newWidth) / 2
        style.left += diffX
        style.right = style.left + newWidth

        const newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)
        const diffY = (newHeight - style.height) / 2
        style.top -= diffY
        style.bottom = style.top + newHeight

        style.width = newWidth
        style.height = newHeight
    } else {
        style.bottom = style.top + style.height
        style.right = style.left + style.width
    }

    return style
}
</code></pre>
<p>ç»è¿‡ä¿®å¤åï¼Œå¸é™„ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†</p>
<figure data-type="image" tabindex="14"><img src="https://blog.luyu.icu/post-images/1613503143257.gif" alt="" loading="lazy"></figure>
<h4 id="å…‰æ ‡">å…‰æ ‡</h4>
<p>å…‰æ ‡å’Œå¯æ‹–åŠ¨çš„æ–¹å‘ä¸å¯¹ï¼Œæ˜¯å› ä¸ºå…«ä¸ªç‚¹çš„å…‰æ ‡æ˜¯å›ºå®šè®¾ç½®çš„ï¼Œæ²¡æœ‰éšç€è§’åº¦å˜åŒ–è€Œå˜åŒ–ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://blog.luyu.icu/post-images/1613503197769.gif" alt="" loading="lazy"></figure>
<h5 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h5>
<p>ç”±äº <code>360 / 8 = 45</code>ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ–¹å‘åˆ†é… 45 åº¦çš„èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´å¯¹åº”ä¸€ä¸ªå…‰æ ‡ã€‚åŒæ—¶ä¸ºæ¯ä¸ªæ–¹å‘è®¾ç½®ä¸€ä¸ªåˆå§‹è§’åº¦ï¼Œä¹Ÿå°±æ˜¯æœªæ—‹è½¬æ—¶ç»„ä»¶æ¯ä¸ªæ–¹å‘å¯¹åº”çš„è§’åº¦ã€‚</p>
<figure data-type="image" tabindex="16"><img src="https://blog.luyu.icu/post-images/1613503255637.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">pointList: ['lt', 't', 'rt', 'r', 'rb', 'b', 'lb', 'l'], // å…«ä¸ªæ–¹å‘
initialAngle: { // æ¯ä¸ªç‚¹å¯¹åº”çš„åˆå§‹è§’åº¦
    lt: 0,
    t: 45,
    rt: 90,
    r: 135,
    rb: 180,
    b: 225,
    lb: 270,
    l: 315,
},
angleToCursor: [ // æ¯ä¸ªèŒƒå›´çš„è§’åº¦å¯¹åº”çš„å…‰æ ‡
    { start: 338, end: 23, cursor: 'nw' },
    { start: 23, end: 68, cursor: 'n' },
    { start: 68, end: 113, cursor: 'ne' },
    { start: 113, end: 158, cursor: 'e' },
    { start: 158, end: 203, cursor: 'se' },
    { start: 203, end: 248, cursor: 's' },
    { start: 248, end: 293, cursor: 'sw' },
    { start: 293, end: 338, cursor: 'w' },
],
cursors: {},
</code></pre>
<p>è®¡ç®—æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ol>
<li>å‡è®¾ç°åœ¨ç»„ä»¶å·²æ—‹è½¬äº†ä¸€å®šçš„è§’åº¦ aã€‚</li>
<li>éå†å…«ä¸ªæ–¹å‘ï¼Œç”¨æ¯ä¸ªæ–¹å‘çš„åˆå§‹è§’åº¦ + a å¾—å‡ºç°åœ¨çš„è§’åº¦ bã€‚</li>
<li>éå† angleToCursor æ•°ç»„ï¼Œçœ‹çœ‹ b åœ¨å“ªä¸€ä¸ªèŒƒå›´ä¸­ï¼Œç„¶åå°†å¯¹åº”çš„å…‰æ ‡è¿”å›ã€‚</li>
</ol>
<p>ç»è¿‡ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤å°±å¯ä»¥è®¡ç®—å‡ºç»„ä»¶æ—‹è½¬åæ­£ç¡®çš„å…‰æ ‡æ–¹å‘ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">getCursor() {
    const { angleToCursor, initialAngle, pointList, curComponent } = this
    const rotate = (curComponent.style.rotate + 360) % 360 // é˜²æ­¢è§’åº¦æœ‰è´Ÿæ•°ï¼Œæ‰€ä»¥ + 360
    const result = {}
    let lastMatchIndex = -1 // ä»ä¸Šä¸€ä¸ªå‘½ä¸­çš„è§’åº¦çš„ç´¢å¼•å¼€å§‹åŒ¹é…ä¸‹ä¸€ä¸ªï¼Œé™ä½æ—¶é—´å¤æ‚åº¦
    pointList.forEach(point =&gt; {
        const angle = (initialAngle[point] + rotate) % 360
        const len = angleToCursor.length
        while (true) {
            lastMatchIndex = (lastMatchIndex + 1) % len
            const angleLimit = angleToCursor[lastMatchIndex]
            if (angle &lt; 23 || angle &gt;= 338) {
                result[point] = 'nw-resize'
                return
            }

            if (angleLimit.start &lt;= angle &amp;&amp; angle &lt; angleLimit.end) {
                result[point] = angleLimit.cursor + '-resize'
                return
            }
        }
    })

    return result
},
</code></pre>
<figure data-type="image" tabindex="17"><img src="https://blog.luyu.icu/post-images/1613503358536.gif" alt="" loading="lazy"></figure>
<p>ä»ä¸Šé¢çš„åŠ¨å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œç°åœ¨å…«ä¸ªæ–¹å‘ä¸Šçš„å…‰æ ‡æ˜¯å¯ä»¥æ­£ç¡®æ˜¾ç¤ºçš„ã€‚</p>
<h3 id="15-å¤åˆ¶ç²˜è´´å‰ªåˆ‡">15. å¤åˆ¶ç²˜è´´å‰ªåˆ‡</h3>
<p>ç›¸å¯¹äºæ‹–æ‹½æ—‹è½¬åŠŸèƒ½ï¼Œå¤åˆ¶ç²˜è´´å°±æ¯”è¾ƒç®€å•äº†ã€‚</p>
<pre><code class="language-js">const ctrlKey = 17, vKey = 86, cKey = 67, xKey = 88
let isCtrlDown = false

window.onkeydown = (e) =&gt; {
    if (e.keyCode == ctrlKey) {
        isCtrlDown = true
    } else if (isCtrlDown &amp;&amp; e.keyCode == cKey) {
        this.$store.commit('copy')
    } else if (isCtrlDown &amp;&amp; e.keyCode == vKey) {
        this.$store.commit('paste')
    } else if (isCtrlDown &amp;&amp; e.keyCode == xKey) {
        this.$store.commit('cut')
    }
}

window.onkeyup = (e) =&gt; {
    if (e.keyCode == ctrlKey) {
        isCtrlDown = false
    }
}
</code></pre>
<p>ç›‘å¬ç”¨æˆ·çš„æŒ‰é”®æ“ä½œï¼Œåœ¨æŒ‰ä¸‹ç‰¹å®šæŒ‰é”®æ—¶è§¦å‘å¯¹åº”çš„æ“ä½œã€‚</p>
<h5 id="å¤åˆ¶æ“ä½œ">å¤åˆ¶æ“ä½œ</h5>
<p>åœ¨ <code>vuex</code> ä¸­ä½¿ç”¨ <code>copyData</code> æ¥è¡¨ç¤ºå¤åˆ¶çš„æ•°æ®ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹ <code>ctrl + c</code> æ—¶ï¼Œå°†å½“å‰ç»„ä»¶æ•°æ®æ·±æ‹·è´åˆ° <code>copyData</code>ã€‚</p>
<pre><code class="language-js">copy(state) {
    state.copyData = {
        data: deepCopy(state.curComponent),
        index: state.curComponentIndex,
    }
},
</code></pre>
<p>åŒæ—¶éœ€è¦å°†å½“å‰ç»„ä»¶åœ¨ç»„ä»¶æ•°æ®ä¸­çš„ç´¢å¼•è®°å½•èµ·æ¥ï¼Œåœ¨å‰ªåˆ‡ä¸­è¦ç”¨åˆ°ã€‚</p>
<h5 id="ç²˜è´´æ“ä½œ">ç²˜è´´æ“ä½œ</h5>
<pre><code class="language-js">paste(state, isMouse) {
    if (!state.copyData) {
        toast('è¯·é€‰æ‹©ç»„ä»¶')
        return
    }

    const data = state.copyData.data

    if (isMouse) {
        data.style.top = state.menuTop
        data.style.left = state.menuLeft
    } else {
        data.style.top += 10
        data.style.left += 10
    }

    data.id = generateID()
    store.commit('addComponent', { component: data })
    store.commit('recordSnapshot')
    state.copyData = null
},
</code></pre>
<p>ç²˜è´´æ—¶ï¼Œå¦‚æœæ˜¯æŒ‰é”®æ“ä½œ <code>ctrl+v</code>ã€‚åˆ™å°†ç»„ä»¶çš„ <code>top</code>ã€<code>left</code> å±æ€§åŠ  10ï¼Œä»¥å…å’ŒåŸæ¥çš„ç»„ä»¶é‡å åœ¨ä¸€èµ·ã€‚å¦‚æœæ˜¯ä½¿ç”¨é¼ æ ‡å³é”®æ‰§è¡Œç²˜è´´æ“ä½œï¼Œåˆ™å°†å¤åˆ¶çš„ç»„ä»¶æ”¾åˆ°é¼ æ ‡ç‚¹å‡»å¤„ã€‚</p>
<h5 id="å‰ªåˆ‡æ“ä½œ">å‰ªåˆ‡æ“ä½œ</h5>
<pre><code class="language-js">cut(state) {
    if (!state.curComponent) {
        toast('è¯·é€‰æ‹©ç»„ä»¶')
        return
    }

    if (state.copyData) {
        store.commit('addComponent', { component: state.copyData.data, index: state.copyData.index })
        if (state.curComponentIndex &gt;= state.copyData.index) {
            // å¦‚æœå½“å‰ç»„ä»¶ç´¢å¼•å¤§äºç­‰äºæ’å…¥ç´¢å¼•ï¼Œéœ€è¦åŠ ä¸€ï¼Œå› ä¸ºå½“å‰ç»„ä»¶å¾€åç§»äº†ä¸€ä½
            state.curComponentIndex++
        }
    }

    store.commit('copy')
    store.commit('deleteComponent')
},
</code></pre>
<p>å‰ªåˆ‡æ“ä½œæœ¬è´¨ä¸Šè¿˜æ˜¯å¤åˆ¶ï¼Œåªä¸è¿‡åœ¨æ‰§è¡Œå¤åˆ¶åï¼Œéœ€è¦å°†å½“å‰ç»„ä»¶åˆ é™¤ã€‚ä¸ºäº†é¿å…ç”¨æˆ·æ‰§è¡Œå‰ªåˆ‡æ“ä½œåï¼Œä¸æ‰§è¡Œç²˜è´´æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå‰ªåˆ‡ã€‚è¿™æ—¶å°±éœ€è¦å°†åŸå…ˆå‰ªåˆ‡çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚æ‰€ä»¥å¤åˆ¶æ•°æ®ä¸­è®°å½•çš„ç´¢å¼•å°±èµ·ä½œç”¨äº†ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å°†åŸæ¥çš„æ•°æ®æ¢å¤åˆ°åŸæ¥çš„ä½ç½®ä¸­ã€‚</p>
<h5 id="å³é”®æ“ä½œ">å³é”®æ“ä½œ</h5>
<p>å³é”®æ“ä½œå’ŒæŒ‰é”®æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªåŠŸèƒ½ä¸¤ç§è§¦å‘é€”å¾„ã€‚</p>
<pre><code class="language-js">&lt;li @click=&quot;copy&quot; v-show=&quot;curComponent&quot;&gt;å¤åˆ¶&lt;/li&gt;
&lt;li @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
&lt;li @click=&quot;cut&quot; v-show=&quot;curComponent&quot;&gt;å‰ªåˆ‡&lt;/li&gt;

cut() {
    this.$store.commit('cut')
},

copy() {
    this.$store.commit('copy')
},

paste() {
    this.$store.commit('paste', true)
},
</code></pre>
<h3 id="16-æ•°æ®äº¤äº’">16. æ•°æ®äº¤äº’</h3>
<h4 id="æ–¹å¼ä¸€">æ–¹å¼ä¸€</h4>
<p>æå‰å†™å¥½ä¸€ç³»åˆ— <code>ajax</code> è¯·æ±‚<code>API</code>ï¼Œç‚¹å‡»ç»„ä»¶æ—¶æŒ‰éœ€é€‰æ‹©<code>API</code>ï¼Œé€‰å¥½ <code>API</code> å†å¡«å‚æ•°ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç»„ä»¶ï¼Œå°±å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>ajax</code> è¯·æ±‚å‘åå°äº¤äº’ï¼š</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div&gt;{{ propValue.data }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    // propValue: {
    //     api: {
    //             request: a,
    //             params,
    //      },
    //     data: null
    // }
    props: {
        propValue: {
            type: Object,
            default: () =&gt; {},
        },
    },
    created() {
        this.propValue.api.request(this.propValue.api.params).then(res =&gt; {
            this.propValue.data = res.data
        })
    },
}
&lt;/script&gt;
</code></pre>
<h4 id="æ–¹å¼äºŒ">æ–¹å¼äºŒ</h4>
<p>æ–¹å¼äºŒé€‚åˆçº¯å±•ç¤ºçš„ç»„ä»¶ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªæŠ¥è­¦ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®åå°ä¼ æ¥çš„æ•°æ®æ˜¾ç¤ºå¯¹åº”çš„é¢œè‰²ã€‚åœ¨ç¼–è¾‘é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>ajax</code> å‘åå°è¯·æ±‚é¡µé¢èƒ½å¤Ÿä½¿ç”¨çš„ <code>websocket</code> æ•°æ®ï¼š</p>
<pre><code class="language-js">const data = ['status', 'text'...]
</code></pre>
<p>ç„¶åå†ä¸ºä¸åŒçš„ç»„ä»¶æ·»åŠ ä¸Šä¸åŒçš„å±æ€§ã€‚ä¾‹å¦‚æœ‰ a ç»„ä»¶ï¼Œå®ƒç»‘å®šçš„å±æ€§ä¸º <code>status</code>ã€‚</p>
<pre><code class="language-js">// ç»„ä»¶èƒ½æ¥æ”¶çš„æ•°æ®
props: {
    propValue: {
        type: String,
    },
    element: {
        type: Object,
    },
    wsKey: {
        type: String,
        default: '',
    },
},
</code></pre>
<p>åœ¨ç»„ä»¶ä¸­é€šè¿‡ <code>wsKey</code> è·å–è¿™ä¸ªç»‘å®šçš„å±æ€§ã€‚ç­‰é¡µé¢å‘å¸ƒåæˆ–è€…é¢„è§ˆæ—¶ï¼Œé€šè¿‡ <code>weboscket</code> å‘åå°è¯·æ±‚å…¨å±€æ•°æ®æ”¾åœ¨ <code>vuex</code> ä¸Šã€‚ç»„ä»¶å°±å¯ä»¥é€šè¿‡ <code>wsKey</code> è®¿é—®æ•°æ®äº†ã€‚</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div&gt;{{ wsData[wsKey] }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'

export default {
    props: {
        propValue: {
            type: String,
        },
        element: {
            type: Object,
        },
        wsKey: {
            type: String,
            default: '',
        },
    },
    computed: mapState([
        'wsData',
    ]),
&lt;/script&gt;
</code></pre>
<p>å’Œåå°äº¤äº’çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¸ä»…ä»…åŒ…æ‹¬ä¸Šé¢ä¸¤ç§ï¼Œæˆ‘åœ¨è¿™é‡Œä»…æä¾›ä¸€äº›æ€è·¯ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
<h3 id="17-å‘å¸ƒ">17. å‘å¸ƒ</h3>
<p>é¡µé¢å‘å¸ƒæœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€æ˜¯å°†ç»„ä»¶æ•°æ®æ¸²æŸ“ä¸ºä¸€ä¸ªå•ç‹¬çš„ HTML é¡µé¢ï¼›äºŒæ˜¯ä»æœ¬é¡¹ç›®ä¸­æŠ½å–å‡ºä¸€ä¸ªæœ€å°è¿è¡Œæ—¶ runtime ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚<br>
è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬äºŒç§æ–¹å¼ï¼Œæœ¬é¡¹ç›®ä¸­çš„æœ€å°è¿è¡Œæ—¶å…¶å®å°±æ˜¯é¢„è§ˆé¡µé¢åŠ ä¸Šè‡ªå®šä¹‰ç»„ä»¶ã€‚å°†è¿™äº›ä»£ç æå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªé¡¹ç›®å•ç‹¬æ‰“åŒ…ã€‚å‘å¸ƒé¡µé¢æ—¶å°†ç»„ä»¶æ•°æ®ä»¥ JSON çš„æ ¼å¼ä¼ ç»™æœåŠ¡ç«¯ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ IDã€‚<br>
å‡è®¾ç°åœ¨æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œå‘å¸ƒé¡µé¢ç”Ÿæˆçš„ ID ä¸º aã€bã€cã€‚è®¿é—®é¡µé¢æ—¶åªéœ€è¦æŠŠ ID å¸¦ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ® ID è·å–æ¯ä¸ªé¡µé¢å¯¹åº”çš„ç»„ä»¶æ•°æ®ã€‚</p>
<pre><code>www.test.com/?id=a
www.test.com/?id=c
www.test.com/?id=b
</code></pre>
<h4 id="æŒ‰éœ€åŠ è½½">æŒ‰éœ€åŠ è½½</h4>
<p>å¦‚æœè‡ªå®šä¹‰ç»„ä»¶è¿‡å¤§ï¼Œä¾‹å¦‚æœ‰æ•°åä¸ªç”šè‡³ä¸Šç™¾ä¸ªã€‚è¿™æ—¶å¯ä»¥å°†è‡ªå®šä¹‰ç»„ä»¶ç”¨ import çš„æ–¹å¼å¯¼å…¥ï¼Œåšåˆ°æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘é¦–å±æ¸²æŸ“æ—¶é—´ï¼š</p>
<pre><code class="language-js">import Vue from 'vue'

const components = [
    'Picture',
    'VText',
    'VButton',
]

components.forEach(key =&gt; {
    Vue.component(key, () =&gt; import(`@/custom-component/${key}`))
})
</code></pre>
<h4 id="æŒ‰ç‰ˆæœ¬å‘å¸ƒ">æŒ‰ç‰ˆæœ¬å‘å¸ƒ</h4>
<p>è‡ªå®šä¹‰ç»„ä»¶æœ‰å¯èƒ½ä¼šæœ‰æ›´æ–°çš„æƒ…å†µã€‚ä¾‹å¦‚åŸæ¥çš„ç»„ä»¶ä½¿ç”¨äº†å¤§åŠå¹´ï¼Œç°åœ¨æœ‰åŠŸèƒ½å˜æ›´ï¼Œä¸ºäº†ä¸å½±å“åŸæ¥çš„é¡µé¢ã€‚å»ºè®®åœ¨å‘å¸ƒæ—¶å¸¦ä¸Šç»„ä»¶çš„ç‰ˆæœ¬å·ï¼š</p>
<pre><code>- v-text
  - v1.vue
  - v2.vue
</code></pre>
<p>ä¾‹å¦‚ <code>v-text</code> ç»„ä»¶æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåœ¨å·¦ä¾§ç»„ä»¶åˆ—è¡¨åŒºä½¿ç”¨æ—¶å°±å¯ä»¥å¸¦ä¸Šç‰ˆæœ¬å·ï¼š</p>
<pre><code class="language-js">{
  component: 'v-text',
  version: 'v1'
  ...
}
</code></pre>
<p>è¿™æ ·å¯¼å…¥ç»„ä»¶æ—¶å°±å¯ä»¥æ ¹æ®ç»„ä»¶ç‰ˆæœ¬å·è¿›è¡Œå¯¼å…¥ï¼š</p>
<pre><code class="language-js">import Vue from 'vue'
import componentList from '@/custom-component/component-list`

componentList.forEach(component =&gt; {
    Vue.component(component.name, () =&gt; import(`@/custom-component/${component.name}/${component.version}`))
})
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://blog.luyu.icu/tag/vue/" class="tag">
                    vue
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://blog.luyu.icu/post/gFf8ea3r7/">
                  <h3 class="post-title">
                    å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸€ï¼‰
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '6cf547ef31b29bd3b69b',
        clientSecret: '4cca84f474d0153b60aba5a9e73d09a0617d00c6',
        repo: 'panyu97py.github.io',
        owner: 'panyu97py',
        admin: ['panyu97py'],
        proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token',
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
