<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.luyu.icu</id>
    <title>LuYu&apos;s Blog</title>
    <updated>2021-02-18T03:33:28.186Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.luyu.icu"/>
    <link rel="self" href="https://blog.luyu.icu/atom.xml"/>
    <subtitle>å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥</subtitle>
    <logo>https://blog.luyu.icu/images/avatar.png</logo>
    <icon>https://blog.luyu.icu/favicon.ico</icon>
    <rights>All rights reserved 2021, LuYu&apos;s Blog</rights>
    <entry>
        <title type="html"><![CDATA[ReactNative ios14çœ‹ä¸è§å›¾ç‰‡]]></title>
        <id>https://blog.luyu.icu/post/0_AYxdlAp/</id>
        <link href="https://blog.luyu.icu/post/0_AYxdlAp/">
        </link>
        <updated>2021-02-18T03:24:38.000Z</updated>
        <content type="html"><![CDATA[<h2 id="xcodeå‡çº§12åreactnative-ios14çœ‹ä¸è§å›¾ç‰‡é™æ€å›¾ç‰‡å’Œç½‘ç»œå›¾ç‰‡">Xcodeå‡çº§12åï¼ŒReactNative ios14çœ‹ä¸è§å›¾ç‰‡(é™æ€å›¾ç‰‡å’Œç½‘ç»œå›¾ç‰‡)</h2>
<h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3>
<h4 id="1-ç¬¬ä¸€ç§ä¿®æ”¹node_modulesä¸­react-nativelibrariesimagerctuiimageviewanimatesmæ–‡ä»¶">1ã€ç¬¬ä¸€ç§ï¼šä¿®æ”¹node_modulesä¸­react-native/Libraries/Image/RCTUIImageViewAnimates.mæ–‡ä»¶</h4>
<pre><code>if(_currentFrame){                   //275è¡Œ
    layer.contentsScale = self.animatedImageScale;
    layer.contents = (__bridge id)_currentFrame.CGImage;
}else{    //åŠ ä¸Šè¿™ä¸ª  ä¸ç„¶ios14ä»¥ä¸Šçš„ç³»ç»Ÿçœ‹ä¸è§å›¾ç‰‡
    [super displayLayer:layer];
}
</code></pre>
<h4 id="2-ç¬¬äºŒç§å‡çº§reactnativeç‰ˆæœ¬å¤§äºæˆ–è€…ç­‰äº063ç‰ˆæœ¬">2ã€ç¬¬äºŒç§ï¼šå‡çº§reactNativeç‰ˆæœ¬,å¤§äºæˆ–è€…ç­‰äº0.63ç‰ˆæœ¬</h4>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[react native webview çš„ä½¿ç”¨]]></title>
        <id>https://blog.luyu.icu/post/ZqSCJ18Us/</id>
        <link href="https://blog.luyu.icu/post/ZqSCJ18Us/">
        </link>
        <updated>2021-02-18T03:24:13.000Z</updated>
        <content type="html"><![CDATA[<h4 id="å®‰è£…">å®‰è£…</h4>
<pre><code class="language-bash">yarn add react-native-webview 
</code></pre>
<h4 id="æ¸²æŸ“è¿œç¨‹-html-å†…å®¹">æ¸²æŸ“è¿œç¨‹ HTML å†…å®¹</h4>
<pre><code>import React, { Component } from 'react'; 
import { View } from 'react-native'; 
import { WebView } from 'react-native-webview'; 
export default class App extends Component { 
    render(){
        return (
            &lt;View&gt;
                &lt;WebView source={{ uri: 'https://www.baidu.com' }} /&gt; 
            &lt;/View&gt;
        )
    }
} 
</code></pre>
<h4 id="æ¸²æŸ“-html-å­—ç¬¦ä¸²">æ¸²æŸ“ HTML å­—ç¬¦ä¸²</h4>
<pre><code>&lt;WebView 
originWhitelist={['*']} 
source={{ html: `&lt;h1&gt;è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/h1&gt;` }} 
/&gt; 
</code></pre>
<h4 id="æ ¹æ®å†…å®¹è‡ªåŠ¨è®¡ç®—é«˜åº¦">æ ¹æ®å†…å®¹è‡ªåŠ¨è®¡ç®—é«˜åº¦</h4>
<p>å¾€å¾€æˆ‘ä»¬æ— æ³•æå‰é¢„çŸ¥ <code>HTML</code> å†…å®¹çš„é«˜åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç»™å…¶è®¾ç½®ä¸€ä¸ªå›ºå®šçš„é«˜åº¦ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®å†…å®¹æ¥è®¾ç½®å…¶é«˜åº¦ã€‚</p>
<p>ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <code>injectedJavaScript</code> å’Œ <code>onMessage</code></p>
<h5 id="injectedjavascript">injectedJavaScript</h5>
<p>è¿™ä¸ªå±æ€§çš„ä½œç”¨æ˜¯è®¾ç½®ä¸€ä¸ªåœ¨ç½‘é¡µåŠ è½½ä¹‹å‰æ‰§è¡Œçš„ js ä»£ç ã€‚</p>
<h5 id="onmessage">onMessage</h5>
<p>åœ¨ <code>webview</code> å†…éƒ¨çš„ç½‘é¡µä¸­è°ƒç”¨ <code>window.postMessage</code> æ–¹æ³•æ—¶å¯ä»¥è§¦å‘æ­¤å±æ€§å¯¹åº”çš„å‡½æ•°ï¼Œä»è€Œå®ç°ç½‘é¡µå’Œ <code>RN</code> ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚ è®¾ç½®æ­¤å±æ€§çš„åŒæ—¶ä¼šåœ¨ <code>webview</code> ä¸­æ³¨å…¥ä¸€ä¸ª<code>postMessage</code> çš„å…¨å±€å‡½æ•°å¹¶è¦†ç›–å¯èƒ½å·²ç»å­˜åœ¨çš„åŒåå®ç°ã€‚</p>
<p>ç½‘é¡µç«¯çš„ <code>window.postMessage</code> åªå‘é€ä¸€ä¸ªå‚æ•° <code>data</code>ï¼Œæ­¤å‚æ•°å°è£…åœ¨ <code>RN</code> ç«¯çš„ <code>event</code> å¯¹è±¡ä¸­ï¼Œå³ <code>event.nativeEvent.data</code>ã€‚<code>data</code> åªèƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<pre><code>import React, { Component } from 'react';
import { View, ScrollView, SafeAreaView } from 'react-native';
import { WebView } from 'react-native-webview';

export default class App extends Component {
  constructor(props) {
    super(props);

    this.state = { webViewHeight: 0 };
  }

  {/* æ ¹æ®å†…å®¹è®¡ç®— WebView é«˜åº¦ */}
  onWebViewMessage = (event) =&gt; {
    this.setState({ webViewHeight: Number(event.nativeEvent.data) });
  }

  render() {
    const html = `&lt;p&gt;è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/p&gt;`
    const injectedJavaScript = `window.ReactNativeWebView.postMessage(document.documentElement.scrollHeight)`
    return (
      &lt;View style={{ flex: 1 }}&gt;
        &lt;View style={{ height: 100, backgroundColor: 'yellow' }}&gt;&lt;/View&gt;
        &lt;View style={{ height: this.state.webViewHeight }}&gt;
          &lt;WebView
            originWhitelist={['*']}
            source={{ html }}
            injectedJavaScript={{ injectedJavaScript }}
            onMessage={this.onWebViewMessage}
          /&gt;
        &lt;/View&gt;
        &lt;View style={{ height: 100, backgroundColor: 'green' }}&gt;&lt;/View&gt;
      &lt;/View&gt;
    )
  }
}
</code></pre>
<h4 id="é‡‡ç”¨å“åº”å¼å¸ƒå±€">é‡‡ç”¨å“åº”å¼å¸ƒå±€</h4>
<pre><code>&lt;WebView
  originWhitelist={['*']}
  source={{ html: `
  &lt;html&gt;
    &lt;head&gt;
      &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;/head&gt;

    &lt;body&gt;
      &lt;p&gt;è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/p&gt;
    &lt;/body&gt;
  &lt;/html&gt;
  ` }}
  injectedJavaScript='window.ReactNativeWebView.postMessage(document.documentElement.scrollHeight)'
  onMessage={this.onWebViewMessage}
/&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸‰ï¼‰]]></title>
        <id>https://blog.luyu.icu/post/-lcqVVhek/</id>
        <link href="https://blog.luyu.icu/post/-lcqVVhek/">
        </link>
        <updated>2021-02-16T19:49:47.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ‘˜è‡ª<a href="https://juejin.cn/post/6929302655118344200">æ˜é‡‘</a>,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘</p>
<p>æœ¬æ–‡æ˜¯å¯è§†åŒ–æ‹–æ‹½ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ä¸€å…±å¯¹ 17 ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œäº†åˆ†æï¼š</p>
<ol>
<li>ç¼–è¾‘å™¨</li>
<li>è‡ªå®šä¹‰ç»„ä»¶</li>
<li>æ‹–æ‹½</li>
<li>åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</li>
<li>æ”¾å¤§ç¼©å°</li>
<li>æ’¤æ¶ˆã€é‡åš</li>
<li>ç»„ä»¶å±æ€§è®¾ç½®</li>
<li>å¸é™„</li>
<li>é¢„è§ˆã€ä¿å­˜ä»£ç </li>
<li>ç»‘å®šäº‹ä»¶</li>
<li>ç»‘å®šåŠ¨ç”»</li>
<li>å¯¼å…¥ PSD</li>
<li>æ‰‹æœºæ¨¡å¼</li>
<li>æ‹–æ‹½æ—‹è½¬</li>
<li>å¤åˆ¶ç²˜è´´å‰ªåˆ‡</li>
<li>æ•°æ®äº¤äº’</li>
<li>å‘å¸ƒ</li>
</ol>
<p>æœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå°†å¯¹ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œåˆ†æï¼š</p>
<ol start="18">
<li>å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†</li>
<li>æ–‡æœ¬ç»„ä»¶</li>
<li>çŸ©å½¢ç»„ä»¶</li>
<li>é”å®šç»„ä»¶</li>
<li>å¿«æ·é”®</li>
<li>ç½‘æ ¼çº¿</li>
<li>ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼</li>
</ol>
<p>è™½ç„¶æˆ‘è¿™ä¸ªå¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“åªæ˜¯ä¸€ä¸ª DEMOï¼Œä½†å¯¹æ¯”äº†ä¸€ä¸‹å¸‚é¢ä¸Šçš„ä¸€äº›ç°æˆäº§å“ï¼ˆä¾‹å¦‚ <a href="https://www.processon.com/">processon</a>ã€<a href="https://modao.cc/">å¢¨åˆ€</a>ï¼‰ï¼Œå°±åŸºç¡€åŠŸèƒ½æ¥è¯´ï¼Œæˆ‘è¿™ä¸ª DEMO å®ç°äº†ç»å¤§éƒ¨åˆ†çš„åŠŸèƒ½ã€‚<br>
å¦‚æœä½ å¯¹äºä½ä»£ç å¹³å°æœ‰å…´è¶£ï¼Œä½†åˆä¸äº†è§£çš„è¯ã€‚å¼ºçƒˆå»ºè®®å°†æˆ‘çš„ä¸‰ç¯‡æ–‡ç« ç»“åˆé¡¹ç›®æºç ä¸€èµ·é˜…è¯»ï¼Œç›¸ä¿¡å¯¹ä½ çš„æ”¶è·ç»å¯¹ä¸å°ã€‚å¦é™„ä¸Šé¡¹ç›®ã€åœ¨çº¿ DEMO åœ°å€ï¼š</p>
<p><a href="https://github.com/woai3c/visual-drag-demo">github é¡¹ç›®åœ°å€</a></p>
<p><a href="https://woai3c.github.io/visual-drag-demo/#/">åœ¨çº¿é¢„è§ˆ</a></p>
<h3 id="18-å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†">18. å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†</h3>
<p>ç»„åˆå’Œæ‹†åˆ†çš„æŠ€æœ¯ç‚¹ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œå…±æœ‰ä»¥ä¸‹ 4 ä¸ªï¼š</p>
<ul>
<li>é€‰ä¸­åŒºåŸŸ</li>
<li>ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬</li>
<li>ç»„åˆåçš„æ”¾å¤§ç¼©å°</li>
<li>æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤</li>
</ul>
<h4 id="é€‰ä¸­åŒºåŸŸ">é€‰ä¸­åŒºåŸŸ</h4>
<p>åœ¨å°†å¤šä¸ªç»„ä»¶ç»„åˆä¹‹å‰ï¼Œéœ€è¦å…ˆé€‰ä¸­å®ƒä»¬ã€‚åˆ©ç”¨é¼ æ ‡äº‹ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†é€‰ä¸­åŒºåŸŸå±•ç¤ºå‡ºæ¥ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613505365488.gif" alt="" loading="lazy"></figure>
<ol>
<li><code>mousedown</code> è®°å½•èµ·ç‚¹åæ ‡</li>
<li><code>mousemove</code> å°†å½“å‰åæ ‡å’Œèµ·ç‚¹åæ ‡è¿›è¡Œè®¡ç®—å¾—å‡ºç§»åŠ¨åŒºåŸŸ</li>
<li>å¦‚æœæŒ‰ä¸‹é¼ æ ‡åå¾€å·¦ä¸Šæ–¹ç§»åŠ¨ï¼Œç±»ä¼¼äºè¿™ç§æ“ä½œåˆ™éœ€è¦å°†å½“å‰åæ ‡è®¾ä¸ºèµ·ç‚¹åæ ‡ï¼Œå†è®¡ç®—å‡ºç§»åŠ¨åŒºåŸŸ</li>
</ol>
<pre><code class="language-js">// è·å–ç¼–è¾‘å™¨çš„ä½ç§»ä¿¡æ¯
const rectInfo = this.editor.getBoundingClientRect()
this.editorX = rectInfo.x
this.editorY = rectInfo.y

const startX = e.clientX
const startY = e.clientY
this.start.x = startX - this.editorX
this.start.y = startY - this.editorY
// å±•ç¤ºé€‰ä¸­åŒºåŸŸ
this.isShowArea = true

const move = (moveEvent) =&gt; {
    this.width = Math.abs(moveEvent.clientX - startX)
    this.height = Math.abs(moveEvent.clientY - startY)
    if (moveEvent.clientX &lt; startX) {
        this.start.x = moveEvent.clientX - this.editorX
    }

    if (moveEvent.clientY &lt; startY) {
        this.start.y = moveEvent.clientY - this.editorY
    }
}
</code></pre>
<p>åœ¨ mouseup äº‹ä»¶è§¦å‘æ—¶ï¼Œéœ€è¦å¯¹é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶çš„ä½ç§»å¤§å°ä¿¡æ¯è¿›è¡Œè®¡ç®—ï¼Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚è¿™ä¸ªæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613505466651.gif" alt="" loading="lazy"></figure>
<p>è¿™ä¸ªè®¡ç®—è¿‡ç¨‹çš„ä»£ç ï¼š</p>
<pre><code class="language-js">createGroup() {
  // è·å–é€‰ä¸­åŒºåŸŸçš„ç»„ä»¶æ•°æ®
  const areaData = this.getSelectArea()
  if (areaData.length &lt;= 1) {
      this.hideArea()
      return
  }

  // æ ¹æ®é€‰ä¸­åŒºåŸŸå’ŒåŒºåŸŸä¸­æ¯ä¸ªç»„ä»¶çš„ä½ç§»ä¿¡æ¯æ¥åˆ›å»º Group ç»„ä»¶
  // è¦éå†é€‰æ‹©åŒºåŸŸçš„æ¯ä¸ªç»„ä»¶ï¼Œè·å–å®ƒä»¬çš„ left top right bottom ä¿¡æ¯æ¥è¿›è¡Œæ¯”è¾ƒ
  let top = Infinity, left = Infinity
  let right = -Infinity, bottom = -Infinity
  areaData.forEach(component =&gt; {
      let style = {}
      if (component.component == 'Group') {
          component.propValue.forEach(item =&gt; {
              const rectInfo = $(`#component${item.id}`).getBoundingClientRect()
              style.left = rectInfo.left - this.editorX
              style.top = rectInfo.top - this.editorY
              style.right = rectInfo.right - this.editorX
              style.bottom = rectInfo.bottom - this.editorY

              if (style.left &lt; left) left = style.left
              if (style.top &lt; top) top = style.top
              if (style.right &gt; right) right = style.right
              if (style.bottom &gt; bottom) bottom = style.bottom
          })
      } else {
          style = getComponentRotatedStyle(component.style)
      }

      if (style.left &lt; left) left = style.left
      if (style.top &lt; top) top = style.top
      if (style.right &gt; right) right = style.right
      if (style.bottom &gt; bottom) bottom = style.bottom
  })

  this.start.x = left
  this.start.y = top
  this.width = right - left
  this.height = bottom - top
	
  // è®¾ç½®é€‰ä¸­åŒºåŸŸä½ç§»å¤§å°ä¿¡æ¯å’ŒåŒºåŸŸå†…çš„ç»„ä»¶æ•°æ®
  this.$store.commit('setAreaData', {
      style: {
          left,
          top,
          width: this.width,
          height: this.height,
      },
      components: areaData,
  })
},
        
getSelectArea() {
    const result = []
    // åŒºåŸŸèµ·ç‚¹åæ ‡
    const { x, y } = this.start
    // è®¡ç®—æ‰€æœ‰çš„ç»„ä»¶æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨é€‰ä¸­åŒºåŸŸå†…
    this.componentData.forEach(component =&gt; {
        if (component.isLock) return
        const { left, top, width, height } = component.style
        if (x &lt;= left &amp;&amp; y &lt;= top &amp;&amp; (left + width &lt;= x + this.width) &amp;&amp; (top + height &lt;= y + this.height)) {
            result.push(component)
        }
    })
	
    // è¿”å›åœ¨é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶
    return result
}
</code></pre>
<p>ç®€å•æè¿°ä¸€ä¸‹è¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ï¼š</p>
<ol>
<li>åˆ©ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect"><code>getBoundingClientRect()</code></a> æµè§ˆå™¨ API è·å–æ¯ä¸ªç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£å››ä¸ªæ–¹å‘ä¸Šçš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>ã€‚</li>
<li>å¯¹æ¯”æ¯ä¸ªç»„ä»¶çš„è¿™å››ä¸ªä¿¡æ¯ï¼Œå–å¾—é€‰ä¸­åŒºåŸŸçš„æœ€å·¦ã€æœ€ä¸Šã€æœ€å³ã€æœ€ä¸‹å››ä¸ªæ–¹å‘çš„æ•°å€¼ï¼Œä»è€Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚</li>
<li>å¦‚æœé€‰ä¸­åŒºåŸŸå†…å·²ç»æœ‰ä¸€ä¸ª <code>Group</code> ç»„åˆç»„ä»¶ï¼Œåˆ™éœ€è¦å¯¹å®ƒé‡Œé¢çš„å­ç»„ä»¶è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯å¯¹ç»„åˆç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚</li>
</ol>
<h4 id="ç»„åˆåçš„ç§»åŠ¨-æ—‹è½¬">ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬</h4>
<p>ä¸ºäº†æ–¹ä¾¿å°†å¤šä¸ªç»„ä»¶ä¸€èµ·è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬ã€æ”¾å¤§ç¼©å°ç­‰æ“ä½œï¼Œæˆ‘æ–°åˆ›å»ºäº†ä¸€ä¸ª <code>Group</code> ç»„åˆç»„ä»¶ï¼š</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;group&quot;&gt;
        &lt;div&gt;
             &lt;template v-for=&quot;item in propValue&quot;&gt;
                &lt;component
                    class=&quot;component&quot;
                    :is=&quot;item.component&quot;
                    :style=&quot;item.groupStyle&quot;
                    :propValue=&quot;item.propValue&quot;
                    :key=&quot;item.id&quot;
                    :id=&quot;'component' + item.id&quot;
                    :element=&quot;item&quot;
                /&gt;
            &lt;/template&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { getStyle } from '@/utils/style'

export default {
    props: {
        propValue: {
            type: Array,
            default: () =&gt; [],
        },
        element: {
            type: Object,
        },
    },
    created() {
        const parentStyle = this.element.style
        this.propValue.forEach(component =&gt; {
            // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®
            // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—
            if (!Object.keys(component.groupStyle).length) {
                const style = { ...component.style }
                component.groupStyle = getStyle(style)
                component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)
                component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)
                component.groupStyle.width = this.toPercent(style.width / parentStyle.width)
                component.groupStyle.height = this.toPercent(style.height / parentStyle.height)
            }
        })
    },
    methods: {
        toPercent(val) {
            return val * 100 + '%'
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.group {
    &amp; &gt; div {
        position: relative;
        width: 100%;
        height: 100%;

        .component {
            position: absolute;
        }
    }
}
&lt;/style&gt;
</code></pre>
<p><code>Group</code> ç»„ä»¶çš„ä½œç”¨å°±æ˜¯å°†åŒºåŸŸå†…çš„ç»„ä»¶æ”¾åˆ°å®ƒä¸‹é¢ï¼Œæˆä¸ºå­ç»„ä»¶ã€‚å¹¶ä¸”åœ¨åˆ›å»º <code>Group</code> ç»„ä»¶æ—¶ï¼Œè·å–æ¯ä¸ªå­ç»„ä»¶åœ¨ <code>Group</code> ç»„ä»¶å†…çš„ç›¸å¯¹ä½ç§»å’Œç›¸å¯¹å¤§å°ï¼š</p>
<pre><code class="language-js">created() {
    const parentStyle = this.element.style
    this.propValue.forEach(component =&gt; {
        // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®
        // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—
        if (!Object.keys(component.groupStyle).length) {
            const style = { ...component.style }
            component.groupStyle = getStyle(style)
            component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)
            component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)
            component.groupStyle.width = this.toPercent(style.width / parentStyle.width)
            component.groupStyle.height = this.toPercent(style.height / parentStyle.height)
        }
    })
},
methods: {
        toPercent(val) {
            return val * 100 + '%'
        },
    },
</code></pre>
<p>ä¹Ÿå°±æ˜¯å°†å­ç»„ä»¶çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> ç­‰å±æ€§è½¬æˆä»¥ <code>%</code> ç»“å°¾çš„ç›¸å¯¹æ•°å€¼ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Ÿ</strong></p>
<p>å¦‚æœä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Œé‚£ä¹ˆåœ¨ç§»åŠ¨ <code>Group</code> ç»„ä»¶æ—¶ï¼Œé™¤äº†å¯¹ <code>Group</code> ç»„ä»¶çš„å±æ€§è¿›è¡Œè®¡ç®—å¤–ï¼Œè¿˜éœ€è¦å¯¹å®ƒçš„æ¯ä¸ªå­ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¹¶ä¸” <code>Group</code> åŒ…å«å­ç»„ä»¶å¤ªå¤šçš„è¯ï¼Œåœ¨è¿›è¡Œç§»åŠ¨ã€æ”¾å¤§ç¼©å°æ—¶ï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆé¡µé¢å¡é¡¿ã€‚å¦‚æœæ”¹æˆç›¸å¯¹æ•°å€¼ï¼Œåˆ™åªéœ€è¦åœ¨ <code>Group</code> åˆ›å»ºæ—¶è®¡ç®—ä¸€æ¬¡ã€‚ç„¶ååœ¨ <code>Group</code> ç»„ä»¶è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬æ—¶ä¹Ÿä¸ç”¨ç®¡ <code>Group</code> çš„å­ç»„ä»¶ï¼Œåªå¯¹å®ƒè‡ªå·±è®¡ç®—å³å¯ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613505786018.gif" alt="" loading="lazy"></figure>
<h4 id="ç»„åˆåçš„æ”¾å¤§ç¼©å°">ç»„åˆåçš„æ”¾å¤§ç¼©å°</h4>
<p>ç»„åˆåçš„æ”¾å¤§ç¼©å°æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºæœ‰æ—‹è½¬è§’åº¦çš„å­˜åœ¨ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å„ä¸ªå­ç»„ä»¶æ²¡æ—‹è½¬æ—¶çš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://blog.luyu.icu/post-images/1613505848014.gif" alt="" loading="lazy"></figure>
<p>ä»åŠ¨å›¾å¯ä»¥çœ‹å‡ºï¼Œæ•ˆæœéå¸¸å®Œç¾ã€‚å„ä¸ªå­ç»„ä»¶çš„å¤§å°æ˜¯è·Ÿéš <code>Group</code> ç»„ä»¶çš„å¤§å°è€Œæ”¹å˜çš„ã€‚</p>
<p>ç°åœ¨è¯•ç€ç»™å­ç»„ä»¶åŠ ä¸Šæ—‹è½¬è§’åº¦ï¼Œå†çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>
<figure data-type="image" tabindex="5"><img src="https://blog.luyu.icu/post-images/1613505895886.gif" alt="" loading="lazy"></figure>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ<br>
ä¸»è¦æ˜¯å› ä¸ºä¸€ä¸ªç»„ä»¶æ— è®ºæ—‹ä¸æ—‹è½¬ï¼Œå®ƒçš„ <code>left</code>ã€<code>top</code> å±æ€§éƒ½æ˜¯ä¸å˜çš„ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„  <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚</p>
<p><img src="https://blog.luyu.icu/post-images/1613505976304.png" alt="" loading="lazy"><br>
å¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>æ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://blog.luyu.icu/post-images/1613506012073.png" alt="" loading="lazy"></figure>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ª <code>Group</code> ç»„ä»¶ï¼Œå®ƒå·¦è¾¹çš„å­ç»„ä»¶å±æ€§ä¸ºï¼š</p>
<pre><code class="language-css">transform: rotate(-75.1967deg);
width: 51.2267%;
height: 32.2679%;
top: 33.8661%;
left: -10.6496%;
</code></pre>
<p>å¯ä»¥çœ‹åˆ° <code>width</code> çš„å€¼ä¸º <code>51.2267%</code>ï¼Œä½†ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªå­ç»„ä»¶æœ€å¤šå  <code>Group</code> ç»„ä»¶å®½åº¦çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚æ‰€ä»¥è¿™å°±æ˜¯æ”¾å¤§ç¼©å°ä¸æ­£å¸¸çš„é—®é¢˜æ‰€åœ¨ã€‚</p>
<h5 id="ä¸€ä¸ªä¸å¯è¡Œçš„è§£å†³æ–¹æ¡ˆä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡">ä¸€ä¸ªä¸å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼ˆä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡ï¼‰</h5>
<p>ä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯ï¼Œå…ˆç®—å‡ºå®ƒç›¸å¯¹æµè§ˆå™¨è§†å£çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code> å±æ€§ï¼Œå†ç®—å‡ºè¿™å‡ ä¸ªå±æ€§åœ¨ <code>Group</code> ç»„ä»¶ä¸Šçš„ç›¸å¯¹æ•°å€¼ã€‚è¿™å¯ä»¥é€šè¿‡ <code>getBoundingClientRect()</code> <code>API</code> å®ç°ã€‚åªè¦ç»´æŒå¤–è§‚ä¸Šçš„å„ä¸ªå±æ€§å æ¯”ä¸å˜ï¼Œè¿™æ · <code>Group</code> ç»„ä»¶åœ¨æ”¾å¤§ç¼©å°æ—¶ï¼Œå†é€šè¿‡æ—‹è½¬è§’åº¦ï¼Œåˆ©ç”¨æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼ˆè¿™ä¸€ç‚¹åœ¨ç¬¬äºŒç¯‡æœ‰è¯¦ç»†æè¿°ï¼‰è·å–å®ƒæœªæ—‹è½¬å‰çš„ t<code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°å­ç»„ä»¶åŠ¨æ€è°ƒæ•´äº†ã€‚</p>
<p>ä½†æ˜¯è¿™æœ‰ä¸ªé—®é¢˜ï¼Œé€šè¿‡ <code>getBoundingClientRect()</code> API åªèƒ½è·å–ç»„ä»¶å¤–è§‚ä¸Šçš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚å†åŠ ä¸Šä¸€ä¸ªè§’åº¦ï¼Œå‚æ•°è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥æ— æ³•è®¡ç®—å‡ºç»„ä»¶å®é™…çš„ <code>left</code>ã€<code>top</code>ã€<code>right</code>ã€<code>bottom</code>  å±æ€§ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.luyu.icu/post-images/1613506253945.png" alt="" loading="lazy"></figure>
<p>å°±åƒä¸Šé¢çš„è¿™å¼ å›¾ï¼ŒåªçŸ¥é“åŸç‚¹<code>O(x,y)</code>ã€ <code>w</code>ã€<code>h</code> å’Œæ—‹è½¬è§’åº¦ï¼Œæ— æ³•ç®—å‡ºæŒ‰é’®çš„å®½é«˜ã€‚</p>
<h4 id="ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ">ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ</h4>
<p>è¿™æ˜¯æ— æ„ä¸­å‘ç°çš„ï¼Œæˆ‘åœ¨å¯¹ <code>Group</code> ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°æ—¶ï¼Œå‘ç°åªè¦ä¿æŒ <code>Group</code> ç»„ä»¶çš„å®½é«˜æ¯”ä¾‹ï¼Œå­ç»„ä»¶å°±èƒ½åšåˆ°æ ¹æ®æ¯”ä¾‹æ”¾å¤§ç¼©å°ã€‚é‚£ä¹ˆç°åœ¨é—®é¢˜å°±è½¬å˜æˆäº†å¦‚ä½•è®© <code>Group</code> ç»„ä»¶æ”¾å¤§ç¼©å°æ—¶ä¿æŒå®½é«˜æ¯”ä¾‹ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™ä¸€ç¯‡<a href="https://github.com/shenhudong/snapping-demo/wiki/corner-handle">æ–‡ç« </a>ï¼Œå®ƒè¯¦ç»†æè¿°äº†ä¸€ä¸ªæ—‹è½¬ç»„ä»¶å¦‚ä½•ä¿æŒå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œå¹¶é…æœ‰æºç ç¤ºä¾‹ã€‚</p>
<p>ç°åœ¨æˆ‘å°è¯•ç®€å•æè¿°ä¸€ä¸‹å¦‚ä½•ä¿æŒå®½é«˜æ¯”å¯¹ä¸€ä¸ªæ—‹è½¬ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°ï¼ˆå»ºè®®è¿˜æ˜¯çœ‹çœ‹åŸæ–‡ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://blog.luyu.icu/post-images/1613506394348.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œç®—å‡ºç»„ä»¶å®½é«˜æ¯”ï¼Œä»¥åŠæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ <code>top</code> ã€<code>left</code> å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">// ç»„ä»¶å®½é«˜æ¯”
const proportion = style.width / style.height
            
const center = {
    x: style.left + style.width / 2,
    y: style.top + style.height / 2,
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç”¨å½“å‰ç‚¹å‡»åæ ‡å’Œç»„ä»¶ä¸­å¿ƒç‚¹ç®—å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š</p>
<pre><code class="language-js">// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯
const editorRectInfo = document.querySelector('#editor').getBoundingClientRect()

// å½“å‰ç‚¹å‡»åæ ‡
const curPoint = {
    x: e.clientX - editorRectInfo.left,
    y: e.clientY - editorRectInfo.top,
}

// è·å–å¯¹ç§°ç‚¹çš„åæ ‡
const symmetricPoint = {
    x: center.x - (curPoint.x - center.x),
    y: center.y - (curPoint.y - center.y),
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const curPositon = {
    x: moveEvent.clientX - editorRectInfo.left,
    y: moveEvent.clientY - editorRectInfo.top,
}

const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)

// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡
function getCenterPoint(p1, p2) {
    return {
        x: p1.x + ((p2.x - p1.x) / 2),
        y: p1.y + ((p2.y - p1.y) / 2),
    }
}
</code></pre>
<p>ç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„ xy è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://blog.luyu.icu/post-images/1613506539352.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ <code>currentPosition</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newTopLeftPoint</code>ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ sPoint åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newBottomRightPoint</code>ã€‚<br>
å¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡
 * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡
 * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ
 * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦
 * @return  {Object}         æ—‹è½¬åçš„åæ ‡
 * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼
 */
export function calculateRotatedPointCoordinate(point, center, rotate) {
    /**
     * æ—‹è½¬å…¬å¼ï¼š
     *  ç‚¹a(x, y)
     *  æ—‹è½¬ä¸­å¿ƒc(x, y)
     *  æ—‹è½¬åç‚¹n(x, y)
     *  æ—‹è½¬è§’åº¦Î¸                tan ??
     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx
     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy
     */

    return {
        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,
        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,
    }
}
</code></pre>
<p>ä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»<a href="https://www.zhihu.com/question/67425734/answer/252724399">çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”</a>ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://blog.luyu.icu/post-images/1613506660740.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="11"><img src="https://blog.luyu.icu/post-images/1613506688090.png" alt="" loading="lazy"></figure>
<p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼ <code>top</code>ã€<code>left</code> ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, pointInfo) {
    const { symmetricPoint } = pointInfo
    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="12"><img src="https://blog.luyu.icu/post-images/1613506759227.gif" alt="" loading="lazy"></figure>
<p><strong>ç¬¬äº”æ­¥</strong>ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯é”å®šå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è®¡ç®—æ‹‰ä¼¸åçš„å›¾å½¢çš„å·¦ä¸Šè§’åæ ‡ã€‚</p>
<p>è¿™é‡Œå…ˆç¡®å®šå¥½å‡ ä¸ªå½¢çŠ¶çš„å‘½åï¼š</p>
<ul>
<li>åŸå›¾å½¢: ã€€çº¢è‰²éƒ¨åˆ†</li>
<li>æ–°å›¾å½¢: ã€€è“è‰²éƒ¨åˆ†</li>
<li>ä¿®æ­£å›¾å½¢: ç»¿è‰²éƒ¨åˆ†ï¼Œå³åŠ ä¸Šå®½é«˜æ¯”é”å®šè§„åˆ™çš„ä¿®æ­£å›¾å½¢</li>
</ul>
<figure data-type="image" tabindex="13"><img src="https://blog.luyu.icu/post-images/1613506825223.gif" alt="" loading="lazy"></figure>
<p>åœ¨ç¬¬å››æ­¥ä¸­ç®—å‡ºç»„ä»¶æœªæ—‹è½¬å‰çš„ <code>newTopLeftPoint</code> <code>newBottomRightPoint</code> <code>newWidth</code> <code>newHeight</code> åï¼Œéœ€è¦æ ¹æ®å®½é«˜æ¯” <code>proportion</code> æ¥ç®—å‡ºæ–°çš„å®½åº¦æˆ–é«˜åº¦ã€‚</p>
<figure data-type="image" tabindex="14"><img src="https://blog.luyu.icu/post-images/1613506905389.png" alt="" loading="lazy"></figure>
<p>ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªéœ€è¦æ”¹å˜é«˜åº¦çš„ç¤ºä¾‹ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">if (newWidth / newHeight &gt; proportion) {
    newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)
    newWidth = newHeight * proportion
} else {
    newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)
    newHeight = newWidth / proportion
}
</code></pre>
<p>ç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡ã€‚ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://blog.luyu.icu/post-images/1613506955962.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="16"><img src="https://blog.luyu.icu/post-images/1613507009595.png" alt="" loading="lazy"></figure>
<p>ç»è¿‡ä¿®æ”¹åçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, proportion, needLockProportion, pointInfo) {
    const { symmetricPoint } = pointInfo
    let newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    let newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    let newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    let newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    let newHeight = newBottomRightPoint.y - newTopLeftPoint.y

    if (needLockProportion) {
        if (newWidth / newHeight &gt; proportion) {
            newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)
            newWidth = newHeight * proportion
        } else {
            newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)
            newHeight = newWidth / proportion
        }

        // ç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„
        // æ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡
        // ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡
        const rotatedTopLeftPoint = calculateRotatedPointCoordinate(newTopLeftPoint, newCenterPoint, style.rotate)
        newCenterPoint = getCenterPoint(rotatedTopLeftPoint, symmetricPoint)
        newTopLeftPoint = calculateRotatedPointCoordinate(rotatedTopLeftPoint, newCenterPoint, -style.rotate)
        newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
    
        newWidth = newBottomRightPoint.x - newTopLeftPoint.x
        newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    }

    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="17"><img src="https://blog.luyu.icu/post-images/1613507087355.gif" alt="" loading="lazy"></figure>
<p>å½“ <code>Group</code> ç»„ä»¶æœ‰æ—‹è½¬çš„å­ç»„ä»¶æ—¶ï¼Œæ‰éœ€è¦ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚æ‰€ä»¥åœ¨åˆ›å»º <code>Group</code> ç»„ä»¶æ—¶å¯ä»¥åˆ¤æ–­ä¸€ä¸‹å­ç»„ä»¶æ˜¯å¦æœ‰æ—‹è½¬è§’åº¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦ä¿æŒå®½åº¦æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚</p>
<pre><code class="language-js">isNeedLockProportion() {
    if (this.element.component != 'Group') return false
    const ratates = [0, 90, 180, 360]
    for (const component of this.element.propValue) {
        if (!ratates.includes(mod360(parseInt(component.style.rotate)))) {
            return true
        }
    }

    return false
}
</code></pre>
<h4 id="æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤">æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤</h4>
<p>å°†å¤šä¸ªç»„ä»¶ç»„åˆåœ¨ä¸€èµ·åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥æ˜¯å°† <code>Group</code> ç»„ä»¶è¿›è¡Œæ‹†åˆ†å¹¶æ¢å¤å„ä¸ªå­ç»„ä»¶çš„æ ·å¼ã€‚ä¿è¯æ‹†åˆ†åçš„å­ç»„ä»¶åœ¨å¤–è§‚ä¸Šçš„å±æ€§ä¸å˜ã€‚</p>
<p>è®¡ç®—ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// store
decompose({ curComponent, editor }) {
    const parentStyle = { ...curComponent.style }
    const components = curComponent.propValue
    const editorRect = editor.getBoundingClientRect()

    store.commit('deleteComponent')
    components.forEach(component =&gt; {
        decomposeComponent(component, editorRect, parentStyle)
        store.commit('addComponent', { component })
    })
}
        
// å°†ç»„åˆä¸­çš„å„ä¸ªå­ç»„ä»¶æ‹†åˆ†å‡ºæ¥ï¼Œå¹¶è®¡ç®—å®ƒä»¬æ–°çš„ style
export default function decomposeComponent(component, editorRect, parentStyle) {
    // å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„æ ·å¼
    const componentRect = $(`#component${component.id}`).getBoundingClientRect()
    // è·å–å…ƒç´ çš„ä¸­å¿ƒç‚¹åæ ‡
    const center = {
        x: componentRect.left - editorRect.left + componentRect.width / 2,
        y: componentRect.top - editorRect.top + componentRect.height / 2,
    }

    component.style.rotate = mod360(component.style.rotate + parentStyle.rotate)
    component.style.width = parseFloat(component.groupStyle.width) / 100 * parentStyle.width
    component.style.height = parseFloat(component.groupStyle.height) / 100 * parentStyle.height
    // è®¡ç®—å‡ºå…ƒç´ æ–°çš„ top left åæ ‡
    component.style.left = center.x - component.style.width / 2
    component.style.top = center.y - component.style.height / 2
    component.groupStyle = {}
}
</code></pre>
<p>è¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ä¸ºï¼š</p>
<ol>
<li>éå† <code>Group</code> çš„å­ç»„ä»¶å¹¶æ¢å¤å®ƒä»¬çš„æ ·å¼</li>
<li>åˆ©ç”¨ <code>getBoundingClientRect() ``API</code> è·å–å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„ <code>left</code> <code>top</code> <code>width</code> <code>height</code> å±æ€§ã€‚</li>
<li>åˆ©ç”¨è¿™å››ä¸ªå±æ€§è®¡ç®—å‡ºå­ç»„ä»¶çš„ä¸­å¿ƒç‚¹åæ ‡ã€‚</li>
<li>ç”±äºå­ç»„ä»¶çš„ <code>width</code> <code>height</code> å±æ€§æ˜¯ç›¸å¯¹äº <code>Group</code> ç»„ä»¶çš„ï¼Œæ‰€ä»¥å°†å®ƒä»¬çš„ç™¾åˆ†æ¯”å€¼å’Œ <code>Group</code> ç›¸ä¹˜å¾—å‡ºå…·ä½“æ•°å€¼ã€‚</li>
<li>å†ç”¨ä¸­å¿ƒç‚¹ <code>center(x, y)</code>å‡å»å­ç»„ä»¶å®½é«˜çš„ä¸€åŠå¾—å‡ºå®ƒçš„ <code>left</code> <code>top</code> å±æ€§ã€‚</li>
</ol>
<p>è‡³æ­¤ï¼Œç»„åˆå’Œæ‹†åˆ†å°±è®²è§£å®Œäº†ã€‚</p>
<h3 id="19-æ–‡æœ¬ç»„ä»¶">19. æ–‡æœ¬ç»„ä»¶</h3>
<p>æ–‡æœ¬ç»„ä»¶ <code>VText</code> ä¹‹å‰å°±å·²ç»å®ç°è¿‡äº†ï¼Œä½†ä¸å®Œç¾ã€‚ä¾‹å¦‚æ— æ³•å¯¹æ–‡å­—è¿›è¡Œé€‰ä¸­ã€‚ç°åœ¨æˆ‘å¯¹å®ƒè¿›è¡Œäº†é‡å†™ï¼Œè®©å®ƒæ”¯æŒé€‰ä¸­åŠŸèƒ½ã€‚</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div v-if=&quot;editMode == 'edit'&quot; class=&quot;v-text&quot; @keydown=&quot;handleKeydown&quot; @keyup=&quot;handleKeyup&quot;&gt;
        &lt;!-- tabindex &gt;= 0 ä½¿å¾—åŒå‡»æ—¶èšé›†è¯¥å…ƒç´  --&gt;
        &lt;div :contenteditable=&quot;canEdit&quot; :class=&quot;{ canEdit }&quot; @dblclick=&quot;setEdit&quot; :tabindex=&quot;element.id&quot; @paste=&quot;clearStyle&quot;
            @mousedown=&quot;handleMousedown&quot; @blur=&quot;handleBlur&quot; ref=&quot;text&quot; v-html=&quot;element.propValue&quot; @input=&quot;handleInput&quot;
            :style=&quot;{ verticalAlign: element.style.verticalAlign }&quot;
        &gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div v-else class=&quot;v-text&quot;&gt;
        &lt;div v-html=&quot;element.propValue&quot; :style=&quot;{ verticalAlign: element.style.verticalAlign }&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'
import { keycodes } from '@/utils/shortcutKey.js'

export default {
    props: {
        propValue: {
            type: String,
            require: true,
        },
        element: {
            type: Object,
        },
    },
    data() {
        return {
            canEdit: false,
            ctrlKey: 17,
            isCtrlDown: false,
        }
    },
    computed: {
        ...mapState([
            'editMode',
        ]),
    },
    methods: {
        handleInput(e) {
            this.$emit('input', this.element, e.target.innerHTML)
        },

        handleKeydown(e) {
            if (e.keyCode == this.ctrlKey) {
                this.isCtrlDown = true
            } else if (this.isCtrlDown &amp;&amp; this.canEdit &amp;&amp; keycodes.includes(e.keyCode)) {
                e.stopPropagation()
            } else if (e.keyCode == 46) { // deleteKey
                e.stopPropagation()
            }
        },

        handleKeyup(e) {
            if (e.keyCode == this.ctrlKey) {
                this.isCtrlDown = false
            }
        },

        handleMousedown(e) {
            if (this.canEdit) {
                e.stopPropagation()
            }
        },

        clearStyle(e) {
            e.preventDefault()
            const clp = e.clipboardData
            const text = clp.getData('text/plain') || ''
            if (text !== '') {
                document.execCommand('insertText', false, text)
            }

            this.$emit('input', this.element, e.target.innerHTML)
        },

        handleBlur(e) {
            this.element.propValue = e.target.innerHTML || '&amp;nbsp;'
            this.canEdit = false
        },

        setEdit() {
            this.canEdit = true
            // å…¨é€‰
            this.selectText(this.$refs.text)
        },

        selectText(element) {
            const selection = window.getSelection()
            const range = document.createRange()
            range.selectNodeContents(element)
            selection.removeAllRanges()
            selection.addRange(range)
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.v-text {
    width: 100%;
    height: 100%;
    display: table;

    div {
        display: table-cell;
        width: 100%;
        height: 100%;
        outline: none;
    }

    .canEdit {
        cursor: text;
        height: 100%;
    }
}
&lt;/style&gt;
</code></pre>
<p>æ”¹é€ åçš„ VText ç»„ä»¶åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ol>
<li>åŒå‡»å¯åŠ¨ç¼–è¾‘ã€‚</li>
<li>æ”¯æŒé€‰ä¸­æ–‡æœ¬ã€‚</li>
<li>ç²˜è´´æ—¶è¿‡æ»¤æ‰æ–‡æœ¬çš„æ ·å¼ã€‚</li>
<li>æ¢è¡Œæ—¶è‡ªåŠ¨æ‰©å……æ–‡æœ¬æ¡†çš„é«˜åº¦ã€‚</li>
</ol>
<figure data-type="image" tabindex="18"><img src="https://blog.luyu.icu/post-images/1613507304088.gif" alt="" loading="lazy"></figure>
<h3 id="20-çŸ©å½¢ç»„ä»¶">20. çŸ©å½¢ç»„ä»¶</h3>
<p>çŸ©å½¢ç»„ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªå†…åµŒ <code>VText</code> æ–‡æœ¬ç»„ä»¶çš„ä¸€ä¸ª <code>DIV</code></p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div class=&quot;rect-shape&quot;&gt;
        &lt;v-text :propValue=&quot;element.propValue&quot; :element=&quot;element&quot; /&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        element: {
            type: Object,
        },
    },
}
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.rect-shape {
    width: 100%;
    height: 100%;
    overflow: auto;
}
&lt;/style&gt;
</code></pre>
<p><code>VText</code> æ–‡æœ¬ç»„ä»¶æœ‰çš„åŠŸèƒ½å®ƒéƒ½æœ‰ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„æ”¾å¤§ç¼©å°ã€‚</p>
<figure data-type="image" tabindex="19"><img src="https://blog.luyu.icu/post-images/1613507388868.gif" alt="" loading="lazy"></figure>
<h3 id="21-é”å®šç»„ä»¶">21. é”å®šç»„ä»¶</h3>
<p>é”å®šç»„ä»¶ä¸»è¦æ˜¯çœ‹åˆ° <code>processon</code> å’Œå¢¨åˆ€æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œäºæ˜¯æˆ‘é¡ºä¾¿å®ç°äº†ã€‚é”å®šç»„ä»¶çš„å…·ä½“éœ€æ±‚ä¸ºï¼šä¸èƒ½ç§»åŠ¨ã€æ”¾å¤§ç¼©å°ã€æ—‹è½¬ã€å¤åˆ¶ã€ç²˜è´´ç­‰ï¼Œåªèƒ½è¿›è¡Œè§£é”æ“ä½œã€‚<br>
å®ƒçš„å®ç°åŸç†ä¹Ÿä¸éš¾ï¼š</p>
<ol>
<li>åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸ŠåŠ ä¸€ä¸ª <code>isLock</code> å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦é”å®šç»„ä»¶ã€‚</li>
<li>åœ¨ç‚¹å‡»ç»„ä»¶æ—¶ï¼Œæ ¹æ® <code>isLock</code> æ˜¯å¦ä¸º <code>true</code> æ¥éšè—ç»„ä»¶ä¸Šçš„å…«ä¸ªç‚¹å’Œæ—‹è½¬å›¾æ ‡ã€‚</li>
<li>ä¸ºäº†çªå‡ºä¸€ä¸ªç»„ä»¶è¢«é”å®šï¼Œç»™å®ƒåŠ ä¸Šé€æ˜åº¦å±æ€§å’Œä¸€ä¸ªé”çš„å›¾æ ‡ã€‚</li>
<li>å¦‚æœç»„ä»¶è¢«é”å®šï¼Œç½®ç°ä¸Šé¢æ‰€è¯´çš„éœ€æ±‚å¯¹åº”çš„æŒ‰é’®ï¼Œä¸èƒ½è¢«ç‚¹å‡»ã€‚</li>
</ol>
<p>ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">export const commonAttr = {
    animations: [],
    events: {},
    groupStyle: {}, // å½“ä¸€ä¸ªç»„ä»¶æˆä¸º Group çš„å­ç»„ä»¶æ—¶ä½¿ç”¨
    isLock: false, // æ˜¯å¦é”å®šç»„ä»¶
}
</code></pre>
<pre><code class="language-html">&lt;el-button @click=&quot;decompose&quot; 
:disabled=&quot;!curComponent || curComponent.isLock || curComponent.component != 'Group'&quot;&gt;æ‹†åˆ†&lt;/el-button&gt;

&lt;el-button @click=&quot;lock&quot; :disabled=&quot;!curComponent || curComponent.isLock&quot;&gt;é”å®š&lt;/el-button&gt;
&lt;el-button @click=&quot;unlock&quot; :disabled=&quot;!curComponent || !curComponent.isLock&quot;&gt;è§£é”&lt;/el-button&gt;
</code></pre>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;contextmenu&quot; v-show=&quot;menuShow&quot; :style=&quot;{ top: menuTop + 'px', left: menuLeft + 'px' }&quot;&gt;
        &lt;ul @mouseup=&quot;handleMouseUp&quot;&gt;
            &lt;template v-if=&quot;curComponent&quot;&gt;
                &lt;template v-if=&quot;!curComponent.isLock&quot;&gt;
                    &lt;li @click=&quot;copy&quot;&gt;å¤åˆ¶&lt;/li&gt;
                    &lt;li @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
                    &lt;li @click=&quot;cut&quot;&gt;å‰ªåˆ‡&lt;/li&gt;
                    &lt;li @click=&quot;deleteComponent&quot;&gt;åˆ é™¤&lt;/li&gt;
                    &lt;li @click=&quot;lock&quot;&gt;é”å®š&lt;/li&gt;
                    &lt;li @click=&quot;topComponent&quot;&gt;ç½®é¡¶&lt;/li&gt;
                    &lt;li @click=&quot;bottomComponent&quot;&gt;ç½®åº•&lt;/li&gt;
                    &lt;li @click=&quot;upComponent&quot;&gt;ä¸Šç§»&lt;/li&gt;
                    &lt;li @click=&quot;downComponent&quot;&gt;ä¸‹ç§»&lt;/li&gt;
                &lt;/template&gt;
                &lt;li v-else @click=&quot;unlock&quot;&gt;è§£é”&lt;/li&gt;
            &lt;/template&gt;
            &lt;li v-else @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<figure data-type="image" tabindex="20"><img src="https://blog.luyu.icu/post-images/1613507515799.gif" alt="" loading="lazy"></figure>
<h3 id="22-å¿«æ·é”®">22. å¿«æ·é”®</h3>
<p>æ”¯æŒå¿«æ·é”®ä¸»è¦æ˜¯ä¸ºäº†æå‡å¼€å‘æ•ˆç‡ï¼Œç”¨é¼ æ ‡ç‚¹ç‚¹ç‚¹æ¯•ç«Ÿæ²¡æœ‰æŒ‰é”®ç›˜å¿«ã€‚ç›®å‰å¿«æ·é”®æ”¯æŒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<pre><code>const ctrlKey = 17, 
    vKey = 86, // ç²˜è´´
    cKey = 67, // å¤åˆ¶
    xKey = 88, // å‰ªåˆ‡

    yKey = 89, // é‡åš
    zKey = 90, // æ’¤é”€

    gKey = 71, // ç»„åˆ
    bKey = 66, // æ‹†åˆ†

    lKey = 76, // é”å®š
    uKey = 85, // è§£é”

    sKey = 83, // ä¿å­˜
    pKey = 80, // é¢„è§ˆ
    dKey = 68, // åˆ é™¤
    deleteKey = 46, // åˆ é™¤
    eKey = 69 // æ¸…ç©ºç”»å¸ƒ
</code></pre>
<p>å®ç°åŸç†ä¸»è¦æ˜¯åˆ©ç”¨ <code>window</code> å…¨å±€ç›‘å¬æŒ‰é”®äº‹ä»¶ï¼Œåœ¨ç¬¦åˆæ¡ä»¶çš„æŒ‰é”®è§¦å‘æ—¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼š</p>
<pre><code class="language-js">// ä¸ç»„ä»¶çŠ¶æ€æ— å…³çš„æ“ä½œ
const basemap = {
    [vKey]: paste,
    [yKey]: redo,
    [zKey]: undo,
    [sKey]: save,
    [pKey]: preview,
    [eKey]: clearCanvas,
}

// ç»„ä»¶é”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ
const lockMap = {
    ...basemap,
    [uKey]: unlock,
}

// ç»„ä»¶æœªé”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ
const unlockMap = {
    ...basemap,
    [cKey]: copy,
    [xKey]: cut,
    [gKey]: compose,
    [bKey]: decompose,
    [dKey]: deleteComponent,
    [deleteKey]: deleteComponent,
    [lKey]: lock,
}

let isCtrlDown = false
// å…¨å±€ç›‘å¬æŒ‰é”®æ“ä½œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤
export function listenGlobalKeyDown() {
    window.onkeydown = (e) =&gt; {
        const { curComponent } = store.state
        if (e.keyCode == ctrlKey) {
            isCtrlDown = true
        } else if (e.keyCode == deleteKey &amp;&amp; curComponent) {
            store.commit('deleteComponent')
            store.commit('recordSnapshot')
        } else if (isCtrlDown) {
            if (!curComponent || !curComponent.isLock) {
                e.preventDefault()
                unlockMap[e.keyCode] &amp;&amp; unlockMap[e.keyCode]()
            } else if (curComponent &amp;&amp; curComponent.isLock) {
                e.preventDefault()
                lockMap[e.keyCode] &amp;&amp; lockMap[e.keyCode]()
            }
        }
    }

    window.onkeyup = (e) =&gt; {
        if (e.keyCode == ctrlKey) {
            isCtrlDown = false
        }
    }
}

</code></pre>
<p>ä¸ºäº†é˜²æ­¢å’Œæµè§ˆå™¨é»˜è®¤å¿«æ·é”®å†²çªï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š <code>e.preventDefault()</code>ã€‚</p>
<h3 id="23-ç½‘æ ¼çº¿">23. ç½‘æ ¼çº¿</h3>
<p>ç½‘æ ¼çº¿åŠŸèƒ½ä½¿ç”¨ <code>SVG</code> æ¥å®ç°ï¼š</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;svg class=&quot;grid&quot; width=&quot;100%&quot; height=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
        &lt;defs&gt;
            &lt;pattern id=&quot;smallGrid&quot; width=&quot;7.236328125&quot; height=&quot;7.236328125&quot; patternUnits=&quot;userSpaceOnUse&quot;&gt;
                &lt;path 
                    d=&quot;M 7.236328125 0 L 0 0 0 7.236328125&quot; 
                    fill=&quot;none&quot; 
                    stroke=&quot;rgba(207, 207, 207, 0.3)&quot; 
                    stroke-width=&quot;1&quot;&gt;
                &lt;/path&gt;
            &lt;/pattern&gt;
            &lt;pattern id=&quot;grid&quot; width=&quot;36.181640625&quot; height=&quot;36.181640625&quot; patternUnits=&quot;userSpaceOnUse&quot;&gt;
                &lt;rect width=&quot;36.181640625&quot; height=&quot;36.181640625&quot; fill=&quot;url(#smallGrid)&quot;&gt;&lt;/rect&gt;
                &lt;path 
                    d=&quot;M 36.181640625 0 L 0 0 0 36.181640625&quot; 
                    fill=&quot;none&quot; 
                    stroke=&quot;rgba(186, 186, 186, 0.5)&quot; 
                    stroke-width=&quot;1&quot;&gt;
                &lt;/path&gt;
            &lt;/pattern&gt;
        &lt;/defs&gt;
        &lt;rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;url(#grid)&quot;&gt;&lt;/rect&gt;
    &lt;/svg&gt;
&lt;/template&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
.grid {
    position: absolute;
    top: 0;
    left: 0;
}
&lt;/style&gt;

</code></pre>
<p>å¯¹ SVG ä¸å¤ªæ‡‚çš„ï¼Œå»ºè®®çœ‹ä¸€ä¸‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG">MDN çš„æ•™ç¨‹</a>ã€‚</p>
<h3 id="24-ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼">24. ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼</h3>
<p>åœ¨ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘å·²ç»åˆ†æè¿‡å¿«ç…§çš„å®ç°åŸç†ã€‚</p>
<pre><code class="language-js">snapshotData: [], // ç¼–è¾‘å™¨å¿«ç…§æ•°æ®
snapshotIndex: -1, // å¿«ç…§ç´¢å¼•
        
undo(state) {
    if (state.snapshotIndex &gt;= 0) {
        state.snapshotIndex--
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

redo(state) {
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotIndex++
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

setComponentData(state, componentData = []) {
    Vue.set(state, 'componentData', componentData)
},

recordSnapshot(state) {
    // æ·»åŠ æ–°çš„å¿«ç…§
    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)
    // åœ¨ undo è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ æ–°çš„å¿«ç…§æ—¶ï¼Œè¦å°†å®ƒåé¢çš„å¿«ç…§æ¸…ç†æ‰
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)
    }
},
</code></pre>
<p>ç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ç¼–è¾‘å™¨çš„å¿«ç…§æ•°æ®ã€‚ä¿å­˜å¿«ç…§å°±æ˜¯ä¸åœåœ°æ‰§è¡Œ <code>push()</code> æ“ä½œï¼Œå°†å½“å‰çš„ç¼–è¾‘å™¨æ•°æ®æ¨å…¥ <code>snapshotData</code> æ•°ç»„ï¼Œå¹¶å¢åŠ å¿«ç…§ç´¢å¼• <code>snapshotIndexã€‚</code><br>
ç”±äºæ¯ä¸€æ¬¡æ·»åŠ å¿«ç…§éƒ½æ˜¯å°†å½“å‰ç¼–è¾‘å™¨çš„æ‰€æœ‰ç»„ä»¶æ•°æ®æ¨å…¥ <code>snapshotData</code>ï¼Œä¿å­˜çš„å¿«ç…§æ•°æ®è¶Šå¤šå ç”¨çš„å†…å­˜å°±è¶Šå¤šã€‚å¯¹æ­¤æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>é™åˆ¶å¿«ç…§æ­¥æ•°ï¼Œä¾‹å¦‚åªèƒ½ä¿å­˜ 50 æ­¥çš„å¿«ç…§æ•°æ®ã€‚</li>
<li>ä¿å­˜å¿«ç…§åªä¿å­˜å·®å¼‚éƒ¨åˆ†ã€‚</li>
</ol>
<p>ç°åœ¨è¯¦ç»†æè¿°ä¸€ä¸‹ç¬¬äºŒä¸ªè§£å†³æ–¹æ¡ˆã€‚<br>
å‡è®¾ä¾æ¬¡å¾€ç”»å¸ƒä¸Šæ·»åŠ  a b c d å››ä¸ªç»„ä»¶ï¼Œåœ¨åŸæ¥çš„å®ç°ä¸­ï¼Œå¯¹åº”çš„ <code>snapshotData</code> æ•°æ®ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [a],
  [a, b],
  [a, b, c],
  [a, b, c, d],
]
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥å‘ç°ï¼Œæ¯ä¸€ç›¸é‚»çš„å¿«ç…§ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€æ­¥çš„å¿«ç…§æ·»åŠ ä¸€ä¸ªç±»å‹å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæ­¤æ¬¡æ“ä½œæ˜¯æ·»åŠ è¿˜æ˜¯åˆ é™¤ã€‚</p>
<p>é‚£ä¹ˆä¸Šé¢æ·»åŠ å››ä¸ªç»„ä»¶çš„æ“ä½œï¼Œæ‰€å¯¹åº”çš„ <code>snapshotData</code> æ•°æ®ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
]
</code></pre>
<p>å¦‚æœæˆ‘ä»¬è¦åˆ é™¤ c ç»„ä»¶ï¼Œé‚£ä¹ˆ <code>snapshotData</code> æ•°æ®å°†å˜ä¸ºï¼š</p>
<pre><code>// snapshotData
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
  [{ type: 'remove', value: c }],
]
</code></pre>
<p>é‚£å¦‚ä½•ä½¿ç”¨ç°åœ¨çš„å¿«ç…§æ•°æ®å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬éœ€è¦éå†ä¸€éå¿«ç…§æ•°æ®ï¼Œæ¥ç”Ÿæˆç¼–è¾‘å™¨çš„ç»„ä»¶æ•°æ® <code>componentData</code>ã€‚å‡è®¾åœ¨ä¸Šé¢çš„æ•°æ®åŸºç¡€ä¸Šæ‰§è¡Œäº† <code>undo</code> æ’¤é”€æ“ä½œï¼š</p>
<pre><code>// snapshotData
// å¿«ç…§ç´¢å¼• snapshotIndex æ­¤æ—¶ä¸º 3
[
  [{ type: 'add', value: a }],
  [{ type: 'add', value: b }],
  [{ type: 'add', value: c }],
  [{ type: 'add', value: d }],
  [{ type: 'remove', value: c }],
]
</code></pre>
<ol>
<li>snapshotData[0] ç±»å‹ä¸º addï¼Œå°†ç»„ä»¶ a æ·»åŠ åˆ° componentData ä¸­ï¼Œæ­¤æ—¶ componentData ä¸º [a]</li>
<li>ä¾æ¬¡ç±»æ¨ [a, b]</li>
<li>[a, b, c]</li>
<li>[a, b, c, d]</li>
</ol>
<p>å¦‚æœè¿™æ—¶æ‰§è¡Œ <code>redo</code> é‡åšæ“ä½œï¼Œå¿«ç…§ç´¢å¼• <code>snapshotIndex</code> å˜ä¸º 4ã€‚å¯¹åº”çš„å¿«ç…§æ•°æ®ç±»å‹ä¸º <code>type: 'remove'</code>ï¼Œ ç§»é™¤ç»„ä»¶ cã€‚åˆ™æ•°ç»„æ•°æ®ä¸º<code>[a, b, d]</code>ã€‚<br>
è¿™ç§æ–¹æ³•å…¶å®å°±æ˜¯æ—¶é—´æ¢ç©ºé—´ï¼Œè™½ç„¶æ¯ä¸€æ¬¡ä¿å­˜çš„å¿«ç…§æ•°æ®åªæœ‰ä¸€é¡¹ï¼Œä½†æ¯æ¬¡éƒ½å¾—éå†ä¸€éæ‰€æœ‰çš„å¿«ç…§æ•°æ®ã€‚ä¸¤ç§æ–¹æ³•éƒ½ä¸å®Œç¾ï¼Œè¦ä½¿ç”¨å“ªç§å–å†³äºä½ ï¼Œç›®å‰æˆ‘ä»åœ¨ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆäºŒï¼‰]]></title>
        <id>https://blog.luyu.icu/post/1yIc3meiD/</id>
        <link href="https://blog.luyu.icu/post/1yIc3meiD/">
        </link>
        <updated>2021-02-16T18:52:40.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ‘˜è‡ª<a href="https://juejin.cn/post/6918881497264947207">æ˜é‡‘</a>,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘</p>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹ï¼š</p>
<ol>
<li>ç¼–è¾‘å™¨</li>
<li>è‡ªå®šä¹‰ç»„ä»¶</li>
<li>æ‹–æ‹½</li>
<li>åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</li>
<li>æ”¾å¤§ç¼©å°</li>
<li>æ’¤æ¶ˆã€é‡åš</li>
<li>ç»„ä»¶å±æ€§è®¾ç½®</li>
<li>å¸é™„</li>
<li>é¢„è§ˆã€ä¿å­˜ä»£ç </li>
<li>ç»‘å®šäº‹ä»¶</li>
<li>ç»‘å®šåŠ¨ç”»</li>
<li>å¯¼å…¥ PSD</li>
<li>æ‰‹æœºæ¨¡å¼</li>
</ol>
<p>ç°åœ¨è¿™ç¯‡æ–‡ç« ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå†è¡¥å…… 4 ä¸ªåŠŸèƒ½ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æ‹–æ‹½æ—‹è½¬</li>
<li>å¤åˆ¶ç²˜è´´å‰ªåˆ‡</li>
<li>æ•°æ®äº¤äº’</li>
<li>å‘å¸ƒ<br>
å’Œä¸Šç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘å·²ç»å°†æ–°åŠŸèƒ½çš„ä»£ç æ›´æ–°åˆ°äº† githubï¼š</li>
</ul>
<p><a href="https://github.com/woai3c/visual-drag-demo">github é¡¹ç›®åœ°å€</a></p>
<p><a href="https://woai3c.github.io/visual-drag-demo/#/">åœ¨çº¿é¢„è§ˆ</a></p>
<p><strong>å‹å–„æé†’</strong>ï¼š å»ºè®®ç»“åˆæºç ä¸€èµ·é˜…è¯»ï¼Œæ•ˆæœæ›´å¥½ï¼ˆè¿™ä¸ª DEMO ä½¿ç”¨çš„æ˜¯ Vue æŠ€æœ¯æ ˆï¼‰ã€‚</p>
<h3 id="14-æ‹–æ‹½æ—‹è½¬">14. æ‹–æ‹½æ—‹è½¬</h3>
<p>åœ¨å†™ä¸Šä¸€ç¯‡æ–‡ç« æ—¶ï¼ŒåŸæ¥çš„ DEMO å·²ç»å¯ä»¥æ”¯æŒæ—‹è½¬åŠŸèƒ½äº†ã€‚ä½†æ˜¯è¿™ä¸ªæ—‹è½¬åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä¸æ”¯æŒæ‹–æ‹½æ—‹è½¬ã€‚</li>
<li>æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¸æ­£ç¡®ã€‚</li>
<li>æ—‹è½¬åçš„è‡ªåŠ¨å¸é™„ä¸æ­£ç¡®ã€‚</li>
<li>æ—‹è½¬åå…«ä¸ªå¯ä¼¸ç¼©ç‚¹çš„å…‰æ ‡ä¸æ­£ç¡®ã€‚</li>
</ol>
<p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†é€ä¸€è§£å†³è¿™å››ä¸ªé—®é¢˜ã€‚</p>
<h4 id="æ‹–æ‹½æ—‹è½¬">æ‹–æ‹½æ—‹è½¬</h4>
<p>æ‹–æ‹½æ—‹è½¬éœ€è¦ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2"><code>Math.atan2()</code></a>å‡½æ•°ã€‚</p>
<blockquote>
<p>Math.atan2() è¿”å›ä»åŸç‚¹(0,0)åˆ°(x,y)ç‚¹çš„çº¿æ®µä¸xè½´æ­£æ–¹å‘ä¹‹é—´çš„å¹³é¢è§’åº¦(å¼§åº¦å€¼)ï¼Œä¹Ÿå°±æ˜¯Math.atan2(y,x)ã€‚Math.atan2(y,x)ä¸­çš„yå’Œxéƒ½æ˜¯ç›¸å¯¹äºåœ†ç‚¹(0,0)çš„è·ç¦»ã€‚</p>
</blockquote>
<p>ç®€å•çš„è¯´å°±æ˜¯ä»¥ç»„ä»¶ä¸­å¿ƒç‚¹ä¸ºåŸç‚¹<code>(centerX,centerY)</code>ï¼Œç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡æ—¶çš„åæ ‡è®¾ä¸º <code>(startX,startY)</code>ï¼Œé¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º<code>(curX,curY)</code>ã€‚æ—‹è½¬è§’åº¦å¯ä»¥é€šè¿‡ <code>(startX,startY)</code>å’Œ <code>(curX,curY)</code>è®¡ç®—å¾—å‡ºã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613501916438.png" alt="" loading="lazy"></p>
<p>é‚£æˆ‘ä»¬å¦‚ä½•å¾—åˆ°ä»ç‚¹ <code>(startX,startY)</code>åˆ°ç‚¹<code>(curX,curY)</code>ä¹‹é—´çš„æ—‹è½¬è§’åº¦å‘¢ï¼Ÿ</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œé¼ æ ‡ç‚¹å‡»æ—¶çš„åæ ‡è®¾ä¸º<code>(startX,startY)</code>ï¼š</p>
<pre><code class="language-js">const startY = e.clientY
const startX = e.clientX
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">// è·å–ç»„ä»¶ä¸­å¿ƒç‚¹ä½ç½®
const rect = this.$el.getBoundingClientRect()
const centerX = rect.left + rect.width / 2
const centerY = rect.top + rect.height / 2
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼ŒæŒ‰ä½é¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º<code>(curX,curY)</code>ï¼š</p>
<pre><code class="language-js">const curX = moveEvent.clientX
const curY = moveEvent.clientY
</code></pre>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œåˆ†åˆ«ç®—å‡º<code>(startX,startY)</code>å’Œ<code>(curX,curY)</code> å¯¹åº”çš„è§’åº¦ï¼Œå†å°†å®ƒä»¬ç›¸å‡å¾—å‡ºæ—‹è½¬çš„è§’åº¦ã€‚å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„å°±æ˜¯ <code>Math.atan2()</code>æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼§åº¦ï¼Œå› æ­¤è¿˜éœ€è¦å°†å¼§åº¦è½¬åŒ–ä¸ºè§’åº¦ã€‚æ‰€ä»¥å®Œæ•´çš„ä»£ç ä¸ºï¼š</p>
<pre><code class="language-js">// æ—‹è½¬å‰çš„è§’åº¦
const rotateDegreeBefore = Math.atan2(startY - centerY, startX - centerX) / (Math.PI / 180)
// æ—‹è½¬åçš„è§’åº¦
const rotateDegreeAfter = Math.atan2(curY - centerY, curX - centerX) / (Math.PI / 180)
// è·å–æ—‹è½¬çš„è§’åº¦å€¼ï¼Œ startRotate ä¸ºåˆå§‹è§’åº¦å€¼
pos.rotate = startRotate + rotateDegreeAfter - rotateDegreeBefore
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613502114333.gif" alt="" loading="lazy"></figure>
<h4 id="æ”¾å¤§ç¼©å°">æ”¾å¤§ç¼©å°</h4>
<p>ç»„ä»¶æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¼šæœ‰ BUGã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613502171703.gif" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ”¾å¤§ç¼©å°æ—¶ä¼šå‘ç”Ÿç§»ä½ã€‚å¦å¤–ä¼¸ç¼©çš„æ–¹å‘å’Œæˆ‘ä»¬æ‹–åŠ¨çš„æ–¹å‘ä¹Ÿä¸å¯¹ã€‚é€ æˆè¿™ä¸€ BUG çš„åŸå› æ˜¯ï¼šå½“åˆè®¾è®¡æ”¾å¤§ç¼©å°åŠŸèƒ½æ²¡æœ‰è€ƒè™‘åˆ°æ—‹è½¬çš„åœºæ™¯ã€‚æ‰€ä»¥æ— è®ºæ—‹è½¬å¤šå°‘è§’åº¦ï¼Œæ”¾å¤§ç¼©å°ä»ç„¶æ˜¯æŒ‰æ²¡æ—‹è½¬æ—¶è®¡ç®—çš„ã€‚</p>
<p>ä¸‹é¢å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613502210577.png" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ²¡æœ‰æ—‹è½¬æ—¶ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸Šæ‹–åŠ¨ï¼Œåªéœ€ç”¨ <code>y2 - y1</code> å°±å¯ä»¥å¾—å‡ºæ‹–åŠ¨è·ç¦»<code>s</code>ã€‚è¿™æ—¶å°†ç»„ä»¶åŸæ¥çš„é«˜åº¦åŠ ä¸Š <code>s</code> å°±èƒ½å¾—å‡ºæ–°çš„é«˜åº¦ï¼ŒåŒæ—¶å°†ç»„ä»¶çš„ <code>top</code>ã€<code>left</code> å±æ€§æ›´æ–°ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://blog.luyu.icu/post-images/1613502283095.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨æ—‹è½¬ 180 åº¦ï¼Œå¦‚æœè¿™æ—¶æ‹–ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼Œæˆ‘ä»¬æœŸå¾…çš„ç»“æœæ˜¯ç»„ä»¶é«˜åº¦å¢åŠ ã€‚ä½†è¿™æ—¶è®¡ç®—çš„æ–¹å¼å’ŒåŸæ¥æ²¡æ—‹è½¬æ—¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç»“æœå’Œæˆ‘ä»¬æœŸå¾…çš„ç›¸åï¼Œç»„ä»¶çš„é«˜åº¦å°†ä¼šå˜å°ï¼ˆå¦‚æœä¸ç†è§£è¿™ä¸ªç°è±¡ï¼Œå¯ä»¥æƒ³åƒä¸€ä¸‹æ²¡æœ‰æ—‹è½¬çš„é‚£å¼ å›¾ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼‰ã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://blog.luyu.icu/post-images/1613502327476.gif" alt="" loading="lazy"></figure>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä» github ä¸Šçš„ä¸€ä¸ªé¡¹ç›®<a href="https://github.com/shenhudong/snapping-demo/wiki/corner-handle"> <code>snapping-demo</code> </a>æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šå°†æ”¾å¤§ç¼©å°å’Œæ—‹è½¬è§’åº¦å…³è”èµ·æ¥ã€‚</p>
<h5 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h5>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://blog.luyu.icu/post-images/1613502421743.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨æˆ‘ä»¬å°†ä¸€æ­¥æ­¥åˆ†æå¦‚ä½•å¾—å‡ºæ‹‰ä¼¸åçš„ç»„ä»¶çš„æ­£ç¡®å¤§å°å’Œä½ç§»ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼ŒæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ top left å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const center = {
    x: style.left + style.width / 2,
    y: style.top + style.height / 2,
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç”¨<strong>å½“å‰ç‚¹å‡»åæ ‡</strong>å’Œ<strong>ç»„ä»¶ä¸­å¿ƒç‚¹ç®—</strong>å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š</p>
<pre><code class="language-js">// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯
const editorRectInfo = document.querySelector('#editor').getBoundingClientRect()

// å½“å‰ç‚¹å‡»åæ ‡
const curPoint = {
    x: e.clientX - editorRectInfo.left,
    y: e.clientY - editorRectInfo.top,
}

// è·å–å¯¹ç§°ç‚¹çš„åæ ‡
const symmetricPoint = {
    x: center.x - (curPoint.x - center.x),
    y: center.y - (curPoint.y - center.y),
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š</p>
<pre><code class="language-js">const curPositon = {
    x: moveEvent.clientX - editorRectInfo.left,
    y: moveEvent.clientY - editorRectInfo.top,
}

const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)

// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡
function getCenterPoint(p1, p2) {
    return {
        x: p1.x + ((p2.x - p1.x) / 2),
        y: p1.y + ((p2.y - p1.y) / 2),
    }
}
</code></pre>
<p>ç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„<code>xy</code>è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.luyu.icu/post-images/1613502562307.png" alt="" loading="lazy"></figure>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ <code>currentPosition</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newTopLeftPoint</code>ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ <code>sPoint</code> åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ <code>newBottomRightPoint</code>ã€‚<br>
å¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡
 * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡
 * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ
 * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦
 * @return  {Object}         æ—‹è½¬åçš„åæ ‡
 * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼
 */
export function calculateRotatedPointCoordinate(point, center, rotate) {
    /**
     * æ—‹è½¬å…¬å¼ï¼š
     *  ç‚¹a(x, y)
     *  æ—‹è½¬ä¸­å¿ƒc(x, y)
     *  æ—‹è½¬åç‚¹n(x, y)
     *  æ—‹è½¬è§’åº¦Î¸                tan ??
     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx
     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy
     */

    return {
        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,
        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,
    }
}
</code></pre>
<p>ä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»<a href="https://www.zhihu.com/question/67425734/answer/252724399">çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”</a>ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://blog.luyu.icu/post-images/1613502683980.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="9"><img src="https://blog.luyu.icu/post-images/1613502701696.png" alt="" loading="lazy"></figure>
<p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼<code>top</code>ã€<code>left</code> ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function calculateLeftTop(style, curPositon, pointInfo) {
    const { symmetricPoint } = pointInfo
    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)
    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)
    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)
  
    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x
    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y
    if (newWidth &gt; 0 &amp;&amp; newHeight &gt; 0) {
        style.width = Math.round(newWidth)
        style.height = Math.round(newHeight)
        style.left = Math.round(newTopLeftPoint.x)
        style.top = Math.round(newTopLeftPoint.y)
    }
}
</code></pre>
<p>ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://blog.luyu.icu/post-images/1613502785374.gif" alt="" loading="lazy"></figure>
<h4 id="è‡ªåŠ¨å¸é™„">è‡ªåŠ¨å¸é™„</h4>
<p>è‡ªåŠ¨å¸é™„æ˜¯æ ¹æ®ç»„ä»¶çš„å››ä¸ªå±æ€§ <code>top</code>ã€<code>left</code> ã€<code>width</code> ã€<code>height</code> è®¡ç®—çš„ï¼Œåœ¨å°†ç»„ä»¶è¿›è¡Œæ—‹è½¬åï¼Œè¿™äº›å±æ€§çš„å€¼æ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥æ— è®ºç»„ä»¶æ—‹è½¬å¤šå°‘åº¦ï¼Œå¸é™„æ—¶ä»ç„¶æŒ‰æœªæ—‹è½¬æ—¶è®¡ç®—ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„ <code>top</code>ã€<code>left</code> ã€<code>width</code> ã€<code>height</code> å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚</p>
<figure data-type="image" tabindex="11"><img src="https://blog.luyu.icu/post-images/1613502878822.png" alt="" loading="lazy"></figure>
<p>å¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„ <code>height</code> å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„é«˜åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±å‡ºç°äº†å¸é™„ä¸æ­£ç¡®çš„ BUGã€‚</p>
<figure data-type="image" tabindex="12"><img src="https://blog.luyu.icu/post-images/1613502923904.gif" alt="" loading="lazy"></figure>
<h5 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h5>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬éœ€è¦æ‹¿ç»„ä»¶æ—‹è½¬åçš„å¤§å°åŠä½ç§»æ¥åšå¸é™„å¯¹æ¯”ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸è¦æ‹¿ç»„ä»¶å®é™…çš„å±æ€§æ¥å¯¹æ¯”ï¼Œè€Œæ˜¯æ‹¿æˆ‘ä»¬çœ‹åˆ°çš„å¤§å°å’Œä½ç§»åšå¯¹æ¯”ã€‚</p>
<figure data-type="image" tabindex="13"><img src="https://blog.luyu.icu/post-images/1613502993620.png" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ—‹è½¬åçš„ç»„ä»¶åœ¨ x è½´ä¸Šçš„æŠ•å°„é•¿åº¦ä¸ºä¸¤æ¡çº¢çº¿é•¿åº¦ä¹‹å’Œã€‚è¿™ä¸¤æ¡çº¢çº¿çš„é•¿åº¦å¯ä»¥é€šè¿‡æ­£å¼¦å’Œä½™å¼¦ç®—å‡ºï¼Œå·¦è¾¹çš„çº¢çº¿ç”¨æ­£å¼¦è®¡ç®—ï¼Œå³è¾¹çš„çº¢çº¿ç”¨ä½™å¼¦è®¡ç®—ï¼š</p>
<pre><code class="language-js">const newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)
</code></pre>
<p>åŒç†ï¼Œé«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p>
<pre><code class="language-js">const newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)
</code></pre>
<p>æ–°çš„å®½åº¦å’Œé«˜åº¦æœ‰äº†ï¼Œå†æ ¹æ®ç»„ä»¶åŸæœ‰çš„ <code>top</code>ã€ <code>left</code> å±æ€§ï¼Œå¯ä»¥å¾—å‡ºç»„ä»¶æ—‹è½¬åæ–°çš„<code>top</code>ã€ <code>left</code>  å±æ€§ã€‚ä¸‹é¢é™„ä¸Šå®Œæ•´ä»£ç ï¼š</p>
<pre><code class="language-js">translateComponentStyle(style) {
    style = { ...style }
    if (style.rotate != 0) {
        const newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)
        const diffX = (style.width - newWidth) / 2
        style.left += diffX
        style.right = style.left + newWidth

        const newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)
        const diffY = (newHeight - style.height) / 2
        style.top -= diffY
        style.bottom = style.top + newHeight

        style.width = newWidth
        style.height = newHeight
    } else {
        style.bottom = style.top + style.height
        style.right = style.left + style.width
    }

    return style
}
</code></pre>
<p>ç»è¿‡ä¿®å¤åï¼Œå¸é™„ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†</p>
<figure data-type="image" tabindex="14"><img src="https://blog.luyu.icu/post-images/1613503143257.gif" alt="" loading="lazy"></figure>
<h4 id="å…‰æ ‡">å…‰æ ‡</h4>
<p>å…‰æ ‡å’Œå¯æ‹–åŠ¨çš„æ–¹å‘ä¸å¯¹ï¼Œæ˜¯å› ä¸ºå…«ä¸ªç‚¹çš„å…‰æ ‡æ˜¯å›ºå®šè®¾ç½®çš„ï¼Œæ²¡æœ‰éšç€è§’åº¦å˜åŒ–è€Œå˜åŒ–ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://blog.luyu.icu/post-images/1613503197769.gif" alt="" loading="lazy"></figure>
<h5 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h5>
<p>ç”±äº <code>360 / 8 = 45</code>ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ–¹å‘åˆ†é… 45 åº¦çš„èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´å¯¹åº”ä¸€ä¸ªå…‰æ ‡ã€‚åŒæ—¶ä¸ºæ¯ä¸ªæ–¹å‘è®¾ç½®ä¸€ä¸ªåˆå§‹è§’åº¦ï¼Œä¹Ÿå°±æ˜¯æœªæ—‹è½¬æ—¶ç»„ä»¶æ¯ä¸ªæ–¹å‘å¯¹åº”çš„è§’åº¦ã€‚</p>
<figure data-type="image" tabindex="16"><img src="https://blog.luyu.icu/post-images/1613503255637.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">pointList: ['lt', 't', 'rt', 'r', 'rb', 'b', 'lb', 'l'], // å…«ä¸ªæ–¹å‘
initialAngle: { // æ¯ä¸ªç‚¹å¯¹åº”çš„åˆå§‹è§’åº¦
    lt: 0,
    t: 45,
    rt: 90,
    r: 135,
    rb: 180,
    b: 225,
    lb: 270,
    l: 315,
},
angleToCursor: [ // æ¯ä¸ªèŒƒå›´çš„è§’åº¦å¯¹åº”çš„å…‰æ ‡
    { start: 338, end: 23, cursor: 'nw' },
    { start: 23, end: 68, cursor: 'n' },
    { start: 68, end: 113, cursor: 'ne' },
    { start: 113, end: 158, cursor: 'e' },
    { start: 158, end: 203, cursor: 'se' },
    { start: 203, end: 248, cursor: 's' },
    { start: 248, end: 293, cursor: 'sw' },
    { start: 293, end: 338, cursor: 'w' },
],
cursors: {},
</code></pre>
<p>è®¡ç®—æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ol>
<li>å‡è®¾ç°åœ¨ç»„ä»¶å·²æ—‹è½¬äº†ä¸€å®šçš„è§’åº¦ aã€‚</li>
<li>éå†å…«ä¸ªæ–¹å‘ï¼Œç”¨æ¯ä¸ªæ–¹å‘çš„åˆå§‹è§’åº¦ + a å¾—å‡ºç°åœ¨çš„è§’åº¦ bã€‚</li>
<li>éå† angleToCursor æ•°ç»„ï¼Œçœ‹çœ‹ b åœ¨å“ªä¸€ä¸ªèŒƒå›´ä¸­ï¼Œç„¶åå°†å¯¹åº”çš„å…‰æ ‡è¿”å›ã€‚</li>
</ol>
<p>ç»è¿‡ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤å°±å¯ä»¥è®¡ç®—å‡ºç»„ä»¶æ—‹è½¬åæ­£ç¡®çš„å…‰æ ‡æ–¹å‘ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">getCursor() {
    const { angleToCursor, initialAngle, pointList, curComponent } = this
    const rotate = (curComponent.style.rotate + 360) % 360 // é˜²æ­¢è§’åº¦æœ‰è´Ÿæ•°ï¼Œæ‰€ä»¥ + 360
    const result = {}
    let lastMatchIndex = -1 // ä»ä¸Šä¸€ä¸ªå‘½ä¸­çš„è§’åº¦çš„ç´¢å¼•å¼€å§‹åŒ¹é…ä¸‹ä¸€ä¸ªï¼Œé™ä½æ—¶é—´å¤æ‚åº¦
    pointList.forEach(point =&gt; {
        const angle = (initialAngle[point] + rotate) % 360
        const len = angleToCursor.length
        while (true) {
            lastMatchIndex = (lastMatchIndex + 1) % len
            const angleLimit = angleToCursor[lastMatchIndex]
            if (angle &lt; 23 || angle &gt;= 338) {
                result[point] = 'nw-resize'
                return
            }

            if (angleLimit.start &lt;= angle &amp;&amp; angle &lt; angleLimit.end) {
                result[point] = angleLimit.cursor + '-resize'
                return
            }
        }
    })

    return result
},
</code></pre>
<figure data-type="image" tabindex="17"><img src="https://blog.luyu.icu/post-images/1613503358536.gif" alt="" loading="lazy"></figure>
<p>ä»ä¸Šé¢çš„åŠ¨å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œç°åœ¨å…«ä¸ªæ–¹å‘ä¸Šçš„å…‰æ ‡æ˜¯å¯ä»¥æ­£ç¡®æ˜¾ç¤ºçš„ã€‚</p>
<h3 id="15-å¤åˆ¶ç²˜è´´å‰ªåˆ‡">15. å¤åˆ¶ç²˜è´´å‰ªåˆ‡</h3>
<p>ç›¸å¯¹äºæ‹–æ‹½æ—‹è½¬åŠŸèƒ½ï¼Œå¤åˆ¶ç²˜è´´å°±æ¯”è¾ƒç®€å•äº†ã€‚</p>
<pre><code class="language-js">const ctrlKey = 17, vKey = 86, cKey = 67, xKey = 88
let isCtrlDown = false

window.onkeydown = (e) =&gt; {
    if (e.keyCode == ctrlKey) {
        isCtrlDown = true
    } else if (isCtrlDown &amp;&amp; e.keyCode == cKey) {
        this.$store.commit('copy')
    } else if (isCtrlDown &amp;&amp; e.keyCode == vKey) {
        this.$store.commit('paste')
    } else if (isCtrlDown &amp;&amp; e.keyCode == xKey) {
        this.$store.commit('cut')
    }
}

window.onkeyup = (e) =&gt; {
    if (e.keyCode == ctrlKey) {
        isCtrlDown = false
    }
}
</code></pre>
<p>ç›‘å¬ç”¨æˆ·çš„æŒ‰é”®æ“ä½œï¼Œåœ¨æŒ‰ä¸‹ç‰¹å®šæŒ‰é”®æ—¶è§¦å‘å¯¹åº”çš„æ“ä½œã€‚</p>
<h5 id="å¤åˆ¶æ“ä½œ">å¤åˆ¶æ“ä½œ</h5>
<p>åœ¨ <code>vuex</code> ä¸­ä½¿ç”¨ <code>copyData</code> æ¥è¡¨ç¤ºå¤åˆ¶çš„æ•°æ®ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹ <code>ctrl + c</code> æ—¶ï¼Œå°†å½“å‰ç»„ä»¶æ•°æ®æ·±æ‹·è´åˆ° <code>copyData</code>ã€‚</p>
<pre><code class="language-js">copy(state) {
    state.copyData = {
        data: deepCopy(state.curComponent),
        index: state.curComponentIndex,
    }
},
</code></pre>
<p>åŒæ—¶éœ€è¦å°†å½“å‰ç»„ä»¶åœ¨ç»„ä»¶æ•°æ®ä¸­çš„ç´¢å¼•è®°å½•èµ·æ¥ï¼Œåœ¨å‰ªåˆ‡ä¸­è¦ç”¨åˆ°ã€‚</p>
<h5 id="ç²˜è´´æ“ä½œ">ç²˜è´´æ“ä½œ</h5>
<pre><code class="language-js">paste(state, isMouse) {
    if (!state.copyData) {
        toast('è¯·é€‰æ‹©ç»„ä»¶')
        return
    }

    const data = state.copyData.data

    if (isMouse) {
        data.style.top = state.menuTop
        data.style.left = state.menuLeft
    } else {
        data.style.top += 10
        data.style.left += 10
    }

    data.id = generateID()
    store.commit('addComponent', { component: data })
    store.commit('recordSnapshot')
    state.copyData = null
},
</code></pre>
<p>ç²˜è´´æ—¶ï¼Œå¦‚æœæ˜¯æŒ‰é”®æ“ä½œ <code>ctrl+v</code>ã€‚åˆ™å°†ç»„ä»¶çš„ <code>top</code>ã€<code>left</code> å±æ€§åŠ  10ï¼Œä»¥å…å’ŒåŸæ¥çš„ç»„ä»¶é‡å åœ¨ä¸€èµ·ã€‚å¦‚æœæ˜¯ä½¿ç”¨é¼ æ ‡å³é”®æ‰§è¡Œç²˜è´´æ“ä½œï¼Œåˆ™å°†å¤åˆ¶çš„ç»„ä»¶æ”¾åˆ°é¼ æ ‡ç‚¹å‡»å¤„ã€‚</p>
<h5 id="å‰ªåˆ‡æ“ä½œ">å‰ªåˆ‡æ“ä½œ</h5>
<pre><code class="language-js">cut(state) {
    if (!state.curComponent) {
        toast('è¯·é€‰æ‹©ç»„ä»¶')
        return
    }

    if (state.copyData) {
        store.commit('addComponent', { component: state.copyData.data, index: state.copyData.index })
        if (state.curComponentIndex &gt;= state.copyData.index) {
            // å¦‚æœå½“å‰ç»„ä»¶ç´¢å¼•å¤§äºç­‰äºæ’å…¥ç´¢å¼•ï¼Œéœ€è¦åŠ ä¸€ï¼Œå› ä¸ºå½“å‰ç»„ä»¶å¾€åç§»äº†ä¸€ä½
            state.curComponentIndex++
        }
    }

    store.commit('copy')
    store.commit('deleteComponent')
},
</code></pre>
<p>å‰ªåˆ‡æ“ä½œæœ¬è´¨ä¸Šè¿˜æ˜¯å¤åˆ¶ï¼Œåªä¸è¿‡åœ¨æ‰§è¡Œå¤åˆ¶åï¼Œéœ€è¦å°†å½“å‰ç»„ä»¶åˆ é™¤ã€‚ä¸ºäº†é¿å…ç”¨æˆ·æ‰§è¡Œå‰ªåˆ‡æ“ä½œåï¼Œä¸æ‰§è¡Œç²˜è´´æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå‰ªåˆ‡ã€‚è¿™æ—¶å°±éœ€è¦å°†åŸå…ˆå‰ªåˆ‡çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚æ‰€ä»¥å¤åˆ¶æ•°æ®ä¸­è®°å½•çš„ç´¢å¼•å°±èµ·ä½œç”¨äº†ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å°†åŸæ¥çš„æ•°æ®æ¢å¤åˆ°åŸæ¥çš„ä½ç½®ä¸­ã€‚</p>
<h5 id="å³é”®æ“ä½œ">å³é”®æ“ä½œ</h5>
<p>å³é”®æ“ä½œå’ŒæŒ‰é”®æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªåŠŸèƒ½ä¸¤ç§è§¦å‘é€”å¾„ã€‚</p>
<pre><code class="language-js">&lt;li @click=&quot;copy&quot; v-show=&quot;curComponent&quot;&gt;å¤åˆ¶&lt;/li&gt;
&lt;li @click=&quot;paste&quot;&gt;ç²˜è´´&lt;/li&gt;
&lt;li @click=&quot;cut&quot; v-show=&quot;curComponent&quot;&gt;å‰ªåˆ‡&lt;/li&gt;

cut() {
    this.$store.commit('cut')
},

copy() {
    this.$store.commit('copy')
},

paste() {
    this.$store.commit('paste', true)
},
</code></pre>
<h3 id="16-æ•°æ®äº¤äº’">16. æ•°æ®äº¤äº’</h3>
<h4 id="æ–¹å¼ä¸€">æ–¹å¼ä¸€</h4>
<p>æå‰å†™å¥½ä¸€ç³»åˆ— <code>ajax</code> è¯·æ±‚<code>API</code>ï¼Œç‚¹å‡»ç»„ä»¶æ—¶æŒ‰éœ€é€‰æ‹©<code>API</code>ï¼Œé€‰å¥½ <code>API</code> å†å¡«å‚æ•°ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç»„ä»¶ï¼Œå°±å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>ajax</code> è¯·æ±‚å‘åå°äº¤äº’ï¼š</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div&gt;{{ propValue.data }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    // propValue: {
    //     api: {
    //             request: a,
    //             params,
    //      },
    //     data: null
    // }
    props: {
        propValue: {
            type: Object,
            default: () =&gt; {},
        },
    },
    created() {
        this.propValue.api.request(this.propValue.api.params).then(res =&gt; {
            this.propValue.data = res.data
        })
    },
}
&lt;/script&gt;
</code></pre>
<h4 id="æ–¹å¼äºŒ">æ–¹å¼äºŒ</h4>
<p>æ–¹å¼äºŒé€‚åˆçº¯å±•ç¤ºçš„ç»„ä»¶ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªæŠ¥è­¦ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®åå°ä¼ æ¥çš„æ•°æ®æ˜¾ç¤ºå¯¹åº”çš„é¢œè‰²ã€‚åœ¨ç¼–è¾‘é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>ajax</code> å‘åå°è¯·æ±‚é¡µé¢èƒ½å¤Ÿä½¿ç”¨çš„ <code>websocket</code> æ•°æ®ï¼š</p>
<pre><code class="language-js">const data = ['status', 'text'...]
</code></pre>
<p>ç„¶åå†ä¸ºä¸åŒçš„ç»„ä»¶æ·»åŠ ä¸Šä¸åŒçš„å±æ€§ã€‚ä¾‹å¦‚æœ‰ a ç»„ä»¶ï¼Œå®ƒç»‘å®šçš„å±æ€§ä¸º <code>status</code>ã€‚</p>
<pre><code class="language-js">// ç»„ä»¶èƒ½æ¥æ”¶çš„æ•°æ®
props: {
    propValue: {
        type: String,
    },
    element: {
        type: Object,
    },
    wsKey: {
        type: String,
        default: '',
    },
},
</code></pre>
<p>åœ¨ç»„ä»¶ä¸­é€šè¿‡ <code>wsKey</code> è·å–è¿™ä¸ªç»‘å®šçš„å±æ€§ã€‚ç­‰é¡µé¢å‘å¸ƒåæˆ–è€…é¢„è§ˆæ—¶ï¼Œé€šè¿‡ <code>weboscket</code> å‘åå°è¯·æ±‚å…¨å±€æ•°æ®æ”¾åœ¨ <code>vuex</code> ä¸Šã€‚ç»„ä»¶å°±å¯ä»¥é€šè¿‡ <code>wsKey</code> è®¿é—®æ•°æ®äº†ã€‚</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div&gt;{{ wsData[wsKey] }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'

export default {
    props: {
        propValue: {
            type: String,
        },
        element: {
            type: Object,
        },
        wsKey: {
            type: String,
            default: '',
        },
    },
    computed: mapState([
        'wsData',
    ]),
&lt;/script&gt;
</code></pre>
<p>å’Œåå°äº¤äº’çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¸ä»…ä»…åŒ…æ‹¬ä¸Šé¢ä¸¤ç§ï¼Œæˆ‘åœ¨è¿™é‡Œä»…æä¾›ä¸€äº›æ€è·¯ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
<h3 id="17-å‘å¸ƒ">17. å‘å¸ƒ</h3>
<p>é¡µé¢å‘å¸ƒæœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€æ˜¯å°†ç»„ä»¶æ•°æ®æ¸²æŸ“ä¸ºä¸€ä¸ªå•ç‹¬çš„ HTML é¡µé¢ï¼›äºŒæ˜¯ä»æœ¬é¡¹ç›®ä¸­æŠ½å–å‡ºä¸€ä¸ªæœ€å°è¿è¡Œæ—¶ runtime ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚<br>
è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬äºŒç§æ–¹å¼ï¼Œæœ¬é¡¹ç›®ä¸­çš„æœ€å°è¿è¡Œæ—¶å…¶å®å°±æ˜¯é¢„è§ˆé¡µé¢åŠ ä¸Šè‡ªå®šä¹‰ç»„ä»¶ã€‚å°†è¿™äº›ä»£ç æå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªé¡¹ç›®å•ç‹¬æ‰“åŒ…ã€‚å‘å¸ƒé¡µé¢æ—¶å°†ç»„ä»¶æ•°æ®ä»¥ JSON çš„æ ¼å¼ä¼ ç»™æœåŠ¡ç«¯ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ IDã€‚<br>
å‡è®¾ç°åœ¨æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œå‘å¸ƒé¡µé¢ç”Ÿæˆçš„ ID ä¸º aã€bã€cã€‚è®¿é—®é¡µé¢æ—¶åªéœ€è¦æŠŠ ID å¸¦ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ® ID è·å–æ¯ä¸ªé¡µé¢å¯¹åº”çš„ç»„ä»¶æ•°æ®ã€‚</p>
<pre><code>www.test.com/?id=a
www.test.com/?id=c
www.test.com/?id=b
</code></pre>
<h4 id="æŒ‰éœ€åŠ è½½">æŒ‰éœ€åŠ è½½</h4>
<p>å¦‚æœè‡ªå®šä¹‰ç»„ä»¶è¿‡å¤§ï¼Œä¾‹å¦‚æœ‰æ•°åä¸ªç”šè‡³ä¸Šç™¾ä¸ªã€‚è¿™æ—¶å¯ä»¥å°†è‡ªå®šä¹‰ç»„ä»¶ç”¨ import çš„æ–¹å¼å¯¼å…¥ï¼Œåšåˆ°æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘é¦–å±æ¸²æŸ“æ—¶é—´ï¼š</p>
<pre><code class="language-js">import Vue from 'vue'

const components = [
    'Picture',
    'VText',
    'VButton',
]

components.forEach(key =&gt; {
    Vue.component(key, () =&gt; import(`@/custom-component/${key}`))
})
</code></pre>
<h4 id="æŒ‰ç‰ˆæœ¬å‘å¸ƒ">æŒ‰ç‰ˆæœ¬å‘å¸ƒ</h4>
<p>è‡ªå®šä¹‰ç»„ä»¶æœ‰å¯èƒ½ä¼šæœ‰æ›´æ–°çš„æƒ…å†µã€‚ä¾‹å¦‚åŸæ¥çš„ç»„ä»¶ä½¿ç”¨äº†å¤§åŠå¹´ï¼Œç°åœ¨æœ‰åŠŸèƒ½å˜æ›´ï¼Œä¸ºäº†ä¸å½±å“åŸæ¥çš„é¡µé¢ã€‚å»ºè®®åœ¨å‘å¸ƒæ—¶å¸¦ä¸Šç»„ä»¶çš„ç‰ˆæœ¬å·ï¼š</p>
<pre><code>- v-text
  - v1.vue
  - v2.vue
</code></pre>
<p>ä¾‹å¦‚ <code>v-text</code> ç»„ä»¶æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåœ¨å·¦ä¾§ç»„ä»¶åˆ—è¡¨åŒºä½¿ç”¨æ—¶å°±å¯ä»¥å¸¦ä¸Šç‰ˆæœ¬å·ï¼š</p>
<pre><code class="language-js">{
  component: 'v-text',
  version: 'v1'
  ...
}
</code></pre>
<p>è¿™æ ·å¯¼å…¥ç»„ä»¶æ—¶å°±å¯ä»¥æ ¹æ®ç»„ä»¶ç‰ˆæœ¬å·è¿›è¡Œå¯¼å…¥ï¼š</p>
<pre><code class="language-js">import Vue from 'vue'
import componentList from '@/custom-component/component-list`

componentList.forEach(component =&gt; {
    Vue.component(component.name, () =&gt; import(`@/custom-component/${component.name}/${component.version}`))
})
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸€ï¼‰]]></title>
        <id>https://blog.luyu.icu/post/gFf8ea3r7/</id>
        <link href="https://blog.luyu.icu/post/gFf8ea3r7/">
        </link>
        <updated>2021-02-16T17:33:54.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ‘˜è‡ª<a href="https://juejin.cn/post/6908502083075325959">æ˜é‡‘</a>,å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘</p>
<p>æœ¬æ–‡ä¸»è¦å¯¹ä»¥ä¸‹æŠ€æœ¯è¦ç‚¹è¿›è¡Œåˆ†æï¼š</p>
<ol>
<li>ç¼–è¾‘å™¨</li>
<li>è‡ªå®šä¹‰ç»„ä»¶</li>
<li>æ‹–æ‹½</li>
<li>åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</li>
<li>æ”¾å¤§ç¼©å°</li>
<li>æ’¤æ¶ˆã€é‡åš</li>
<li>ç»„ä»¶å±æ€§è®¾ç½®</li>
<li>å¸é™„</li>
<li>é¢„è§ˆã€ä¿å­˜ä»£ç </li>
<li>ç»‘å®šäº‹ä»¶</li>
<li>ç»‘å®šåŠ¨ç”»</li>
<li>å¯¼å…¥ PSD</li>
<li>æ‰‹æœºæ¨¡å¼</li>
</ol>
<p>ä¸ºäº†è®©æœ¬æ–‡æ›´åŠ å®¹æ˜“ç†è§£ï¼Œæˆ‘å°†ä»¥ä¸ŠæŠ€æœ¯è¦ç‚¹ç»“åˆåœ¨ä¸€èµ·å†™äº†ä¸€ä¸ªå¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ DEMOï¼š</p>
<p><a href="https://github.com/woai3c/visual-drag-demo">github é¡¹ç›®åœ°å€</a></p>
<p><a href="https://woai3c.github.io/visual-drag-demo/#/">åœ¨çº¿é¢„è§ˆ</a></p>
<p>å»ºè®®ç»“åˆæºç ä¸€èµ·é˜…è¯»ï¼Œæ•ˆæœæ›´å¥½ï¼ˆè¿™ä¸ª DEMO ä½¿ç”¨çš„æ˜¯ Vue æŠ€æœ¯æ ˆï¼‰ã€‚</p>
<h3 id="1-ç¼–è¾‘å™¨">1. ç¼–è¾‘å™¨</h3>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹é¡µé¢çš„æ•´ä½“ç»“æ„ã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613497344188.png" alt="" loading="lazy"></p>
<p>è¿™ä¸€èŠ‚è¦è®²çš„ç¼–è¾‘å™¨å…¶å®å°±æ˜¯ä¸­é—´çš„ç”»å¸ƒã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼šå½“ä»å·¦è¾¹ç»„ä»¶åˆ—è¡¨æ‹–æ‹½å‡ºä¸€ä¸ªç»„ä»¶æ”¾åˆ°ç”»å¸ƒä¸­æ—¶ï¼Œç”»å¸ƒè¦æŠŠè¿™ä¸ªç»„ä»¶æ¸²æŸ“å‡ºæ¥ã€‚<br>
è¿™ä¸ªç¼–è¾‘å™¨çš„å®ç°æ€è·¯æ˜¯ï¼š</p>
<p>ç”¨ä¸€ä¸ªæ•°ç»„ <code>componentData</code> ç»´æŠ¤ç¼–è¾‘å™¨ä¸­çš„æ•°æ®ã€‚<br>
æŠŠç»„ä»¶æ‹–æ‹½åˆ°ç”»å¸ƒä¸­æ—¶ï¼Œä½¿ç”¨ <code>push()</code> æ–¹æ³•å°†æ–°çš„ç»„ä»¶æ•°æ®æ·»åŠ åˆ° <code>componentData</code>ã€‚<br>
ç¼–è¾‘å™¨ä½¿ç”¨ <code>v-for</code> æŒ‡ä»¤éå† <code>componentData</code>ï¼Œå°†æ¯ä¸ªç»„ä»¶é€ä¸ªæ¸²æŸ“åˆ°ç”»å¸ƒï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ <code>JSX</code>è¯­æ³•ç»“åˆ <code>render()</code> æ–¹æ³•ä»£æ›¿ï¼‰ã€‚</p>
<p>ç¼–è¾‘å™¨æ¸²æŸ“çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-js">&lt;component 
  v-for=&quot;item in componentData&quot;
  :key=&quot;item.id&quot;
  :is=&quot;item.component&quot;
  :style=&quot;item.style&quot;
  :propValue=&quot;item.propValue&quot;
/&gt;
</code></pre>
<p>æ¯ä¸ªç»„ä»¶æ•°æ®å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-js">{
    component: 'v-text', // ç»„ä»¶åç§°ï¼Œéœ€è¦æå‰æ³¨å†Œåˆ° Vue
    label: 'æ–‡å­—', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—
    propValue: 'æ–‡å­—', // ç»„ä»¶æ‰€ä½¿ç”¨çš„å€¼
    icon: 'el-icon-edit', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—
    animations: [], // åŠ¨ç”»åˆ—è¡¨
    events: {}, // äº‹ä»¶åˆ—è¡¨
    style: { // ç»„ä»¶æ ·å¼
        width: 200,
        height: 33,
        fontSize: 14,
        fontWeight: 500,
        lineHeight: '',
        letterSpacing: 0,
        textAlign: '',
        color: '',
    },
}
</code></pre>
<p>åœ¨éå† <code>componentData</code> ç»„ä»¶æ•°æ®æ—¶ï¼Œä¸»è¦é  <code>is</code> å±æ€§æ¥è¯†åˆ«å‡ºçœŸæ­£è¦æ¸²æŸ“çš„æ˜¯å“ªä¸ªç»„ä»¶ã€‚<br>
ä¾‹å¦‚è¦æ¸²æŸ“çš„ç»„ä»¶æ•°æ®æ˜¯<code>{ component: 'v-text' }</code>ï¼Œåˆ™ <code>&lt;component :is=&quot;item.component&quot; /&gt;</code>ä¼šè¢«è½¬æ¢ä¸º <code>&lt;v-text /&gt;</code>ã€‚å½“ç„¶ï¼Œä½ è¿™ä¸ªç»„ä»¶ä¹Ÿè¦æå‰æ³¨å†Œåˆ° Vue ä¸­ã€‚<br>
å¦‚æœä½ æƒ³äº†è§£æ›´å¤š is å±æ€§çš„èµ„æ–™ï¼Œè¯·æŸ¥çœ‹<a href="https://cn.vuejs.org/v2/api/#is">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="2-è‡ªå®šä¹‰ç»„ä»¶">2. è‡ªå®šä¹‰ç»„ä»¶</h3>
<p>åŸåˆ™ä¸Šä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å»ºè®®ä½ æœ€å¥½å°è£…ä¸€ä¸‹ã€‚ä¸ç®¡æ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶è¿˜æ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶æ‰€éœ€çš„å±æ€§å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¯ä¸ªç»„ä»¶æ•°æ®å¯ä»¥æš´éœ²å‡ºä¸€ä¸ªå±æ€§ <code>propValue</code> ç”¨äºä¼ é€’å€¼ã€‚<br>
ä¾‹å¦‚ a ç»„ä»¶åªéœ€è¦ä¸€ä¸ªå±æ€§ï¼Œä½ çš„ <code>propValue</code> å¯ä»¥è¿™æ ·å†™ï¼š<code>propValue: 'aaa'</code>ã€‚å¦‚æœéœ€è¦å¤šä¸ªå±æ€§ï¼Œ<code>propValue</code> åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="language-js">propValue: {
  a: 1,
  b: 'text'
}
</code></pre>
<p>åœ¨è¿™ä¸ª DEMO ç»„ä»¶åº“ä¸­æˆ‘å®šä¹‰äº†ä¸‰ä¸ªç»„ä»¶ã€‚</p>
<p>å›¾ç‰‡ç»„ä»¶ Pictureï¼š</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;div style=&quot;overflow: hidden&quot;&gt;
        &lt;img :src=&quot;propValue&quot;&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        propValue: {
            type: String,
            require: true,
        },
    },
}
&lt;/script&gt;
</code></pre>
<p>æŒ‰é’®ç»„ä»¶ <code>VButton</code>:</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;button class=&quot;v-button&quot;&gt;{{ propValue }}&lt;/button&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        propValue: {
            type: String,
            default: '',
        },
    },
}
&lt;/script&gt;
</code></pre>
<p>æ–‡æœ¬ç»„ä»¶ <code>VText</code>:</p>
<pre><code class="language-js">&lt;template&gt;
    &lt;textarea 
        v-if=&quot;editMode == 'edit'&quot;
        :value=&quot;propValue&quot;
        class=&quot;text textarea&quot;
        @input=&quot;handleInput&quot;
        ref=&quot;v-text&quot;
    &gt;&lt;/textarea&gt;
    &lt;div v-else class=&quot;text disabled&quot;&gt;
        &lt;div v-for=&quot;(text, index) in propValue.split('\n')&quot; :key=&quot;index&quot;&gt;{{ text }}&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'

export default {
    props: {
        propValue: {
            type: String,
        },
        element: {
            type: Object,
        },
    },
    computed: mapState([
        'editMode',
    ]),
    methods: {
        handleInput(e) {
            this.$emit('input', this.element, e.target.value)
        },
    },
}
&lt;/script&gt;
</code></pre>
<h3 id="3-æ‹–æ‹½">3. æ‹–æ‹½</h3>
<h4 id="ä»ç»„ä»¶åˆ—è¡¨åˆ°ç”»å¸ƒ">ä»ç»„ä»¶åˆ—è¡¨åˆ°ç”»å¸ƒ</h4>
<p>ä¸€ä¸ªå…ƒç´ å¦‚æœè¦è®¾ä¸ºå¯æ‹–æ‹½ï¼Œå¿…é¡»ç»™å®ƒæ·»åŠ ä¸€ä¸ª <code>draggable</code> å±æ€§ã€‚å¦å¤–ï¼Œåœ¨å°†ç»„ä»¶åˆ—è¡¨ä¸­çš„ç»„ä»¶æ‹–æ‹½åˆ°ç”»å¸ƒä¸­ï¼Œè¿˜æœ‰ä¸¤ä¸ªäº‹ä»¶æ˜¯èµ·åˆ°å…³é”®ä½œç”¨çš„ï¼š</p>
<p><code>dragstart</code> äº‹ä»¶ï¼Œåœ¨æ‹–æ‹½åˆšå¼€å§‹æ—¶è§¦å‘ã€‚å®ƒä¸»è¦ç”¨äºå°†æ‹–æ‹½çš„ç»„ä»¶ä¿¡æ¯ä¼ é€’ç»™ç”»å¸ƒã€‚<br>
<code>drop</code> äº‹ä»¶ï¼Œåœ¨æ‹–æ‹½ç»“æŸæ—¶è§¦å‘ã€‚ä¸»è¦ç”¨äºæ¥æ”¶æ‹–æ‹½çš„ç»„ä»¶ä¿¡æ¯ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹å·¦ä¾§ç»„ä»¶åˆ—è¡¨çš„ä»£ç ï¼š</p>
<pre><code class="language-html">&lt;div @dragstart=&quot;handleDragStart&quot; class=&quot;component-list&quot;&gt;
    &lt;div v-for=&quot;(item, index) in componentList&quot; :key=&quot;index&quot; class=&quot;list&quot; draggable :data-index=&quot;index&quot;&gt;
        &lt;i :class=&quot;item.icon&quot;&gt;&lt;/i&gt;
        &lt;span&gt;{{ item.label }}&lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-js">handleDragStart(e) {
    e.dataTransfer.setData('index', e.target.dataset.index)
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ç»™åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½è®¾ç½®äº† <code>draggable</code> å±æ€§ã€‚å¦å¤–ï¼Œåœ¨è§¦å‘ <code>dragstart</code>äº‹ä»¶æ—¶ï¼Œä½¿ç”¨ <code>dataTransfer.setData()</code> ä¼ è¾“æ•°æ®ã€‚å†æ¥çœ‹ä¸€ä¸‹æ¥æ”¶æ•°æ®çš„ä»£ç ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;content&quot; @drop=&quot;handleDrop&quot; @dragover=&quot;handleDragOver&quot; @click=&quot;deselectCurComponent&quot;&gt;
    &lt;Editor /&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-js">handleDrop(e) {
    e.preventDefault()
    e.stopPropagation()
    const component = deepCopy(componentList[e.dataTransfer.getData('index')])
    this.$store.commit('addComponent', component)
}
</code></pre>
<p>è§¦å‘ <code>drop</code> äº‹ä»¶æ—¶ï¼Œä½¿ç”¨ <code>dataTransfer.getData()</code> æ¥æ”¶ä¼ è¾“è¿‡æ¥çš„ç´¢å¼•æ•°æ®ï¼Œç„¶åæ ¹æ®ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶æ•°æ®ï¼Œå†æ·»åŠ åˆ°ç”»å¸ƒï¼Œä»è€Œæ¸²æŸ“ç»„ä»¶ã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613497886196.gif" alt="" loading="lazy"></p>
<h4 id="ç»„ä»¶åœ¨ç”»å¸ƒä¸­ç§»åŠ¨">ç»„ä»¶åœ¨ç”»å¸ƒä¸­ç§»åŠ¨</h4>
<p>é¦–å…ˆéœ€è¦å°†ç”»å¸ƒè®¾ä¸ºç›¸å¯¹å®šä½ <code>position: relative</code>ï¼Œç„¶åå°†æ¯ä¸ªç»„ä»¶è®¾ä¸ºç»å¯¹å®šä½ <code>position: absolute</code>ã€‚é™¤äº†è¿™ä¸€ç‚¹å¤–ï¼Œè¿˜è¦é€šè¿‡ç›‘å¬ä¸‰ä¸ªäº‹ä»¶æ¥è¿›è¡Œç§»åŠ¨ï¼š</p>
<ol>
<li><code>mousedown</code> äº‹ä»¶ï¼Œåœ¨ç»„ä»¶ä¸ŠæŒ‰ä¸‹é¼ æ ‡æ—¶ï¼Œè®°å½•ç»„ä»¶å½“å‰çš„ä½ç½®ï¼Œå³ xy åæ ‡ï¼ˆä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œè¿™é‡Œä½¿ç”¨çš„åæ ‡è½´ï¼Œå®é™…ä¸Š xy å¯¹åº”çš„æ˜¯ css ä¸­çš„ left å’Œ topã€‚</li>
<li><code>mousemove</code> äº‹ä»¶ï¼Œæ¯æ¬¡é¼ æ ‡ç§»åŠ¨æ—¶ï¼Œéƒ½ç”¨å½“å‰æœ€æ–°çš„ xy åæ ‡å‡å»æœ€å¼€å§‹çš„ xy åæ ‡ï¼Œä»è€Œè®¡ç®—å‡ºç§»åŠ¨è·ç¦»ï¼Œå†æ”¹å˜ç»„ä»¶ä½ç½®ã€‚</li>
<li><code>mouseup</code> äº‹ä»¶ï¼Œé¼ æ ‡æŠ¬èµ·æ—¶ç»“æŸç§»åŠ¨ã€‚</li>
</ol>
<pre><code class="language-js">handleMouseDown(e) {
    e.stopPropagation()
    this.$store.commit('setCurComponent', { component: this.element, zIndex: this.zIndex })

    const pos = { ...this.defaultStyle }
    const startY = e.clientY
    const startX = e.clientX
    // å¦‚æœç›´æ¥ä¿®æ”¹å±æ€§ï¼Œå€¼çš„ç±»å‹ä¼šå˜ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬ä¸ºæ•°å€¼å‹
    const startTop = Number(pos.top)
    const startLeft = Number(pos.left)

    const move = (moveEvent) =&gt; {
        const currX = moveEvent.clientX
        const currY = moveEvent.clientY
        pos.top = currY - startY + startTop
        pos.left = currX - startX + startLeft
        // ä¿®æ”¹å½“å‰ç»„ä»¶æ ·å¼
        this.$store.commit('setShapeStyle', pos)
    }

    const up = () =&gt; {
        document.removeEventListener('mousemove', move)
        document.removeEventListener('mouseup', up)
    }

    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', up)
}
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613498024998.gif" alt="" loading="lazy"></figure>
<h3 id="4-åˆ é™¤ç»„ä»¶-è°ƒæ•´å›¾å±‚å±‚çº§">4. åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§</h3>
<h4 id="æ”¹å˜å›¾å±‚å±‚çº§">æ”¹å˜å›¾å±‚å±‚çº§</h4>
<p>ç”±äºæ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒä¸­æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œæ‰€ä»¥å¯ä»¥æŒ‰ç…§æ•°æ®é¡ºåºæ¥åˆ†é…å›¾å±‚å±‚çº§ã€‚<br>
ä¾‹å¦‚ç”»å¸ƒæ–°å¢äº†äº”ä¸ªç»„ä»¶ abcdeï¼Œé‚£å®ƒä»¬åœ¨ç”»å¸ƒæ•°æ®ä¸­çš„é¡ºåºä¸º <code>[a, b, c, d, e]</code>ï¼Œå›¾å±‚å±‚çº§å’Œç´¢å¼•ä¸€ä¸€å¯¹åº”ï¼Œå³å®ƒä»¬çš„ <code>z-index</code> å±æ€§å€¼æ˜¯ 01234ï¼ˆåæ¥å±…ä¸Šï¼‰ã€‚ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div v-for=&quot;(item, index) in componentData&quot; :zIndex=&quot;index&quot;&gt;&lt;/div&gt;
</code></pre>
<p>å¦‚æœä¸äº†è§£ z-index å±æ€§çš„ï¼Œè¯·çœ‹ä¸€ä¸‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index">MDN æ–‡æ¡£</a>ã€‚</p>
<p>ç†è§£äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæ”¹å˜å›¾å±‚å±‚çº§å°±å¾ˆå®¹æ˜“åšåˆ°äº†ã€‚æ”¹å˜å›¾å±‚å±‚çº§ï¼Œå³æ˜¯æ”¹å˜ç»„ä»¶æ•°æ®åœ¨ <code>componentData</code>æ•°ç»„ä¸­çš„é¡ºåºã€‚ä¾‹å¦‚æœ‰<code>[a, b, c]</code>ä¸‰ä¸ªç»„ä»¶ï¼Œå®ƒä»¬çš„å›¾å±‚å±‚çº§ä»ä½åˆ°é«˜é¡ºåºä¸º abcï¼ˆç´¢å¼•è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼‰ã€‚<br>
å¦‚æœè¦å°† b ç»„ä»¶ä¸Šç§»ï¼Œåªéœ€å°†å®ƒå’Œ c è°ƒæ¢é¡ºåºå³å¯ï¼š</p>
<pre><code class="language-js">const temp = componentData[1]
componentData[1] = componentData[2]
componentData[2] = temp
</code></pre>
<p>åŒç†ï¼Œç½®é¡¶ç½®åº•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¾‹å¦‚æˆ‘è¦å°† a ç»„ä»¶ç½®é¡¶ï¼Œåªéœ€å°† a å’Œæœ€åä¸€ä¸ªç»„ä»¶è°ƒæ¢é¡ºåºå³å¯ï¼š</p>
<pre><code class="language-js">const temp = componentData[0]
componentData[0] = componentData[componentData.lenght - 1]
componentData[componentData.lenght - 1] = temp
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613498228508.gif" alt="" loading="lazy"></figure>
<h4 id="åˆ é™¤ç»„ä»¶">åˆ é™¤ç»„ä»¶</h4>
<p>åˆ é™¤ç»„ä»¶éå¸¸ç®€å•ï¼Œä¸€è¡Œä»£ç æå®šï¼š<code>componentData.splice(index, 1)</code>ã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613498335942.gif" alt="" loading="lazy"></p>
<h3 id="5-æ”¾å¤§ç¼©å°">5. æ”¾å¤§ç¼©å°</h3>
<p>ç»†å¿ƒçš„ç½‘å‹å¯èƒ½ä¼šå‘ç°ï¼Œç‚¹å‡»ç”»å¸ƒä¸Šçš„ç»„ä»¶æ—¶ï¼Œç»„ä»¶ä¸Šä¼šå‡ºç° 8 ä¸ªå°åœ†ç‚¹ã€‚è¿™ 8 ä¸ªå°åœ†ç‚¹å°±æ˜¯ç”¨æ¥æ”¾å¤§ç¼©å°ç”¨çš„ã€‚å®ç°åŸç†å¦‚ä¸‹ï¼š</p>
<h4 id="1-åœ¨æ¯ä¸ªç»„ä»¶å¤–é¢åŒ…ä¸€å±‚-shapeç»„ä»¶shape-ç»„ä»¶é‡ŒåŒ…å«-8-ä¸ªå°åœ†ç‚¹å’Œä¸€ä¸ª-slotæ’æ§½ç”¨äºæ”¾ç½®ç»„ä»¶">1. åœ¨æ¯ä¸ªç»„ä»¶å¤–é¢åŒ…ä¸€å±‚ <code>Shape</code>ç»„ä»¶ï¼Œ<code>Shape</code> ç»„ä»¶é‡ŒåŒ…å« 8 ä¸ªå°åœ†ç‚¹å’Œä¸€ä¸ª <code>&lt;slot&gt;</code>æ’æ§½ï¼Œç”¨äºæ”¾ç½®ç»„ä»¶ã€‚</h4>
<pre><code class="language-html">&lt;!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º--&gt;
&lt;Shape v-for=&quot;(item, index) in componentData&quot;
    :defaultStyle=&quot;item.style&quot;
    :style=&quot;getShapeStyle(item.style, index)&quot;
    :key=&quot;item.id&quot;
    :active=&quot;item === curComponent&quot;
    :element=&quot;item&quot;
    :zIndex=&quot;index&quot;
&gt;
    &lt;component
        class=&quot;component&quot;
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/Shape&gt;
</code></pre>
<p><code>Shape</code> ç»„ä»¶å†…éƒ¨ç»“æ„ï¼š</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;shape&quot; :class=&quot;{ active: this.active }&quot; @click=&quot;selectCurComponent&quot; @mousedown=&quot;handleMouseDown&quot;
    @contextmenu=&quot;handleContextMenu&quot;&gt;
        &lt;div
            class=&quot;shape-point&quot;
            v-for=&quot;(item, index) in (active? pointList : [])&quot;
            @mousedown=&quot;handleMouseDownOnPoint(item)&quot;
            :key=&quot;index&quot;
            :style=&quot;getPointStyle(item)&quot;&gt;
        &lt;/div&gt;
        &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 id="2-ç‚¹å‡»ç»„ä»¶æ—¶å°†-8-ä¸ªå°åœ†ç‚¹æ˜¾ç¤ºå‡ºæ¥">2. ç‚¹å‡»ç»„ä»¶æ—¶ï¼Œå°† 8 ä¸ªå°åœ†ç‚¹æ˜¾ç¤ºå‡ºæ¥ã€‚</h4>
<p>èµ·ä½œç”¨çš„æ˜¯è¿™è¡Œä»£ç  <code>:active=&quot;item === curComponent&quot;</code>ã€‚</p>
<h4 id="3-è®¡ç®—æ¯ä¸ªå°åœ†ç‚¹çš„ä½ç½®">3. è®¡ç®—æ¯ä¸ªå°åœ†ç‚¹çš„ä½ç½®ã€‚</h4>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹è®¡ç®—å°åœ†ç‚¹ä½ç½®çš„ä»£ç ï¼š</p>
<pre><code class="language-js">const pointList = ['t', 'r', 'b', 'l', 'lt', 'rt', 'lb', 'rb']

getPointStyle(point) {
    const { width, height } = this.defaultStyle
    const hasT = /t/.test(point)
    const hasB = /b/.test(point)
    const hasL = /l/.test(point)
    const hasR = /r/.test(point)
    let newLeft = 0
    let newTop = 0

    // å››ä¸ªè§’çš„ç‚¹
    if (point.length === 2) {
        newLeft = hasL? 0 : width
        newTop = hasT? 0 : height
    } else {
        // ä¸Šä¸‹ä¸¤ç‚¹çš„ç‚¹ï¼Œå®½åº¦å±…ä¸­
        if (hasT || hasB) {
            newLeft = width / 2
            newTop = hasT? 0 : height
        }

        // å·¦å³ä¸¤è¾¹çš„ç‚¹ï¼Œé«˜åº¦å±…ä¸­
        if (hasL || hasR) {
            newLeft = hasL? 0 : width
            newTop = Math.floor(height / 2)
        }
    }

    const style = {
        marginLeft: hasR? '-4px' : '-3px',
        marginTop: '-3px',
        left: `${newLeft}px`,
        top: `${newTop}px`,
        cursor: point.split('').reverse().map(m =&gt; this.directionKey[m]).join('') + '-resize',
    }

    return style
}

</code></pre>
<p>è®¡ç®—å°åœ†ç‚¹çš„ä½ç½®éœ€è¦è·å–ä¸€äº›ä¿¡æ¯ï¼š</p>
<ul>
<li>ç»„ä»¶çš„é«˜åº¦ <code>height</code>ã€å®½åº¦ <code>width</code></li>
</ul>
<p>æ³¨æ„ï¼Œå°åœ†ç‚¹ä¹Ÿæ˜¯ç»å¯¹å®šä½çš„ï¼Œç›¸å¯¹äº Shape ç»„ä»¶ã€‚æ‰€ä»¥æœ‰å››ä¸ªå°åœ†ç‚¹çš„ä½ç½®å¾ˆå¥½ç¡®å®šï¼š</p>
<ol>
<li>å·¦ä¸Šè§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ <code>left: 0, top: 0</code></li>
<li>å³ä¸Šè§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ <code>left: width, top: 0</code></li>
<li>å·¦ä¸‹è§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ <code>left: 0, top: height</code></li>
<li>å³ä¸‹è§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ <code>left: width, top: height</code></li>
</ol>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613498726273.png" alt="" loading="lazy"></figure>
<p>å¦å¤–çš„å››ä¸ªå°åœ†ç‚¹éœ€è¦é€šè¿‡è®¡ç®—é—´æ¥ç®—å‡ºæ¥ã€‚ä¾‹å¦‚å·¦è¾¹ä¸­é—´çš„å°åœ†ç‚¹ï¼Œè®¡ç®—å…¬å¼ä¸º <code>left: 0, top: height / 2</code>ï¼Œå…¶ä»–å°åœ†ç‚¹åŒç†ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://blog.luyu.icu/post-images/1613498761944.png" alt="" loading="lazy"></figure>
<h4 id="4-ç‚¹å‡»å°åœ†ç‚¹æ—¶å¯ä»¥è¿›è¡Œæ”¾å¤§ç¼©å°æ“ä½œ">4. ç‚¹å‡»å°åœ†ç‚¹æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ”¾å¤§ç¼©å°æ“ä½œã€‚</h4>
<pre><code class="language-js">handleMouseDownOnPoint(point) {
    const downEvent = window.event
    downEvent.stopPropagation()
    downEvent.preventDefault()

    const pos = { ...this.defaultStyle }
    const height = Number(pos.height)
    const width = Number(pos.width)
    const top = Number(pos.top)
    const left = Number(pos.left)
    const startX = downEvent.clientX
    const startY = downEvent.clientY

    // æ˜¯å¦éœ€è¦ä¿å­˜å¿«ç…§
    let needSave = false
    const move = (moveEvent) =&gt; {
        needSave = true
        const currX = moveEvent.clientX
        const currY = moveEvent.clientY
        const disY = currY - startY
        const disX = currX - startX
        const hasT = /t/.test(point)
        const hasB = /b/.test(point)
        const hasL = /l/.test(point)
        const hasR = /r/.test(point)
        const newHeight = height + (hasT? -disY : hasB? disY : 0)
        const newWidth = width + (hasL? -disX : hasR? disX : 0)
        pos.height = newHeight &gt; 0? newHeight : 0
        pos.width = newWidth &gt; 0? newWidth : 0
        pos.left = left + (hasL? disX : 0)
        pos.top = top + (hasT? disY : 0)
        this.$store.commit('setShapeStyle', pos)
    }

    const up = () =&gt; {
        document.removeEventListener('mousemove', move)
        document.removeEventListener('mouseup', up)
        needSave &amp;&amp; this.$store.commit('recordSnapshot')
    }

    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', up)
}
</code></pre>
<p>å®ƒçš„åŸç†æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>ç‚¹å‡»å°åœ†ç‚¹æ—¶ï¼Œè®°å½•ç‚¹å‡»çš„åæ ‡ xyã€‚</li>
<li>å‡è®¾æˆ‘ä»¬ç°åœ¨å‘ä¸‹æ‹–åŠ¨ï¼Œé‚£ä¹ˆ y åæ ‡å°±ä¼šå¢å¤§ã€‚</li>
<li>ç”¨æ–°çš„ y åæ ‡å‡å»åŸæ¥çš„ y åæ ‡ï¼Œå°±å¯ä»¥çŸ¥é“åœ¨çºµè½´æ–¹å‘çš„ç§»åŠ¨è·ç¦»æ˜¯å¤šå°‘ã€‚</li>
<li>æœ€åå†å°†ç§»åŠ¨è·ç¦»åŠ ä¸ŠåŸæ¥ç»„ä»¶çš„é«˜åº¦ï¼Œå°±å¯ä»¥å¾—å‡ºæ–°çš„ç»„ä»¶é«˜åº¦ã€‚</li>
<li>å¦‚æœæ˜¯æ­£æ•°ï¼Œè¯´æ˜æ˜¯å¾€ä¸‹æ‹‰ï¼Œç»„ä»¶çš„é«˜åº¦åœ¨å¢åŠ ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼Œè¯´æ˜æ˜¯å¾€ä¸Šæ‹‰ï¼Œç»„ä»¶çš„é«˜åº¦åœ¨å‡å°‘ã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613498868658.gif" alt="" loading="lazy"></li>
</ol>
<h3 id="6-æ’¤æ¶ˆ-é‡åš">6. æ’¤æ¶ˆã€é‡åš</h3>
<p>æ’¤é”€é‡åšçš„å®ç°åŸç†å…¶å®æŒºç®€å•çš„ï¼Œå…ˆçœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-js">snapshotData: [], // ç¼–è¾‘å™¨å¿«ç…§æ•°æ®
snapshotIndex: -1, // å¿«ç…§ç´¢å¼•
        
undo(state) {
    if (state.snapshotIndex &gt;= 0) {
        state.snapshotIndex--
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

redo(state) {
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotIndex++
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

setComponentData(state, componentData = []) {
    Vue.set(state, 'componentData', componentData)
},

recordSnapshot(state) {
    // æ·»åŠ æ–°çš„å¿«ç…§
    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)
    // åœ¨ undo è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ æ–°çš„å¿«ç…§æ—¶ï¼Œè¦å°†å®ƒåé¢çš„å¿«ç…§æ¸…ç†æ‰
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)
    }
},
</code></pre>
<p>ç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ç¼–è¾‘å™¨çš„å¿«ç…§æ•°æ®ã€‚ä¿å­˜å¿«ç…§å°±æ˜¯ä¸åœåœ°æ‰§è¡Œ <code>push()</code> æ“ä½œï¼Œå°†å½“å‰çš„ç¼–è¾‘å™¨æ•°æ®æ¨å…¥ <code>snapshotData</code> æ•°ç»„ï¼Œå¹¶å¢åŠ å¿«ç…§ç´¢å¼• <code>snapshotIndex</code>ã€‚ç›®å‰ä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œä¼šè§¦å‘ä¿å­˜å¿«ç…§æ“ä½œï¼š</p>
<ol>
<li>æ–°å¢ç»„ä»¶</li>
<li>åˆ é™¤ç»„ä»¶</li>
<li>æ”¹å˜å›¾å±‚å±‚çº§</li>
<li>æ‹–åŠ¨ç»„ä»¶ç»“æŸæ—¶</li>
</ol>
<h4 id="æ’¤é”€">æ’¤é”€</h4>
<p>å‡è®¾ç°åœ¨ <code>snapshotData</code> ä¿å­˜äº† 4 ä¸ªå¿«ç…§ã€‚å³ <code>[a, b, c, d]</code>ï¼Œå¯¹åº”çš„å¿«ç…§ç´¢å¼•ä¸º 3ã€‚å¦‚æœè¿™æ—¶è¿›è¡Œäº†æ’¤é”€æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å°†å¿«ç…§ç´¢å¼•å‡ 1ï¼Œç„¶åå°†å¯¹åº”çš„å¿«ç…§æ•°æ®èµ‹å€¼ç»™ç”»å¸ƒã€‚<br>
ä¾‹å¦‚å½“å‰ç”»å¸ƒæ•°æ®æ˜¯ dï¼Œè¿›è¡Œæ’¤é”€åï¼Œç´¢å¼• -1ï¼Œç°åœ¨ç”»å¸ƒçš„æ•°æ®æ˜¯ cã€‚</p>
<h4 id="é‡åš">é‡åš</h4>
<p>æ˜ç™½äº†æ’¤é”€ï¼Œé‚£é‡åšå°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯å°†å¿«ç…§ç´¢å¼•åŠ  1ï¼Œç„¶åå°†å¯¹åº”çš„å¿«ç…§æ•°æ®èµ‹å€¼ç»™ç”»å¸ƒã€‚<br>
ä¸è¿‡è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå°±æ˜¯åœ¨æ’¤é”€æ“ä½œä¸­è¿›è¡Œäº†æ–°çš„æ“ä½œï¼Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ–°æ“ä½œæ›¿æ¢å½“å‰å¿«ç…§ç´¢å¼•åé¢æ‰€æœ‰çš„æ•°æ®ã€‚è¿˜æ˜¯ç”¨åˆšæ‰çš„æ•°æ® [a, b, c, d] ä¸¾ä¾‹ï¼Œå‡è®¾ç°åœ¨è¿›è¡Œäº†ä¸¤æ¬¡æ’¤é”€æ“ä½œï¼Œå¿«ç…§ç´¢å¼•å˜ä¸º 1ï¼Œå¯¹åº”çš„å¿«ç…§æ•°æ®ä¸º bï¼Œå¦‚æœè¿™æ—¶è¿›è¡Œäº†æ–°çš„æ“ä½œï¼Œå¯¹åº”çš„å¿«ç…§æ•°æ®ä¸º eã€‚é‚£ e ä¼šæŠŠ cd é¡¶æ‰ï¼Œç°åœ¨çš„å¿«ç…§æ•°æ®ä¸º [a, b, e]ã€‚</li>
<li>ä¸é¡¶æ‰æ•°æ®ï¼Œåœ¨åŸæ¥çš„å¿«ç…§ä¸­æ–°å¢ä¸€æ¡è®°å½•ã€‚ç”¨åˆšæ‰çš„ä¾‹å­ä¸¾ä¾‹ï¼Œe ä¸ä¼šæŠŠ cd é¡¶æ‰ï¼Œè€Œæ˜¯åœ¨ cd ä¹‹å‰æ’å…¥ï¼Œå³å¿«ç…§æ•°æ®å˜ä¸º [a, b, e, c, d]ã€‚</li>
</ol>
<p>æˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ¡ˆã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://blog.luyu.icu/post-images/1613499176409.gif" alt="" loading="lazy"></figure>
<h3 id="7-å¸é™„">7. å¸é™„</h3>
<p>ä»€ä¹ˆæ˜¯å¸é™„ï¼Ÿå°±æ˜¯åœ¨æ‹–æ‹½ç»„ä»¶æ—¶ï¼Œå¦‚æœå®ƒå’Œå¦ä¸€ä¸ªç»„ä»¶çš„è·ç¦»æ¯”è¾ƒæ¥è¿‘ï¼Œå°±ä¼šè‡ªåŠ¨å¸é™„åœ¨ä¸€èµ·ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://blog.luyu.icu/post-images/1613499297871.gif" alt="" loading="lazy"></figure>
<p>å¸é™„çš„ä»£ç å¤§æ¦‚åœ¨ 300 è¡Œå·¦å³ï¼Œå»ºè®®è‡ªå·±æ‰“å¼€æºç æ–‡ä»¶çœ‹ï¼ˆæ–‡ä»¶è·¯å¾„ï¼š<code>src\components\Editor\MarkLine.vue</code>ï¼‰ã€‚è¿™é‡Œä¸è´´ä»£ç äº†ï¼Œä¸»è¦è¯´è¯´åŸç†æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<h4 id="æ ‡çº¿">æ ‡çº¿</h4>
<p>åœ¨é¡µé¢ä¸Šåˆ›å»º 6 æ¡çº¿ï¼Œåˆ†åˆ«æ˜¯ä¸‰æ¨ªä¸‰ç«–ã€‚è¿™ 6 æ¡çº¿çš„ä½œç”¨æ˜¯å¯¹é½ï¼Œå®ƒä»¬ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°å‘¢ï¼Ÿ</p>
<ol>
<li>ä¸Šä¸‹æ–¹å‘çš„ä¸¤ä¸ªç»„ä»¶å·¦è¾¹ã€ä¸­é—´ã€å³è¾¹å¯¹é½æ—¶ä¼šå‡ºç°ç«–çº¿</li>
<li>å·¦å³æ–¹å‘çš„ä¸¤ä¸ªç»„ä»¶ä¸Šè¾¹ã€ä¸­é—´ã€ä¸‹è¾¹å¯¹é½æ—¶ä¼šå‡ºç°æ¨ªçº¿</li>
</ol>
<p>å…·ä½“çš„è®¡ç®—å…¬å¼ä¸»è¦æ˜¯æ ¹æ®æ¯ä¸ªç»„ä»¶çš„ xy åæ ‡å’Œå®½åº¦é«˜åº¦è¿›è¡Œè®¡ç®—çš„ã€‚ä¾‹å¦‚è¦åˆ¤æ–­ ab ä¸¤ä¸ªç»„ä»¶çš„å·¦è¾¹æ˜¯å¦å¯¹é½ï¼Œåˆ™è¦çŸ¥é“å®ƒä»¬æ¯ä¸ªç»„ä»¶çš„ x åæ ‡ï¼›å¦‚æœè¦çŸ¥é“å®ƒä»¬å³è¾¹æ˜¯å¦å¯¹é½ï¼Œé™¤äº†è¦çŸ¥é“ x åæ ‡ï¼Œè¿˜è¦çŸ¥é“å®ƒä»¬å„è‡ªçš„å®½åº¦ã€‚</p>
<pre><code class="language-js">// å·¦å¯¹é½çš„æ¡ä»¶
a.x == b.x

// å³å¯¹é½çš„æ¡ä»¶
a.x + a.width == b.x + b.width

</code></pre>
<p>åœ¨å¯¹é½çš„æ—¶å€™ï¼Œæ˜¾ç¤ºæ ‡çº¿ã€‚</p>
<p>å¦å¤–è¿˜è¦åˆ¤æ–­ ab ä¸¤ä¸ªç»„ä»¶æ˜¯å¦â€œè¶³å¤Ÿâ€è¿‘ã€‚å¦‚æœè¶³å¤Ÿè¿‘ï¼Œå°±å¸é™„åœ¨ä¸€èµ·ã€‚æ˜¯å¦è¶³å¤Ÿè¿‘è¦é ä¸€ä¸ªå˜é‡æ¥åˆ¤æ–­ï¼š</p>
<pre><code class="language-js">diff: 3, // ç›¸è· dff åƒç´ å°†è‡ªåŠ¨å¸é™„
</code></pre>
<p>å°äºç­‰äº <code>diff</code> åƒç´ åˆ™è‡ªåŠ¨å¸é™„ã€‚</p>
<h4 id="å¸é™„">å¸é™„</h4>
<h5 id="å¸é™„æ•ˆæœæ˜¯æ€ä¹ˆå®ç°çš„å‘¢">å¸é™„æ•ˆæœæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</h5>
<p>å‡è®¾ç°åœ¨æœ‰ ab ç»„ä»¶ï¼Œa ç»„ä»¶åæ ‡ xy éƒ½æ˜¯ 0ï¼Œå®½é«˜éƒ½æ˜¯ 100ã€‚ç°åœ¨å‡è®¾ a ç»„ä»¶ä¸åŠ¨ï¼Œæˆ‘ä»¬æ­£åœ¨æ‹–æ‹½ b ç»„ä»¶ã€‚å½“æŠŠ b ç»„ä»¶æ‹–åˆ°åæ ‡ä¸º<code>x: 0, y: 103</code> æ—¶ï¼Œç”±äº<code>103 - 100 &lt;= 3(diff)</code>ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤å®šå®ƒä»¬å·²ç»æ¥è¿‘å¾—è¶³å¤Ÿè¿‘ã€‚è¿™æ—¶éœ€è¦æ‰‹åŠ¨å°† b ç»„ä»¶çš„ y åæ ‡å€¼è®¾ä¸º 100ï¼Œè¿™æ ·å°±å°† ab ç»„ä»¶å¸é™„åœ¨ä¸€èµ·äº†ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.luyu.icu/post-images/1613499573207.gif" alt="" loading="lazy"></figure>
<h4 id="ä¼˜åŒ–">ä¼˜åŒ–</h4>
<p>åœ¨æ‹–æ‹½æ—¶å¦‚æœ 6 æ¡æ ‡çº¿éƒ½æ˜¾ç¤ºå‡ºæ¥ä¼šä¸å¤ªç¾è§‚ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšä¸€ä¸‹ä¼˜åŒ–ï¼Œåœ¨çºµæ¨ªæ–¹å‘ä¸Šæœ€å¤šåªåŒæ—¶æ˜¾ç¤ºä¸€æ¡çº¿ã€‚å®ç°åŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li>a ç»„ä»¶åœ¨å·¦è¾¹ä¸åŠ¨ï¼Œæˆ‘ä»¬æ‹–ç€ b ç»„ä»¶å¾€ a ç»„ä»¶é è¿‘ã€‚</li>
<li>è¿™æ—¶å®ƒä»¬æœ€å…ˆå¯¹é½çš„æ˜¯ a çš„å³è¾¹å’Œ b çš„å·¦è¾¹ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€æ¡çº¿å°±å¤Ÿäº†ã€‚</li>
<li>å¦‚æœ ab ç»„ä»¶å·²ç»é è¿‘ï¼Œå¹¶ä¸” b ç»„ä»¶ç»§ç»­å¾€å·¦è¾¹ç§»åŠ¨ï¼Œè¿™æ—¶å°±è¦åˆ¤æ–­å®ƒä»¬ä¿©çš„ä¸­é—´æ˜¯å¦å¯¹é½ã€‚</li>
<li>b ç»„ä»¶ç»§ç»­æ‹–åŠ¨ï¼Œè¿™æ—¶éœ€è¦åˆ¤æ–­ a ç»„ä»¶çš„å·¦è¾¹å’Œ b ç»„ä»¶çš„å³è¾¹æ˜¯å¦å¯¹é½ï¼Œä¹Ÿæ˜¯åªéœ€è¦ä¸€æ¡çº¿ã€‚</li>
</ol>
<p>å¯ä»¥å‘ç°ï¼Œå…³é”®çš„åœ°æ–¹æ˜¯æˆ‘ä»¬è¦çŸ¥é“ä¸¤ä¸ªç»„ä»¶çš„æ–¹å‘ã€‚å³ ab ä¸¤ä¸ªç»„ä»¶é è¿‘ï¼Œæˆ‘ä»¬è¦çŸ¥é“åˆ°åº• b æ˜¯åœ¨ a çš„å·¦è¾¹è¿˜æ˜¯å³è¾¹ã€‚<br>
è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡é¼ æ ‡ç§»åŠ¨äº‹ä»¶æ¥åˆ¤æ–­ï¼Œä¹‹å‰åœ¨è®²è§£æ‹–æ‹½çš„æ—¶å€™è¯´è¿‡ï¼Œ<code>mousedown</code> äº‹ä»¶è§¦å‘æ—¶ä¼šè®°å½•èµ·ç‚¹åæ ‡ã€‚æ‰€ä»¥æ¯æ¬¡è§¦å‘ <code>mousemove</code> äº‹ä»¶æ—¶ï¼Œç”¨å½“å‰åæ ‡å‡å»åŸæ¥çš„åæ ‡ï¼Œå°±å¯ä»¥åˆ¤æ–­ç»„ä»¶æ–¹å‘ã€‚ä¾‹å¦‚ x æ–¹å‘ä¸Šï¼Œå¦‚æœ <code>b.x - a.x</code> çš„å·®å€¼ä¸ºæ­£ï¼Œè¯´æ˜æ˜¯ b åœ¨ a å³è¾¹ï¼Œå¦åˆ™ä¸ºå·¦è¾¹ã€‚</p>
<pre><code class="language-js">// è§¦å‘å…ƒç´ ç§»åŠ¨äº‹ä»¶ï¼Œç”¨äºæ˜¾ç¤ºæ ‡çº¿ã€å¸é™„åŠŸèƒ½
// åé¢ä¸¤ä¸ªå‚æ•°ä»£è¡¨é¼ æ ‡ç§»åŠ¨æ–¹å‘
// currY - startY &gt; 0 true è¡¨ç¤ºå‘ä¸‹ç§»åŠ¨ false è¡¨ç¤ºå‘ä¸Šç§»åŠ¨
// currX - startX &gt; 0 true è¡¨ç¤ºå‘å³ç§»åŠ¨ false è¡¨ç¤ºå‘å·¦ç§»åŠ¨
eventBus.$emit('move', this.$el, currY - startY &gt; 0, currX - startX &gt; 0)
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://blog.luyu.icu/post-images/1613499714989.gif" alt="" loading="lazy"></figure>
<h3 id="8-ç»„ä»¶å±æ€§è®¾ç½®">8. ç»„ä»¶å±æ€§è®¾ç½®</h3>
<p>æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€äº›é€šç”¨å±æ€§å’Œç‹¬æœ‰çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªèƒ½æ˜¾ç¤ºå’Œä¿®æ”¹å±æ€§çš„åœ°æ–¹ã€‚</p>
<pre><code class="language-js">// æ¯ä¸ªç»„ä»¶æ•°æ®å¤§æ¦‚æ˜¯è¿™æ ·
{
    component: 'v-text', // ç»„ä»¶åç§°ï¼Œéœ€è¦æå‰æ³¨å†Œåˆ° Vue
    label: 'æ–‡å­—', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—
    propValue: 'æ–‡å­—', // ç»„ä»¶æ‰€ä½¿ç”¨çš„å€¼
    icon: 'el-icon-edit', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—
    animations: [], // åŠ¨ç”»åˆ—è¡¨
    events: {}, // äº‹ä»¶åˆ—è¡¨
    style: { // ç»„ä»¶æ ·å¼
        width: 200,
        height: 33,
        fontSize: 14,
        fontWeight: 500,
        lineHeight: '',
        letterSpacing: 0,
        textAlign: '',
        color: '',
    },
}
</code></pre>
<figure data-type="image" tabindex="9"><img src="https://blog.luyu.icu/post-images/1613499824580.png" alt="" loading="lazy"></figure>
<p>æˆ‘å®šä¹‰äº†ä¸€ä¸ª <code>AttrList</code> ç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤ºæ¯ä¸ªç»„ä»¶çš„å±æ€§ã€‚</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;div class=&quot;attr-list&quot;&gt;
        &lt;el-form&gt;
            &lt;el-form-item v-for=&quot;(key, index) in styleKeys&quot; :key=&quot;index&quot; :label=&quot;map[key]&quot;&gt;
                &lt;el-color-picker v-if=&quot;key == 'borderColor'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-color-picker v-else-if=&quot;key == 'color'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-color-picker v-else-if=&quot;key == 'backgroundColor'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-select v-else-if=&quot;key == 'textAlign'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;
                    &lt;el-option
                        v-for=&quot;item in options&quot;
                        :key=&quot;item.value&quot;
                        :label=&quot;item.label&quot;
                        :value=&quot;item.value&quot;
                    &gt;&lt;/el-option&gt;
                &lt;/el-select&gt;
                &lt;el-input type=&quot;number&quot; v-else v-model=&quot;curComponent.style[key]&quot; /&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;å†…å®¹&quot; v-if=&quot;curComponent &amp;&amp; curComponent.propValue &amp;&amp; !excludes.includes(curComponent.component)&quot;&gt;
                &lt;el-input type=&quot;textarea&quot; v-model=&quot;curComponent.propValue&quot; /&gt;
            &lt;/el-form-item&gt;
        &lt;/el-form&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯éå†ç»„ä»¶çš„ <code>style</code> å¯¹è±¡ï¼Œå°†æ¯ä¸€ä¸ªå±æ€§éå†å‡ºæ¥ã€‚å¹¶ä¸”éœ€è¦æ ¹æ®å…·ä½“çš„å±æ€§ç”¨ä¸åŒçš„ç»„ä»¶æ˜¾ç¤ºå‡ºæ¥ï¼Œä¾‹å¦‚é¢œè‰²å±æ€§ï¼Œéœ€è¦ç”¨é¢œè‰²é€‰æ‹©å™¨æ˜¾ç¤ºï¼›æ•°å€¼ç±»çš„å±æ€§éœ€è¦ç”¨ <code>type=number</code>çš„ <code>input</code> ç»„ä»¶æ˜¾ç¤ºç­‰ç­‰ã€‚<br>
ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä¿®æ”¹å±æ€§å€¼ï¼Œæˆ‘ä½¿ç”¨ <code>v-model</code> å°†ç»„ä»¶å’Œå€¼ç»‘å®šåœ¨ä¸€èµ·ã€‚</p>
<figure data-type="image" tabindex="10"><img src="https://blog.luyu.icu/post-images/1613499927469.gif" alt="" loading="lazy"></figure>
<h3 id="9-é¢„è§ˆ-ä¿å­˜ä»£ç ">9. é¢„è§ˆã€ä¿å­˜ä»£ç </h3>
<p>é¢„è§ˆå’Œç¼–è¾‘çš„æ¸²æŸ“åŸç†æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«æ˜¯ä¸éœ€è¦ç¼–è¾‘åŠŸèƒ½ã€‚æ‰€ä»¥åªéœ€è¦å°†åŸå…ˆæ¸²æŸ“ç»„ä»¶çš„ä»£ç ç¨å¾®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p>
<pre><code class="language-js">&lt;!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º--&gt;
&lt;Shape v-for=&quot;(item, index) in componentData&quot;
    :defaultStyle=&quot;item.style&quot;
    :style=&quot;getShapeStyle(item.style, index)&quot;
    :key=&quot;item.id&quot;
    :active=&quot;item === curComponent&quot;
    :element=&quot;item&quot;
    :zIndex=&quot;index&quot;
&gt;
    &lt;component
        class=&quot;component&quot;
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/Shape&gt;
</code></pre>
<p>ç»è¿‡åˆšæ‰çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ <code>Shape</code> ç»„ä»¶å…·å¤‡äº†æ‹–æ‹½ã€æ”¾å¤§ç¼©å°çš„åŠŸèƒ½ã€‚ç°åœ¨åªéœ€è¦å°† <code>Shape</code> ç»„ä»¶å»æ‰ï¼Œå¤–é¢æ”¹æˆå¥—ä¸€ä¸ªæ™®é€šçš„ <code>DIV</code> å°±å¯ä»¥äº†ï¼ˆå…¶å®ä¸ç”¨è¿™ä¸ª<code>DIV</code> ä¹Ÿè¡Œï¼Œä½†ä¸ºäº†ç»‘å®šäº‹ä»¶è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šï¼‰ã€‚</p>
<pre><code class="language-html">&lt;!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º--&gt;
&lt;div v-for=&quot;(item, index) in componentData&quot; :key=&quot;item.id&quot;&gt;
    &lt;component
        class=&quot;component&quot;
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/div&gt;
</code></pre>
<p>ä¿å­˜ä»£ç çš„åŠŸèƒ½ä¹Ÿç‰¹åˆ«ç®€å•ï¼Œåªéœ€è¦ä¿å­˜ç”»å¸ƒä¸Šçš„æ•°æ® <code>componentData</code> å³å¯ã€‚ä¿å­˜æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä¿å­˜åˆ°æœåŠ¡å™¨</li>
<li>æœ¬åœ°ä¿å­˜<br>
åœ¨ DEMO ä¸Šæˆ‘ä½¿ç”¨çš„ localStorage ä¿å­˜åœ¨æœ¬åœ°ã€‚</li>
</ol>
<figure data-type="image" tabindex="11"><img src="https://blog.luyu.icu/post-images/1613500069119.gif" alt="" loading="lazy"></figure>
<h3 id="10-ç»‘å®šäº‹ä»¶">10. ç»‘å®šäº‹ä»¶</h3>
<p>æ¯ä¸ªç»„ä»¶æœ‰ä¸€ä¸ª <code>events</code> å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ç»‘å®šçš„äº‹ä»¶ã€‚ç›®å‰æˆ‘åªå®šä¹‰äº†ä¸¤ä¸ªäº‹ä»¶ï¼š</p>
<ol>
<li>alert äº‹ä»¶</li>
<li>redirect äº‹ä»¶</li>
</ol>
<pre><code class="language-js">// ç¼–è¾‘å™¨è‡ªå®šä¹‰äº‹ä»¶
const events = {
    redirect(url) {
        if (url) {
            window.location.href = url
        }
    },

    alert(msg) {
        if (msg) {
            alert(msg)
        }
    },
}

const mixins = {
    methods: events,
}

const eventList = [
    {
        key: 'redirect',
        label: 'è·³è½¬äº‹ä»¶',
        event: events.redirect,
        param: '',
    },
    {
        key: 'alert',
        label: 'alert äº‹ä»¶',
        event: events.alert,
        param: '',
    },
]

export {
    mixins,
    events,
    eventList,
}

</code></pre>
<p>ä¸è¿‡ä¸èƒ½åœ¨ç¼–è¾‘çš„æ—¶å€™è§¦å‘ï¼Œå¯ä»¥åœ¨é¢„è§ˆçš„æ—¶å€™è§¦å‘ã€‚</p>
<figure data-type="image" tabindex="12"><img src="https://blog.luyu.icu/post-images/1613500164656.gif" alt="" loading="lazy"></figure>
<h4 id="æ·»åŠ äº‹ä»¶">æ·»åŠ äº‹ä»¶</h4>
<p>é€šè¿‡ <code>v-for</code> æŒ‡ä»¤å°†äº‹ä»¶åˆ—è¡¨æ¸²æŸ“å‡ºæ¥ï¼š</p>
<pre><code class="language-html">&lt;el-tabs v-model=&quot;eventActiveName&quot;&gt;
    &lt;el-tab-pane v-for=&quot;item in eventList&quot; :key=&quot;item.key&quot; :label=&quot;item.label&quot; :name=&quot;item.key&quot; style=&quot;padding: 0 20px&quot;&gt;
        &lt;el-input v-if=&quot;item.key == 'redirect'&quot; v-model=&quot;item.param&quot; type=&quot;textarea&quot; placeholder=&quot;è¯·è¾“å…¥å®Œæ•´çš„ URL&quot; /&gt;
        &lt;el-input v-if=&quot;item.key == 'alert'&quot; v-model=&quot;item.param&quot; type=&quot;textarea&quot; placeholder=&quot;è¯·è¾“å…¥è¦ alert çš„å†…å®¹&quot; /&gt;
        &lt;el-button style=&quot;margin-top: 20px;&quot; @click=&quot;addEvent(item.key, item.param)&quot;&gt;ç¡®å®š&lt;/el-button&gt;
    &lt;/el-tab-pane&gt;
&lt;/el-tabs&gt;
</code></pre>
<p>é€‰ä¸­äº‹ä»¶æ—¶å°†äº‹ä»¶æ·»åŠ åˆ°ç»„ä»¶çš„ <code>events</code> å¯¹è±¡ã€‚</p>
<h4 id="è§¦å‘äº‹ä»¶">è§¦å‘äº‹ä»¶</h4>
<p>é¢„è§ˆæˆ–çœŸæ­£æ¸²æŸ“é¡µé¢æ—¶ï¼Œä¹Ÿéœ€è¦åœ¨æ¯ä¸ªç»„ä»¶å¤–é¢å¥—ä¸€å±‚ DIVï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ DIV ä¸Šç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»æ—¶è§¦å‘æˆ‘ä»¬åˆšæ‰æ·»åŠ çš„äº‹ä»¶ã€‚</p>
<pre><code class="language-html">&lt;template&gt;
    &lt;div @click=&quot;handleClick&quot;&gt;
        &lt;component
            class=&quot;conponent&quot;
            :is=&quot;config.component&quot;
            :style=&quot;getStyle(config.style)&quot;
            :propValue=&quot;config.propValue&quot;
        /&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="language-js">handleClick() {
    const events = this.config.events
    // å¾ªç¯è§¦å‘ç»‘å®šçš„äº‹ä»¶
    Object.keys(events).forEach(event =&gt; {
        this[event](events[event])
    })
}
</code></pre>
<h3 id="11-ç»‘å®šåŠ¨ç”»">11. ç»‘å®šåŠ¨ç”»</h3>
<p>åŠ¨ç”»å’Œäº‹ä»¶çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå…ˆå°†æ‰€æœ‰çš„åŠ¨ç”»é€šè¿‡ <code>v-for</code>æŒ‡ä»¤æ¸²æŸ“å‡ºæ¥ï¼Œç„¶åç‚¹å‡»åŠ¨ç”»å°†å¯¹åº”çš„åŠ¨ç”»æ·»åŠ åˆ°ç»„ä»¶çš„ <code>animations</code> æ•°ç»„é‡Œã€‚åŒäº‹ä»¶ä¸€æ ·ï¼Œæ‰§è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯éå†ç»„ä»¶æ‰€æœ‰çš„åŠ¨ç”»å¹¶æ‰§è¡Œã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <a href="https://animate.style/"><code>animate.css</code> </a>åŠ¨ç”»åº“ã€‚</p>
<pre><code class="language-js">// main.js
import '@/styles/animate.css'
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æå‰å®šä¹‰å¥½æ‰€æœ‰çš„åŠ¨ç”»æ•°æ®ï¼š</p>
<pre><code class="language-js">export default [
    {
        label: 'è¿›å…¥',
        children: [
            { label: 'æ¸æ˜¾', value: 'fadeIn' },
            { label: 'å‘å³è¿›å…¥', value: 'fadeInLeft' },
            { label: 'å‘å·¦è¿›å…¥', value: 'fadeInRight' },
            { label: 'å‘ä¸Šè¿›å…¥', value: 'fadeInUp' },
            { label: 'å‘ä¸‹è¿›å…¥', value: 'fadeInDown' },
            { label: 'å‘å³é•¿è·è¿›å…¥', value: 'fadeInLeftBig' },
            { label: 'å‘å·¦é•¿è·è¿›å…¥', value: 'fadeInRightBig' },
            { label: 'å‘ä¸Šé•¿è·è¿›å…¥', value: 'fadeInUpBig' },
            { label: 'å‘ä¸‹é•¿è·è¿›å…¥', value: 'fadeInDownBig' },
            { label: 'æ—‹è½¬è¿›å…¥', value: 'rotateIn' },
            { label: 'å·¦é¡ºæ—¶é’ˆæ—‹è½¬', value: 'rotateInDownLeft' },
            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInDownRight' },
            { label: 'å·¦é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInUpLeft' },
            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInUpRight' },
            { label: 'å¼¹å…¥', value: 'bounceIn' },
            { label: 'å‘å³å¼¹å…¥', value: 'bounceInLeft' },
            { label: 'å‘å·¦å¼¹å…¥', value: 'bounceInRight' },
            { label: 'å‘ä¸Šå¼¹å…¥', value: 'bounceInUp' },
            { label: 'å‘ä¸‹å¼¹å…¥', value: 'bounceInDown' },
            { label: 'å…‰é€Ÿä»å³è¿›å…¥', value: 'lightSpeedInRight' },
            { label: 'å…‰é€Ÿä»å·¦è¿›å…¥', value: 'lightSpeedInLeft' },
            { label: 'å…‰é€Ÿä»å³é€€å‡º', value: 'lightSpeedOutRight' },
            { label: 'å…‰é€Ÿä»å·¦é€€å‡º', value: 'lightSpeedOutLeft' },
            { label: 'Yè½´æ—‹è½¬', value: 'flip' },
            { label: 'ä¸­å¿ƒXè½´æ—‹è½¬', value: 'flipInX' },
            { label: 'ä¸­å¿ƒYè½´æ—‹è½¬', value: 'flipInY' },
            { label: 'å·¦é•¿åŠå¾„æ—‹è½¬', value: 'rollIn' },
            { label: 'ç”±å°å˜å¤§è¿›å…¥', value: 'zoomIn' },
            { label: 'å·¦å˜å¤§è¿›å…¥', value: 'zoomInLeft' },
            { label: 'å³å˜å¤§è¿›å…¥', value: 'zoomInRight' },
            { label: 'å‘ä¸Šå˜å¤§è¿›å…¥', value: 'zoomInUp' },
            { label: 'å‘ä¸‹å˜å¤§è¿›å…¥', value: 'zoomInDown' },
            { label: 'å‘å³æ»‘åŠ¨å±•å¼€', value: 'slideInLeft' },
            { label: 'å‘å·¦æ»‘åŠ¨å±•å¼€', value: 'slideInRight' },
            { label: 'å‘ä¸Šæ»‘åŠ¨å±•å¼€', value: 'slideInUp' },
            { label: 'å‘ä¸‹æ»‘åŠ¨å±•å¼€', value: 'slideInDown' },
        ],
    },
    {
        label: 'å¼ºè°ƒ',
        children: [
            { label: 'å¼¹è·³', value: 'bounce' },
            { label: 'é—ªçƒ', value: 'flash' },
            { label: 'æ”¾å¤§ç¼©å°', value: 'pulse' },
            { label: 'æ”¾å¤§ç¼©å°å¼¹ç°§', value: 'rubberBand' },
            { label: 'å·¦å³æ™ƒåŠ¨', value: 'headShake' },
            { label: 'å·¦å³æ‰‡å½¢æ‘‡æ‘†', value: 'swing' },
            { label: 'æ”¾å¤§æ™ƒåŠ¨ç¼©å°', value: 'tada' },
            { label: 'æ‰‡å½¢æ‘‡æ‘†', value: 'wobble' },
            { label: 'å·¦å³ä¸Šä¸‹æ™ƒåŠ¨', value: 'jello' },
            { label: 'Yè½´æ—‹è½¬', value: 'flip' },
        ],
    },
    {
        label: 'é€€å‡º',
        children: [
            { label: 'æ¸éš', value: 'fadeOut' },
            { label: 'å‘å·¦é€€å‡º', value: 'fadeOutLeft' },
            { label: 'å‘å³é€€å‡º', value: 'fadeOutRight' },
            { label: 'å‘ä¸Šé€€å‡º', value: 'fadeOutUp' },
            { label: 'å‘ä¸‹é€€å‡º', value: 'fadeOutDown' },
            { label: 'å‘å·¦é•¿è·é€€å‡º', value: 'fadeOutLeftBig' },
            { label: 'å‘å³é•¿è·é€€å‡º', value: 'fadeOutRightBig' },
            { label: 'å‘ä¸Šé•¿è·é€€å‡º', value: 'fadeOutUpBig' },
            { label: 'å‘ä¸‹é•¿è·é€€å‡º', value: 'fadeOutDownBig' },
            { label: 'æ—‹è½¬é€€å‡º', value: 'rotateOut' },
            { label: 'å·¦é¡ºæ—¶é’ˆæ—‹è½¬', value: 'rotateOutDownLeft' },
            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutDownRight' },
            { label: 'å·¦é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutUpLeft' },
            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutUpRight' },
            { label: 'å¼¹å‡º', value: 'bounceOut' },
            { label: 'å‘å·¦å¼¹å‡º', value: 'bounceOutLeft' },
            { label: 'å‘å³å¼¹å‡º', value: 'bounceOutRight' },
            { label: 'å‘ä¸Šå¼¹å‡º', value: 'bounceOutUp' },
            { label: 'å‘ä¸‹å¼¹å‡º', value: 'bounceOutDown' },
            { label: 'ä¸­å¿ƒXè½´æ—‹è½¬', value: 'flipOutX' },
            { label: 'ä¸­å¿ƒYè½´æ—‹è½¬', value: 'flipOutY' },
            { label: 'å·¦é•¿åŠå¾„æ—‹è½¬', value: 'rollOut' },
            { label: 'ç”±å°å˜å¤§é€€å‡º', value: 'zoomOut' },
            { label: 'å·¦å˜å¤§é€€å‡º', value: 'zoomOutLeft' },
            { label: 'å³å˜å¤§é€€å‡º', value: 'zoomOutRight' },
            { label: 'å‘ä¸Šå˜å¤§é€€å‡º', value: 'zoomOutUp' },
            { label: 'å‘ä¸‹å˜å¤§é€€å‡º', value: 'zoomOutDown' },
            { label: 'å‘å·¦æ»‘åŠ¨æ”¶èµ·', value: 'slideOutLeft' },
            { label: 'å‘å³æ»‘åŠ¨æ”¶èµ·', value: 'slideOutRight' },
            { label: 'å‘ä¸Šæ»‘åŠ¨æ”¶èµ·', value: 'slideOutUp' },
            { label: 'å‘ä¸‹æ»‘åŠ¨æ”¶èµ·', value: 'slideOutDown' },
        ],
    },
]
</code></pre>
<p>ç„¶åç”¨<code>v-for</code>æŒ‡ä»¤æ¸²æŸ“å‡ºæ¥åŠ¨ç”»åˆ—è¡¨ã€‚<br>
<img src="https://blog.luyu.icu/post-images/1613500419330.gif" alt="" loading="lazy"></p>
<h4 id="æ·»åŠ åŠ¨ç”»">æ·»åŠ åŠ¨ç”»</h4>
<pre><code class="language-html">&lt;el-tabs v-model=&quot;animationActiveName&quot;&gt;
    &lt;el-tab-pane v-for=&quot;item in animationClassData&quot; :key=&quot;item.label&quot; :label=&quot;item.label&quot; :name=&quot;item.label&quot;&gt;
        &lt;el-scrollbar class=&quot;animate-container&quot;&gt;
            &lt;div
                class=&quot;animate&quot;
                v-for=&quot;(animate, index) in item.children&quot;
                :key=&quot;index&quot;
                @mouseover=&quot;hoverPreviewAnimate = animate.value&quot;
                @click=&quot;addAnimation(animate)&quot;
            &gt;
                &lt;div :class=&quot;[hoverPreviewAnimate === animate.value &amp;&amp; animate.value + ' animated']&quot;&gt;
                    {{ animate.label }}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/el-scrollbar&gt;
    &lt;/el-tab-pane&gt;
&lt;/el-tabs&gt;
</code></pre>
<p>ç‚¹å‡»åŠ¨ç”»å°†è°ƒç”¨ <code>addAnimation(animate)</code> å°†åŠ¨ç”»æ·»åŠ åˆ°ç»„ä»¶çš„ <code>animations</code> æ•°ç»„ã€‚</p>
<h4 id="è§¦å‘åŠ¨ç”»">è§¦å‘åŠ¨ç”»</h4>
<p>è¿è¡ŒåŠ¨ç”»çš„ä»£ç ï¼š</p>
<pre><code class="language-js">export default async function runAnimation($el, animations = []) {
    const play = (animation) =&gt; new Promise(resolve =&gt; {
        $el.classList.add(animation.value, 'animated')
        const removeAnimation = () =&gt; {
            $el.removeEventListener('animationend', removeAnimation)
            $el.removeEventListener('animationcancel', removeAnimation)
            $el.classList.remove(animation.value, 'animated')
            resolve()
        }
            
        $el.addEventListener('animationend', removeAnimation)
        $el.addEventListener('animationcancel', removeAnimation)
    })

    for (let i = 0, len = animations.length; i &lt; len; i++) {
        await play(animations[i])
    }
}
</code></pre>
<p>è¿è¡ŒåŠ¨ç”»éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šç»„ä»¶å¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼ˆåœ¨ç»„ä»¶ä½¿ç”¨ <code>this.$el</code>è·å–ï¼‰å’Œå®ƒçš„åŠ¨ç”»æ•°æ® <code>animations</code>ã€‚å¹¶ä¸”éœ€è¦ç›‘å¬ <code>animationend</code> äº‹ä»¶å’Œ <code>animationcancel</code> äº‹ä»¶ï¼šä¸€ä¸ªæ˜¯åŠ¨ç”»ç»“æŸæ—¶è§¦å‘ï¼Œä¸€ä¸ªæ˜¯åŠ¨ç”»æ„å¤–ç»ˆæ­¢æ—¶è§¦å‘ã€‚<br>
åˆ©ç”¨è¿™ä¸€ç‚¹å†é…åˆ <code>Promise</code> ä¸€èµ·ä½¿ç”¨ï¼Œå°±å¯ä»¥é€ä¸ªè¿è¡Œç»„ä»¶çš„æ¯ä¸ªåŠ¨ç”»äº†ã€‚</p>
<h3 id="12-å¯¼å…¥-psd">12. å¯¼å…¥ PSD</h3>
<p>ç”±äºæ—¶é—´å…³ç³»ï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘è¿˜æ²¡åšã€‚ç°åœ¨ç®€å•çš„æè¿°ä¸€ä¸‹æ€ä¹ˆåšè¿™ä¸ªåŠŸèƒ½ã€‚é‚£å°±æ˜¯ä½¿ç”¨ <a href="https://github.com/meltingice/psd.js#readme"><code>psd.js</code></a> åº“ï¼Œå®ƒå¯ä»¥è§£æ <code>PSD</code> æ–‡ä»¶ã€‚</p>
<p>ä½¿ç”¨ <code>psd.js</code> åº“è§£æ <code>PSD</code> æ–‡ä»¶å¾—å‡ºçš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{ children: 
   [ { type: 'group',
       visible: false,
       opacity: 1,
       blendingMode: 'normal',
       name: 'Version D',
       left: 0,
       right: 900,
       top: 0,
       bottom: 600,
       height: 600,
       width: 900,
       children: 
        [ { type: 'layer',
            visible: true,
            opacity: 1,
            blendingMode: 'normal',
            name: 'Make a change and save.',
            left: 275,
            right: 636,
            top: 435,
            bottom: 466,
            height: 31,
            width: 361,
            mask: {},
            text: 
             { value: 'Make a change and save.',
               font: 
                { name: 'HelveticaNeue-Light',
                  sizes: [ 33 ],
                  colors: [ [ 85, 96, 110, 255 ] ],
                  alignment: [ 'center' ] },
               left: 0,
               top: 0,
               right: 0,
               bottom: 0,
               transform: { xx: 1, xy: 0, yx: 0, yy: 1, tx: 456, ty: 459 } },
            image: {} } ] } ],
    document: 
       { width: 900,
         height: 600,
         resources: 
          { layerComps: 
             [ { id: 692243163, name: 'Version A', capturedInfo: 1 },
               { id: 725235304, name: 'Version B', capturedInfo: 1 },
               { id: 730932877, name: 'Version C', capturedInfo: 1 } ],
            guides: [],
            slices: [] } } }

</code></pre>
<p>ä»ä»¥ä¸Šä»£ç å¯ä»¥å‘ç°ï¼Œè¿™äº›æ•°æ®å’Œ <code>css</code> éå¸¸åƒã€‚æ ¹æ®è¿™ä¸€ç‚¹ï¼Œåªéœ€è¦å†™ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼Œå°†è¿™äº›æ•°æ®è½¬æ¢æˆæˆ‘ä»¬ç»„ä»¶æ‰€éœ€çš„æ•°æ®ï¼Œå°±èƒ½å®ç° <code>PSD</code>æ–‡ä»¶è½¬æˆæ¸²æŸ“ç»„ä»¶çš„åŠŸèƒ½ã€‚ç›®å‰ <a href="https://github.com/huangwei9527/quark-h5"><code>quark-h5</code></a> å’Œ <a href="https://github.com/ly525/luban-h5"><code>luban-h5</code></a> éƒ½æ˜¯è¿™æ ·å®ç°çš„ <code>PSD</code> è½¬æ¢åŠŸèƒ½ã€‚</p>
<h3 id="13-æ‰‹æœºæ¨¡å¼">13. æ‰‹æœºæ¨¡å¼</h3>
<p>ç”±äºç”»å¸ƒæ˜¯å¯ä»¥è°ƒæ•´å¤§å°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ iphone6 çš„åˆ†è¾¨ç‡æ¥å¼€å‘æ‰‹æœºé¡µé¢ã€‚</p>
<figure data-type="image" tabindex="13"><img src="https://blog.luyu.icu/post-images/1613500731839.png" alt="" loading="lazy"></figure>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ç”±äº DEMO çš„ä»£ç æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨è®²è§£æ¯ä¸€ä¸ªåŠŸèƒ½ç‚¹æ—¶ï¼Œæˆ‘åªæŠŠå…³é”®ä»£ç è´´ä¸Šæ¥ã€‚æ‰€ä»¥å¤§å®¶ä¼šå‘ç° DEMO çš„æºç å’Œæˆ‘è´´ä¸Šæ¥çš„ä»£ç ä¼šæœ‰äº›åŒºåˆ«ï¼Œè¯·ä¸å¿…åœ¨æ„ã€‚</p>
<p>å¦å¤–ï¼ŒDEMO çš„æ ·å¼ä¹Ÿæ¯”è¾ƒç®€é™‹ï¼Œä¸»è¦æ˜¯æœ€è¿‘äº‹æƒ…æ¯”è¾ƒå¤šï¼Œæ²¡å¤ªå¤šæ—¶é—´å†™å¥½çœ‹ç‚¹ï¼Œè¯·è§è°…ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[vue -- äº‹ä»¶æ€»çº¿ EventBus]]></title>
        <id>https://blog.luyu.icu/post/xNPEyzRmb/</id>
        <link href="https://blog.luyu.icu/post/xNPEyzRmb/">
        </link>
        <updated>2021-02-16T17:01:03.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡è½¬è‡ª<a href="https://segmentfault.com/a/1190000021707081">segmentfault</a></p>
<p>æœ¬æ–‡ä»…è®°å½•å­˜åœ¨è¿™ç§äº‹ä»¶ä¼ é€’çš„æ–¹å¼ï¼Œä½†ä¸æ¨å´‡ã€‚</p>
<p><code>EventBus</code>åˆç§°ä¸ºäº‹ä»¶æ€»çº¿ã€‚åœ¨<code>Vue</code>ä¸­å¯ä»¥ä½¿ç”¨ <code>EventBus</code> æ¥ä½œä¸ºç»„ä»¶ä¼ é€’æ•°æ®çš„æ¡¥æ¢çš„ï¼Œå°±åƒæ˜¯æ‰€æœ‰ç»„ä»¶å…±ç”¨ç›¸åŒçš„äº‹ä»¶ä¸­å¿ƒï¼Œå¯ä»¥å‘è¯¥ä¸­å¿ƒæ³¨å†Œå‘é€äº‹ä»¶æˆ–æ¥æ”¶äº‹ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶éƒ½å¯ä»¥ä¸Šä¸‹å¹³è¡Œåœ°é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼Œä½†ä¹Ÿå°±æ˜¯å¤ªæ–¹ä¾¿æ‰€ä»¥è‹¥ä½¿ç”¨ä¸æ…ï¼Œå°±ä¼šé€ æˆéš¾ä»¥ç»´æŠ¤çš„ç¾éš¾ï¼Œå› æ­¤æ‰éœ€è¦æ›´å®Œå–„çš„<code>Vuex</code>ä½œä¸ºçŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼Œå°†é€šçŸ¥çš„æ¦‚å¿µä¸Šå‡åˆ°å…±äº«çŠ¶æ€å±‚æ¬¡ã€‚</p>
<blockquote>
<p>å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ˜¯ <code>Vuex</code>ã€‚ä¸è¿‡å¦‚æœé¡¹ç›®ä¸æ˜¯å¾ˆå¤§ï¼ŒçŠ¶æ€ç®¡ç†ä¹Ÿæ²¡æœ‰å¾ˆå¤æ‚çš„è¯ï¼Œä½¿ç”¨ Vuex æ²¡å¿…è¦ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨-eventbus">ä½¿ç”¨ EventBus</h2>
<blockquote>
<p>ä½ éœ€è¦åšçš„åªæ˜¯å¼•å…¥ <code>Vue</code> å¹¶å¯¼å‡ºå®ƒçš„ä¸€ä¸ªå®ä¾‹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ç§°å®ƒä¸º <code>EventBus</code> ï¼‰ã€‚å®è´¨ä¸Šå®ƒæ˜¯ä¸€ä¸ªä¸å…·å¤‡ <code>DOM</code> çš„ç»„ä»¶ï¼Œå®ƒå…·æœ‰çš„ä»…ä»…åªæ˜¯å®ƒå®ä¾‹æ–¹æ³•è€Œå·²ï¼Œå› æ­¤å®ƒéå¸¸çš„è½»ä¾¿ã€‚</p>
</blockquote>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<ul>
<li>ç¬¬ä¸€ç§æ–¹å¼: å¯ä»¥åœ¨ <code>main.js</code>ä¸­ï¼Œåˆå§‹åŒ– <code>EventBus</code></li>
</ul>
<pre><code>Vue.prototype.$EventBus = new Vue()
</code></pre>
<ul>
<li>ç¬¬äºŒç§æ–¹å¼: åˆ›å»ºä¸€ä¸ª <code>Bus.js</code>,å†åˆ›å»ºäº‹ä»¶æ€»çº¿å¹¶å°†å…¶å¯¼å‡ºï¼Œä»¥ä¾¿å…¶å®ƒæ¨¡å—å¯ä»¥ä½¿ç”¨æˆ–è€…ç›‘å¬å®ƒ</li>
</ul>
<pre><code>// Bus.js
import Vue from 'vue'
export const EventBus = new Vue();
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº† <code>EventBus</code> ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦åšåˆ°çš„å°±æ˜¯åœ¨ä½ çš„ç»„ä»¶ä¸­åŠ è½½å®ƒï¼Œå¹¶ä¸”è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œå°±å¦‚ä½ åœ¨çˆ¶å­ç»„ä»¶ä¸­äº’ç›¸ä¼ é€’æ¶ˆæ¯ä¸€æ ·ã€‚</p>
<h3 id="å‘é€å’Œæ¥å—äº‹ä»¶">å‘é€å’Œæ¥å—äº‹ä»¶</h3>
<p>å…¶å®å’Œ çˆ¶å­ç»„ä»¶çš„é€šä¿¡å·®ä¸å¤š,ç”¨ <code>EventBus.$emit('eventName',data)</code>å‘é€ï¼Œ <code>EventBus.$on(&quot;eventName&quot;, callback(payload1,â€¦))</code> æ¥å—</p>
<p>ç°åœ¨å‡è®¾ A ç»„ä»¶ä¸ B ç»„ä»¶é€šä¿¡</p>
<pre><code>&lt;!-- A.vue --&gt;
&lt;template&gt;
    &lt;p&gt;{{msgB}}&lt;/p&gt;
    &lt;button @click=&quot;sendMsgA()&quot;&gt;-&lt;/button&gt;
&lt;/template&gt;

&lt;script&gt; 
import { EventBus } from &quot;../Bus.js&quot;;
export default {
    data(){
        return {
        msg: ''
        }
    },
    mounted() {
        EventBus.$on(&quot;bMsg&quot;, (msg) =&gt; {
            // aç»„ä»¶æ¥å— bå‘é€æ¥çš„æ¶ˆæ¯
            this.msg = msg;
        });
    },
    methods: {
        sendMsgA() {
            EventBus.$emit(&quot;aMsg&quot;, 'æ¥è‡ªAé¡µé¢çš„æ¶ˆæ¯'); // a å‘é€æ•°æ®
        }
    }
}; 
&lt;/script&gt;


&lt;!-- B.vue --&gt;
&lt;template&gt;
  &lt;p&gt;{{msgA}}&lt;/p&gt;
    &lt;button @click=&quot;sendMsgB()&quot;&gt;-&lt;/button&gt;
&lt;/template&gt;

&lt;script&gt; 
import { EventBus } from &quot;../event-bus.js&quot;;
export default {
    data(){
        return {
        msg: ''
        }
    },
    mounted() {
        EventBus.$on(&quot;aMsg&quot;, (msg) =&gt; {
            // bç»„ä»¶æ¥å— aå‘é€æ¥çš„æ¶ˆæ¯
            this.msg = msg;
        });
    },
    methods: {
        sendMsgB() {
            EventBus.$emit(&quot;bMsg&quot;, 'æ¥è‡ªbé¡µé¢çš„æ¶ˆæ¯'); // bå‘é€æ•°æ®
        }
    }
};
&lt;/script&gt;
</code></pre>
<p>å¦‚æœåªç›‘å¬(æ¥å—)ä¸€æ¬¡æ•°æ®å¯ä»¥ä½¿ç”¨ <code>EventBus.$once('eventName', callback(payload1,â€¦)</code></p>
<h3 id="ç§»é™¤ç§»é™¤äº‹ä»¶ç›‘å¬è€…">ç§»é™¤ç§»é™¤äº‹ä»¶ç›‘å¬è€…</h3>
<ul>
<li>ç§»é™¤å•ä¸ªäº‹ä»¶ç›‘å¬ <code>EventBus.$off('eventName', callback)</code></li>
<li>ç§»é™¤å…¨éƒ¨äº‹ä»¶ç›‘å¬ <code>EventBus.$off()</code></li>
</ul>
<pre><code>// å¯¼å…¥æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ EventBus
import { EventBus } from '../Bus.js'

// äº‹ä»¶ç›‘å¬å‡½æ•°
const clickHandler = function(clickCount) {
  console.log(`Oh, hello)`)
}

// å¼€å§‹ç›‘å¬äº‹ä»¶
EventBus.$on('i-got-clicked', clickHandler);

// åœæ­¢ç›‘å¬
EventBus.$off('i-got-clicked', clickHandler);

</code></pre>
<h2 id="å…¨å±€eventbus">å…¨å±€<code>EventBus</code></h2>
<p>å…¨å±€<code>EventBus</code>ï¼Œè™½ç„¶åœ¨æŸäº›ç¤ºä¾‹ä¸­ä¸æå€¡ä½¿ç”¨ï¼Œä½†å®ƒæ˜¯ä¸€ç§éå¸¸æ¼‚äº®ä¸”ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥è·¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ã€‚</p>
<p>å®ƒçš„å·¥ä½œåŸç†æ˜¯å‘å¸ƒ/è®¢é˜…æ–¹æ³•ï¼Œé€šå¸¸ç§°ä¸º <code>Pub</code>/<code>Sub</code> ã€‚</p>
<p>ç”±äºæ˜¯å…¨å±€çš„ï¼Œå¿…ç„¶æ‰€æœ‰äº‹ä»¶éƒ½è®¢é˜…å®ƒ, æ‰€æœ‰ç»„ä»¶ä¹Ÿå‘å¸ƒåˆ°å®ƒï¼Œè®¢é˜…ç»„ä»¶è·å¾—æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰ç»„ä»¶éƒ½èƒ½å¤Ÿå°†äº‹ä»¶å‘å¸ƒåˆ°æ€»çº¿ï¼Œç„¶åæ€»çº¿ç”±å¦ä¸€ä¸ªç»„ä»¶è®¢é˜…ï¼Œç„¶åè®¢é˜…å®ƒçš„ç»„ä»¶å°†å¾—åˆ°æ›´æ–°ã€‚</p>
<h3 id="åˆ›å»ºå…¨å±€eventbus">åˆ›å»ºå…¨å±€<code>EventBus</code></h3>
<p>å…¨å±€äº‹ä»¶æ€»çº¿åªä¸è¿‡æ˜¯ä¸€ä¸ªç®€å•çš„<code>vue</code> ç»„ä»¶ã€‚</p>
<pre><code>var EventBus = new Vue();

Object.defineProperties(Vue.prototype, {
  $bus: {
    get: function () {
      return EventBus
    }
  }
})
// è¿™ä¸ªåˆå§‹åŒ–çš„ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¸ªäººæ„Ÿè§‰åŒºåˆ«ä¸å¤§
</code></pre>
<h3 id="ä½¿ç”¨-onå’Œemit">ä½¿ç”¨ <code>$on</code>å’Œ<code>$emit</code></h3>
<p>åœ¨è¿™ä¸ªç‰¹å®šçš„æ€»çº¿ä¸­ä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ã€‚ä¸€ä¸ªç”¨äºåˆ›å»ºå‘å‡ºçš„äº‹ä»¶ï¼Œå®ƒå°±æ˜¯<code>$emit</code>ï¼›å¦ä¸€ä¸ªç”¨äºè®¢é˜…<code>$emit</code>,å¹¶æ¥æ”¶å‚æ•°æ‰§è¡Œå›è°ƒï¼Œå®ƒå°±æ˜¯<code>$on</code>ï¼š</p>
<pre><code>this.$bus.$emit('nameOfEvent',{ ... pass some event data ...});

this.$bus.$on('nameOfEvent',($event) =&gt; {
    // ...
})
</code></pre>
<h2 id="eventbusçš„ä¼˜ç¼ºç‚¹">EventBusçš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<ul>
<li>å¤§å®¶éƒ½çŸ¥é“vueæ˜¯å•é¡µåº”ç”¨ï¼Œå¦‚æœä½ åœ¨æŸä¸€ä¸ªé¡µé¢åˆ·æ–°äº†ä¹‹åï¼Œä¸ä¹‹ç›¸å…³çš„EventBusä¼šè¢«ç§»é™¤ï¼Œè¿™æ ·å°±å¯¼è‡´ä¸šåŠ¡èµ°ä¸ä¸‹å»ã€‚</li>
<li>å¦‚æœä¸šåŠ¡æœ‰åå¤æ“ä½œçš„é¡µé¢ï¼ŒEventBusåœ¨ç›‘å¬çš„æ—¶å€™å°±ä¼šè§¦å‘å¾ˆå¤šæ¬¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„éšæ‚£ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¥½å¥½å¤„ç†EventBusåœ¨é¡¹ç›®ä¸­çš„å…³ç³»ã€‚é€šå¸¸ä¼šç”¨åˆ°ï¼Œåœ¨vueé¡µé¢é”€æ¯æ—¶ï¼ŒåŒæ—¶ç§»é™¤EventBusäº‹ä»¶ç›‘å¬ã€‚</li>
<li>ç”±äºæ˜¯éƒ½ä½¿ç”¨ä¸€ä¸ªVueå®ä¾‹ï¼Œæ‰€ä»¥å®¹æ˜“å‡ºç°é‡å¤è§¦å‘çš„æƒ…æ™¯ï¼Œä¸¤ä¸ªé¡µé¢éƒ½å®šä¹‰äº†åŒä¸€ä¸ªäº‹ä»¶åï¼Œå¹¶ä¸”æ²¡æœ‰ç”¨$offé”€æ¯ï¼ˆå¸¸å‡ºç°åœ¨è·¯ç”±åˆ‡æ¢æ—¶ï¼‰ã€‚</li>
</ul>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ul>
<li>è§£å†³äº†å¤šå±‚ç»„ä»¶ä¹‹é—´ç¹ççš„äº‹ä»¶ä¼ æ’­ã€‚</li>
<li>ä½¿ç”¨åŸç†ååˆ†ç®€å•ï¼Œä»£ç é‡å°‘ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ios css border-radiuså…ƒç´  overflow:hiddenå¤±æ•ˆé—®é¢˜]]></title>
        <id>https://blog.luyu.icu/post/VnrVXCKIi/</id>
        <link href="https://blog.luyu.icu/post/VnrVXCKIi/">
        </link>
        <updated>2021-02-16T16:49:36.000Z</updated>
        <content type="html"><![CDATA[<h2 id="é—®é¢˜">é—®é¢˜</h2>
<p>çˆ¶çº§è®¾ç½®åœ†è§’å±æ€§å¤±æ•ˆ çˆ¶å…ƒç´ ä½¿ç”¨border-radiuså’Œoverflow:hiddenåšæˆåœ†å½¢ï¼Œå­å…ƒç´ å¦‚æœä½¿ç”¨äº†transformå±æ€§ï¼Œåˆ™çˆ¶å…ƒç´ çš„overflow:hiddenä¼šå¤±æ•ˆã€‚</p>
<h2 id="è§£å†³">è§£å†³</h2>
<pre><code>-webkit-backface-visibility: hidden;
-webkit-transform: translate3d(0, 0, 0);
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Xcode 10 ä¸­å…³äº Error: Multiple commands produce]]></title>
        <id>https://blog.luyu.icu/post/AVegNSKtq/</id>
        <link href="https://blog.luyu.icu/post/AVegNSKtq/">
        </link>
        <updated>2021-02-16T16:45:43.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ‘˜è‡ª<a href="https://www.jianshu.com/p/fdb1421f3c8b">ç®€ä¹¦</a></p>
<p>æ›´æ–°<code>Xcode 10</code>ï¼Œè‡ªç„¶å¼€å§‹ç¬¬ä¸€æ—¶é—´è¿è¡Œè€é¡¹ç›®ï¼Œè¸©å‘å¡«å‘</p>
<h3 id="è¿™è¾¹è®°å½•ä¸‹åŸºæœ¬å‡ºç°çš„é—®é¢˜">è¿™è¾¹è®°å½•ä¸‹åŸºæœ¬å‡ºç°çš„é—®é¢˜</h3>
<blockquote>
<p><code>Error: Multiple commands produce</code></p>
</blockquote>
<p>Xcode 10 ä¸æœ¬é—®é¢˜ç›¸å…³çš„ä¸€ä¸ªæ›´æ–°ç‚¹ã€‚</p>
<blockquote>
<p>Build System<br>
Again, Xcode 10 uses a new build system. The new build system provides improved reliability and build performance, and it catches project configuration problems that the legacy build system does not.<br>
The legacy build system is still available in Xcode 10. To use the legacy build system, select it in the File &gt; Project/Workspace Settings sheet. Projects configured to use the legacy build system will display an orange hammer icon in the Activity View.</p>
</blockquote>
<p>ç®€å•è€Œè¨€ï¼Œ<code>Xcode10</code>ä½¿ç”¨äº†ä¸€ä¸ªçš„æ–°åˆ›å»ºç³»ç»Ÿï¼Œæ¯”ä¹‹å‰çš„æä¾›æ›´å¥½çš„å¯é æ€§ä¸åˆ›å»ºæ€§èƒ½ï¼Œè€Œä¸”å¯ä»¥è·å–é¡¹ç›®é…ç½®é—®é¢˜ï¼ˆé»˜è®¤è®¾ç½®æ–°åˆ›å»ºç³»ç»Ÿï¼‰</p>
<p>åœ¨è‹¹æœæ–‡æ¡£ä¸­ï¼ŒæåŠ<code>Xcode10</code>ä¸­çš„å…³äºæ—§é¡¹ç›®<code>New Build System</code>æ›´æ”¹é€‚é…ä¸­æåŠåˆ°ä»¥ä¸‹ä¸¤ç‚¹</p>
<ul>
<li>
<p>The new build system has stricter checks for cycles between elements in the build in order to prevent unnecessary rebuilds.</p>
</li>
<li>
<p>It is an error for any individual file in the build to be produced by more than one build command. For example, if two targets each declare the same output file from a shell script phase, factor out the declaration of the output file into a single target.</p>
</li>
</ul>
<p><code>New Build System</code>ä¼šå¯¹æ„å»ºä¸­çš„å…ƒç´ å¾ªç¯è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ï¼Œé¿å…ä¸å¿…è¦çš„é‡å»ºï¼Œè¿™ä¸ªä¹Ÿæ˜¯é”™è¯¯å‡ºç°çš„åŸå› ã€‚</p>
<h3 id="é”™è¯¯å‘ç”Ÿçš„ä¸¤ç§æ™®éå½¢å¼">é”™è¯¯å‘ç”Ÿçš„ä¸¤ç§æ™®éå½¢å¼ï¼š</h3>
<h4 id="1-infoplist">1. <code>info.plist</code></h4>
<blockquote>
<p>é”™è¯¯ä¿¡æ¯</p>
</blockquote>
<pre><code>Multiple commands produce '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist':
1) Target 'TYKYTwoLearnOneDo' (project 'TYKYTwoLearnOneDo') has copy command from '/Users/tjsoft/TYKY /å…šå»º/é»”çºª/QianJiDangJian_iOS/TYKYTwoLearnOneDo/Info.plist' to '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist'
2) Target 'TYKYTwoLearnOneDo' (project 'TYKYTwoLearnOneDo') has process command with output '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist'
</code></pre>
<h4 id="2-copy-pods-resources">2. <code>Copy Pods Resources</code></h4>
<blockquote>
<p>é”™è¯¯ä¿¡æ¯</p>
</blockquote>
<pre><code>Multiple commands produce '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app':
1) Target 'TYKYTwoLearnOneDo' has create directory command with output '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app'
2) That command depends on command in Target 'TYKYTwoLearnOneDo': script phase â€œ[CP] Copy Pods Resourcesâ€
</code></pre>
<h3 id="è§£å†³æ–¹æ³•å¯ä»¥æœ‰ä¸¤ç§">è§£å†³æ–¹æ³•å¯ä»¥æœ‰ä¸¤ç§:</h3>
<h4 id="1-ä¸€ç§æ˜¯ä¸ä½¿ç”¨new-build-systemåœ¨file-projectworkspace-settingsä¸­çš„share-projectworkspace-settingsé‡Œbuild-systemå°†new-build-systemdefaultåˆ‡æ¢æˆlegacy-build-system">1. ä¸€ç§æ˜¯ä¸ä½¿ç”¨<code>New Build System</code>ï¼Œåœ¨<code>File</code> &gt; <code>Project/Workspace Settings</code>ä¸­çš„<code>Share Project/Workspace Settings</code>é‡Œ<code>build system</code>å°†<code>New Build System(Default)</code>åˆ‡æ¢æˆ<code>Legacy build system</code>ã€‚</h4>
<figure data-type="image" tabindex="1"><img src="https://blog.luyu.icu/post-images/1613494079991.png" alt="" loading="lazy"></figure>
<h4 id="å…¶æ¬¡æ˜¯æ ¹æ®å‡ºé”™ä¿¡æ¯åœ¨æ–°åˆ›å»ºç³»ç»Ÿæ¨¡å¼ä¸‹å»é™¤å¤šä½™çš„å¼•ç”¨é‡å»º">å…¶æ¬¡æ˜¯æ ¹æ®å‡ºé”™ä¿¡æ¯ï¼Œåœ¨æ–°åˆ›å»ºç³»ç»Ÿæ¨¡å¼ä¸‹ï¼Œå»é™¤å¤šä½™çš„å¼•ç”¨é‡å»ºã€‚</h4>
<h5 id="1-infoplist-2">1. Info.plist</h5>
<p>åœ¨ <code>target</code> -&gt; <code>Build phase</code> &gt; <code>Copy Bundle Resource</code> ä¸­æ‰¾åˆ°<code>info.plist</code>ï¼Œç§»é™¤</p>
<figure data-type="image" tabindex="2"><img src="https://blog.luyu.icu/post-images/1613494034862.png" alt="" loading="lazy"></figure>
<h5 id="2-copy-pods-resources-2">2. Copy Pods Resources</h5>
<p>åœ¨ <code>target</code> -&gt; <code>Build phase</code> -&gt; <code>Copy Pods Resources</code> -&gt; <code>Output Files</code>ï¼Œç§»é™¤<code>${TARGET_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}</code></p>
<figure data-type="image" tabindex="3"><img src="https://blog.luyu.icu/post-images/1613494090242.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°]]></title>
        <id>https://blog.luyu.icu/post/d6wdVAP5_/</id>
        <link href="https://blog.luyu.icu/post/d6wdVAP5_/">
        </link>
        <updated>2021-02-16T16:44:09.000Z</updated>
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3>
<p>ç»™å®šä¸¤ä¸ªå¤§å°ä¸º <code>m</code> å’Œ <code>n</code> çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„Â <code>nums1</code> å’ŒÂ <code>nums2</code>ã€‚</p>
<p>è¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º<code>O(log(m + n))</code>ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾Â <code>nums1</code>Â å’ŒÂ <code>nums2</code>Â ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚</p>
<p></p>
<h4 id="ç¤ºä¾‹1">ç¤ºä¾‹1</h4>
<pre><code>nums1 = [1, 3]
nums2 = [2]

åˆ™ä¸­ä½æ•°æ˜¯ 2.0
</code></pre>
<h4 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2</h4>
<pre><code>nums1 = [1, 2]
nums2 = [3, 4]

åˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5
</code></pre>
<h4 id="é¢˜è§£">é¢˜è§£</h4>
<h5 id="é¢˜è§£ä¸€æš´åŠ›è§£æ³•">é¢˜è§£ä¸€ï¼šæš´åŠ›è§£æ³•</h5>
<h6 id="æ€è·¯">æ€è·¯</h6>
<p>æ ¹æ®é¢˜ç›®æè¿°åŠç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç”¨ len è¡¨ç¤ºåˆå¹¶åæ•°ç»„çš„é•¿åº¦å¦‚æœæ˜¯å¥‡æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç¬¬ <code>ï¼ˆlen+1ï¼‰/2</code> ä¸ªæ•°å°±å¯ä»¥äº†ï¼Œå¦‚æœéå†çš„è¯éœ€è¦éå† <code>Math.floor(len/2 ) + 1</code> æ¬¡ã€‚å¦‚æœæ˜¯å¶æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç¬¬ <code>len/2</code>å’Œ <code>len/2+1</code> ä¸ªæ•°çš„å€¼ï¼Œä¹Ÿæ˜¯éœ€è¦éå† <code>len/2+1</code> æ¬¡ã€‚æ‰€ä»¥éå†çš„è¯ï¼Œå¥‡æ•°å’Œå¶æ•°éƒ½æ˜¯ <code>len/2+1</code> æ¬¡ã€‚</p>
<p>å³ï¼š</p>
<ul>
<li>è‹¥<code>len%2===1</code>ä¸­ä½æ•°å°±æ˜¯ä½äºåˆå¹¶åæ•°ç»„<code>Math.floor(len/2)+1</code>çš„æ•°å­—ã€‚</li>
<li>è‹¥<code>(m+n)%2===0</code>ä¸­ä½æ•°å°±æ˜¯ä½äºåˆå¹¶åæ•°ç»„<code>len/2</code>å’Œ<code>len/2+1</code>çš„æ•°å­—çš„å¹³å‡æ•°ã€‚<br>
æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ’åºå°±å¯ä»¥äº†,è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æŒ‡é’ˆæ³•æ’åºè¿™æ ·æœ€å¤šåªéœ€è¦ç§»åŠ¨<code>len/2+1</code>å°±èƒ½è·å¾—ç­”æ¡ˆã€‚<br>
æ—¶é—´å¤æ‚åº¦ï¼šéå† <code>len/2+1</code> æ¬¡ï¼Œ<code>len=m+n</code>ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(m+n)</code>ã€‚</li>
</ul>
<p>ç©ºé—´å¤æ‚åº¦ï¼šæˆ‘ä»¬ç”³è¯·äº†å¸¸æ•°ä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯<code>m</code>ï¼Œ<code>n</code>ï¼Œ<code>len</code>ï¼Œ<code>pointer1</code>ï¼Œ<code>pointer2</code>ï¼Œ<code>newVal</code>ï¼Œ<code>oldVal</code> ä»¥åŠ <code>i</code>ã€‚</p>
<p>æ€»å…± 8 ä¸ªå˜é‡ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ <code>O(1)</code>ã€‚</p>
<p>ä½†è¿™å¹¶ä¸ç¬¦åˆé¢˜ç›®ä¸­è¦æ±‚çš„æ—¶é—´å¤æ‚åº¦<code>O(log(m + n))</code></p>
<h6 id="ä»£ç ">ä»£ç </h6>
<pre><code>/**
 * @param {number[]} nums1
 * @param {number[]} nums2
 * @return {number}
 */
var findMedianSortedArrays = function (nums1, nums2) {
    let m = nums1.length
    let n = nums2.length
    let len = m + n
    let pointer1 = 0, pointer2 = 0
    let newVal, oldVal
    for (let i = 0; i &lt;= len / 2; i++) {
        oldVal = newVal
        if (pointer1 &lt; m &amp;&amp; (nums1[pointer1] &lt;= nums2[pointer2] || pointer2 &gt;= n)) {
            newVal = nums1[pointer1++]
        } else {
            newVal = nums2[pointer2++]
        }
    }
    if ((len % 2) === 0) {
        return (newVal + oldVal) / 2
    } else {
        return newVal
    }
};
</code></pre>
<h5 id="é¢˜è§£äºŒäºŒåˆ†æ³•">é¢˜è§£äºŒï¼šäºŒåˆ†æ³•</h5>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸¤æ•°ä¹‹å’Œ]]></title>
        <id>https://blog.luyu.icu/post/05Y8j1Evg/</id>
        <link href="https://blog.luyu.icu/post/05Y8j1Evg/">
        </link>
        <updated>2021-02-16T16:43:37.000Z</updated>
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚</p>
<h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4>
<pre><code>ç»™å®š nums = [2, 7, 11, 15], target = 9

å› ä¸º nums[0] + nums[1] = 2 + 7 = 9
æ‰€ä»¥è¿”å› [0, 1]
</code></pre>
<h3 id="é¢˜è§£">é¢˜è§£</h3>
<h4 id="æ–¹æ³•ä¸€æš´åŠ›è§£æ³•">æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•</h4>
<h5 id="æ€è·¯">æ€è·¯ï¼š</h5>
<p>çœ‹åˆ°é¢˜ç›®åæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯ä¸¤ä¸ªå¾ªç¯åµŒå¥—ï¼Œéå†æ¯ä¸ªå…ƒç´ <code>x</code>ï¼Œå¹¶æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å…ƒç´ ä¸<code>x</code>ç›¸åŠ ç­‰äº<code>target</code></p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)<br>
ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p>
</blockquote>
<pre><code>var twoSum = function(nums, target) {
for (let i = 0; i &lt; nums.length; i++) {
        for (let j = i + 1; j &lt; nums.length; j++) {
            if (nums[i] + nums[j]= target) {
                return [i, j];
            }
        }
    }
};
</code></pre>
<h4 id="æ–¹æ³•äºŒä¸¤éå“ˆå¸Œè¡¨">æ–¹æ³•äºŒï¼šä¸¤éå“ˆå¸Œè¡¨</h4>
<h5 id="æ€è·¯-2">æ€è·¯ï¼š</h5>
<p>ä¸ºäº†å¯¹è¿è¡Œæ—¶é—´å¤æ‚åº¦è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨ã€‚ä¸€ä¸ªç®€å•çš„å®ç°ä½¿ç”¨äº†ä¸¤æ¬¡è¿­ä»£ã€‚åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå…ƒç´ çš„å€¼å’Œå®ƒçš„ç´¢å¼•æ·»åŠ åˆ°è¡¨ä¸­ã€‚ç„¶åï¼Œåœ¨ç¬¬äºŒæ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥æ¯ä¸ªå…ƒç´ æ‰€å¯¹åº”çš„ç›®æ ‡å…ƒç´  <code>target - nums[i]</code> æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ã€‚æ³¨æ„ï¼Œè¯¥ç›®æ ‡å…ƒç´ ä¸èƒ½æ˜¯ <code>nums[i]</code> æœ¬èº«ï¼</p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)<br>
ç©ºé—´å¤æ‚åº¦ï¼šO(n)</p>
</blockquote>
<pre><code>var twoSum = function(nums, target) {
    // æ„é€ å“ˆå¸Œè¡¨
    var map = new Map();
    for (let i = 0; i &lt; nums.length; i++) {
        //å°†æ•°æ®ä½œä¸ºmapçš„keyï¼Œæ•°æ®çš„ä½ç½®ä½œä¸ºmapçš„å€¼ï¼ˆç”±äºé¢˜ç›®ä¸­æåˆ°æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå³æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ï¼‰
        map.set(nums[i], i);
    }
    for (let j = 0; j &lt; nums.length; j++) {
        let complement = target - nums[j];
        if (map.has(complement) &amp;&amp; map.get(complement) !== j) {
            return [j, map.get(complement)];
        }
    }
    console.log(&quot;No two sum solution&quot;);
};

</code></pre>
<h4 id="æ–¹æ³•ä¸‰ä¸€éå“ˆå¸Œè¡¨">æ–¹æ³•ä¸‰ï¼šä¸€éå“ˆå¸Œè¡¨</h4>
<h5 id="æ€è·¯-3">æ€è·¯ï¼š</h5>
<p>å…¶å®æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€éå“ˆå¸Œè¡¨å®ŒæˆæŸ¥æ‰¾ï¼Œåœ¨è¿›è¡Œè¿­ä»£å¹¶å°†å…ƒç´ æ’å…¥åˆ°è¡¨ä¸­çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¼šå›è¿‡å¤´æ¥æ£€æŸ¥è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰å…ƒç´ æ‰€å¯¹åº”çš„ç›®æ ‡å…ƒç´ ã€‚å¦‚æœå®ƒå­˜åœ¨ï¼Œé‚£æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†å¯¹åº”è§£ï¼Œå¹¶ç«‹å³å°†å…¶è¿”å›ã€‚</p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)<br>
ç©ºé—´å¤æ‚åº¦ï¼šO(n)</p>
</blockquote>
<pre><code>var twoSum = function(nums, target) {
    let targetMap = new Map()
    for(let i = 0;i&lt;nums.length;i++){
        let a = target - nums[i]
        if(targetMap.has(a)){
            return [targetMap.get(a),i]
        }
        targetMap.set(nums[i],i)
    }
};
</code></pre>
]]></content>
    </entry>
</feed>